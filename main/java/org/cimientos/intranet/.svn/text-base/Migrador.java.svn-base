package org.cimientos.intranet;

import java.io.File;
import java.io.IOException;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;
import java.util.GregorianCalendar;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Scanner;
import java.util.logging.FileHandler;
import java.util.logging.Level;
import java.util.logging.Logger;
import java.util.logging.SimpleFormatter;
import org.apache.commons.collections.CollectionUtils;
import org.apache.commons.collections.Transformer;
import org.apache.commons.lang.StringUtils;
import org.cimientos.intranet.modelo.Beca;
import org.cimientos.intranet.modelo.Boletin;
import org.cimientos.intranet.modelo.CicloPrograma;
import org.cimientos.intranet.modelo.DesempenioEscolar;
import org.cimientos.intranet.modelo.EstadoBeca;
import org.cimientos.intranet.modelo.EstadoCiclo;
import org.cimientos.intranet.modelo.EstadoCuenta;
import org.cimientos.intranet.modelo.Materia;
import org.cimientos.intranet.modelo.NotaMateria;
import org.cimientos.intranet.modelo.Pago;
import org.cimientos.intranet.modelo.Periodo;
import org.cimientos.intranet.modelo.ResponsableAdulto;
import org.cimientos.intranet.modelo.ResponsableAdultoSeleccion;
import org.cimientos.intranet.modelo.Trimestre;
import org.cimientos.intranet.modelo.banco.Banco;
import org.cimientos.intranet.modelo.candidato.convocatoria.Convocatoria;
import org.cimientos.intranet.modelo.candidato.convocatoria.ConvocatoriaSeleccion;
import org.cimientos.intranet.modelo.empresa.Empresa;
import org.cimientos.intranet.modelo.escuela.Escuela;
import org.cimientos.intranet.modelo.escuela.EscuelaSeleccion;
import org.cimientos.intranet.modelo.informe.EstadoInforme;
import org.cimientos.intranet.modelo.informe.InformeCesacion;
import org.cimientos.intranet.modelo.informe.InformeIS1;
import org.cimientos.intranet.modelo.informe.InformeIS2;
import org.cimientos.intranet.modelo.pbe.evento.entrevistas.EntrevistaFinal;
import org.cimientos.intranet.modelo.pbe.evento.entrevistas.EntrevistaIndividual;
import org.cimientos.intranet.modelo.pbe.evento.entrevistas.EntrevistaReIncorporacion;
import org.cimientos.intranet.modelo.pbe.evento.entrevistas.EntrevistaRenovacion;
import org.cimientos.intranet.modelo.pbe.evento.entrevistas.ExportacionEspecial;
import org.cimientos.intranet.modelo.perfil.AlumnoPanelEA;
import org.cimientos.intranet.modelo.perfil.AlumnoSeleccion;
import org.cimientos.intranet.modelo.perfil.EstadoAlumno;
import org.cimientos.intranet.modelo.perfil.PerfilAlumno;
import org.cimientos.intranet.modelo.perfil.Turno;
import org.cimientos.intranet.modelo.perfilEA.PerfilEA;
import org.cimientos.intranet.modelo.perfilPadrino.PerfilPadrino;
import org.cimientos.intranet.modelo.perfilPadrino.TipoPadrino;
import org.cimientos.intranet.modelo.perfilRR.PerfilRR;
import org.cimientos.intranet.modelo.perfilTS.PerfilTS;
import org.cimientos.intranet.modelo.perfilstaff.PerfilStaff;
import org.cimientos.intranet.modelo.persona.Persona;
import org.cimientos.intranet.modelo.persona.PersonaSeleccion;
import org.cimientos.intranet.modelo.seleccion.EntrevistaSeleccion;
import org.cimientos.intranet.modelo.sucursalBanco.SucursalBanco;
import org.cimientos.intranet.modelo.ubicacion.Localidad;
import org.cimientos.intranet.modelo.ubicacion.Provincia;
import org.cimientos.intranet.modelo.ubicacion.ZonaCimientos;
import org.cimientos.intranet.modelo.usuario.Usuario;
import org.cimientos.intranet.utils.ConstantesBoletin;
import org.cimientos.intranet.utils.ConstantesInformes;
import org.cimientos.intranet.utils.ConstantesPaneles;
import org.cimientos.intranet.utils.Formateador;
import org.cimientos.intranet.utils.PeriodoHelper;
import org.cimientos.intranet.web.controller.MateriaPreviaDTO;
import org.hibernate.Criteria;
import org.hibernate.HibernateException;
import org.hibernate.Session;
import org.hibernate.SessionFactory;
import org.hibernate.Transaction;
import org.hibernate.criterion.Restrictions;
import org.springframework.beans.factory.BeanFactory;
import org.springframework.beans.factory.xml.XmlBeanFactory;
import org.springframework.core.io.FileSystemResource;

import com.cimientos.intranet.enumerativos.AnioEscolar;
import com.cimientos.intranet.enumerativos.CalificacionMateria;
import com.cimientos.intranet.enumerativos.CargaHoraria;
import com.cimientos.intranet.enumerativos.Categoria;
import com.cimientos.intranet.enumerativos.Dependencia;
import com.cimientos.intranet.enumerativos.EmitioCarta;
import com.cimientos.intranet.enumerativos.EstadoMateria;
import com.cimientos.intranet.enumerativos.EstadoPago;
import com.cimientos.intranet.enumerativos.ModalidadContratacion;
import com.cimientos.intranet.enumerativos.NivelEscuela;
import com.cimientos.intranet.enumerativos.ResultadoAnioEscolar;
import com.cimientos.intranet.enumerativos.SituacionEscolarMergeada;
import com.cimientos.intranet.enumerativos.TipoBeca;
import com.cimientos.intranet.enumerativos.TipoConvocatoria;
import com.cimientos.intranet.enumerativos.TipoDni;
import com.cimientos.intranet.enumerativos.Vinculo;
import com.cimientos.intranet.enumerativos.entrevista.Compromiso;
import com.cimientos.intranet.enumerativos.entrevista.CompromisoPBE;
import com.cimientos.intranet.enumerativos.entrevista.ContenidosAbordados;
import com.cimientos.intranet.enumerativos.entrevista.DetalleGastos;
import com.cimientos.intranet.enumerativos.entrevista.EntrevistaReprogramada;
import com.cimientos.intranet.enumerativos.entrevista.EstadoEntrevista;
import com.cimientos.intranet.enumerativos.entrevista.EstrategiaComplementaria;
import com.cimientos.intranet.enumerativos.entrevista.EvaluacionCobroBeca;
import com.cimientos.intranet.enumerativos.entrevista.EvaluacionIncorporacion;
import com.cimientos.intranet.enumerativos.entrevista.EvaluacionRenovacionMergeada;
import com.cimientos.intranet.enumerativos.entrevista.EvaluacionRenovacionFinal;
import com.cimientos.intranet.enumerativos.entrevista.MotivoAusencia;
import com.cimientos.intranet.enumerativos.entrevista.MotivoCesacion;
import com.cimientos.intranet.enumerativos.entrevista.MotivoEnvioTS;
import com.cimientos.intranet.enumerativos.entrevista.MotivoNoRenovacion;
import com.cimientos.intranet.enumerativos.entrevista.MotivoPendiente;
import com.cimientos.intranet.enumerativos.entrevista.MotivoSuspension;
import com.cimientos.intranet.enumerativos.entrevista.Opciones;
import com.cimientos.intranet.enumerativos.entrevista.SituacionCrisis;
import com.cimientos.intranet.enumerativos.entrevista.TipoContacto;
import com.cimientos.intranet.enumerativos.entrevista.TipoEntrevista;
import com.cimientos.intranet.enumerativos.entrevista.motivoNoIncorporacion;

/**
 * Migrador
 * 
 * @author Juan Irungaray
 * 
 */
@SuppressWarnings("unused")
public class Migrador {
	
	private static Logger logger = Logger.getLogger("MyLog");
    
	private static FileHandler fh;

	private static Map<Long, Boletin> boletines = new HashMap<Long, Boletin>();
	
	private static Map<Long, AlumnoPanelEA> alumnos_panelEA = new HashMap<Long, AlumnoPanelEA>();

	private static Map<String, Persona> usuarios = new HashMap<String, Persona>();
	
	private static Map<String, Persona> usuarios_nombre_apellido = new HashMap<String, Persona>();

	private static Map<String, Provincia> provincias = new HashMap<String, Provincia>();

	private static Map<String, ZonaCimientos> zonas = new HashMap<String, ZonaCimientos>();
	
	private static Map<String, ZonaCimientos> zonas_nombre = new HashMap<String, ZonaCimientos>();

	private static Map<String, Localidad> localidades = new HashMap<String, Localidad>();

	private static Map<String, ConvocatoriaSeleccion> convocatorias = new HashMap<String, ConvocatoriaSeleccion>();
	
	private static Map<String, Escuela> escuelas = new HashMap<String, Escuela>();
	
	private static Map<Long, EscuelaSeleccion> escuelasSeleccion = new HashMap<Long, EscuelaSeleccion>();

	private static Map<String, CicloPrograma> ciclos = new HashMap<String, CicloPrograma>();
	
	private static Map<String, Periodo> periodos_nombre = new HashMap<String, Periodo>();
	
	private static Map<Long, PerfilAlumno> alumnos = new HashMap<Long, PerfilAlumno>();
		
	private static Map<Long, AlumnoSeleccion> alumnos_seleccion = new HashMap<Long, AlumnoSeleccion>();

	protected static final Map<Long, PerfilPadrino> padrinos = new HashMap<Long, PerfilPadrino>();

	protected static final Map<String, PerfilPadrino> padrinos_nombre = new HashMap<String, PerfilPadrino>();
	
	protected static final Map<String, Materia> materias = new HashMap<String, Materia>();
	
	private static Map<String, Banco> bancos = new HashMap<String, Banco>();
	
	protected static final String[] materiasExcel = new String[96];

	protected static Escuela ESCUELA_FALSA = new Escuela();
	
	protected static final Map<String, SucursalBanco> sucursales = new HashMap<String, SucursalBanco>();
	
	protected static final Map<Long, SucursalBanco> sucursalesIds = new HashMap<Long, SucursalBanco>();
	
	private static int DNI_FALSO = 99000000;
	public static final String FILE_HOME = "src/main/resources/datos";

	public static final BeanFactory springContext = new XmlBeanFactory(
			new FileSystemResource("src/main/webapp/WEB-INF/spring/main.xml"));

	public static final SessionFactory sessionFactory = ((SessionFactory) springContext
			.getBean("sessionFactory"));
	
	protected static final Map<String, String> paises = new HashMap<String, String>();
	
	protected static final String telefonoCimientos = "48298600";
	
	private static Map<Long, String> cuentas = new HashMap<Long, String>();
	
	private static Map<Long, EntrevistaSeleccion> entrevistasSel = new HashMap<Long, EntrevistaSeleccion>();
	
	public static void main(String[] args) {
		
		try {
			fh = new FileHandler("C:\\informacion.log", true);
		    
			logger.addHandler(fh);
		    
			logger.setLevel(Level.ALL);
			
			SimpleFormatter formatter = new SimpleFormatter();
		    
			fh.setFormatter(formatter);
		    
			chequearRA();
			
			//migrarPaises();
			
			//migrarNacionalidadAlumnos();
			
			//modificarBoletinesAlumnoPanelEA();
			
			//migrarOtroMotivoEntrevistasRenovacion2011();
			
			//eliminarBoletinesArreglarIs2();
			
			
			
			// Provincias + Zonas
			//migrarGografias();			

			//crearZonaUnica();
			
			//crearCiclosAnteriores();

			//migrarEscuelas();
			
			// Convocatorias
			//migrarConvocatorias();

			// Bancos
			//migrarBanco();

			// Padrinos Individuales
			//migrarPadrinosIndividuales();

			// Padrinos Corporativos
			//migrarPadrinosCorporativos();

			//migrarCuentasRa();
			
			// ea, rr , usuarios
			//migrarStaff();
			
			// alumnos
			//migrarAlumnos();	
			
			// entrevistas 2010
			//migrarEntrevistas();	
			
			//materias fijas
			//migrarMateriasFijas();
			
			//materias optativas
			//migrarMateriasOptativas();

			//demo();
			
			//migrarEntrevistasSeleccion();
			
			//migrarBoletin();
			
			//Migra las entrevistas del 2011, IS1, pagos
			//migrarEntrevistasRenovacion2011();
			
			//migrarEntrevistasIncorporacion2011();
			
			//migrarEntrevistasMensuales2011();
			
			
			
			System.out
					.println("*************** Migración Completa ******************");
			
		} catch (Exception e) {
			e.printStackTrace();
		}
	}


	private static void chequearRA() {
		try {
			Session session = sessionFactory.openSession();
			Transaction tx = session.beginTransaction();		
			PerfilAlumno alumno = obtenerPerfilesAlumnos(new Integer(40943960));
			ResponsableAdulto r = new ResponsableAdulto();
			r.setNombre("aaaaaa");
			r.setApellido("bbbbbb");
			r.setIdAlumno(alumno);
			alumno.setResponsable1(r);
			session.saveOrUpdate(alumno);
			tx.commit();
			session.close();
		} catch (Exception e) {
			e.printStackTrace();
		}
	}


	private static void eliminarBoletinesArreglarIs2() throws Exception 
	{	

		Parser relaciones = new Parser(new File(FILE_HOME,"is2.csv"),sessionFactory.openSession()) 
		{		
			@Override
			public void handleLine(String line, Session session, int count) 
			{
				try 
				{				
					Scanner scanner = new Scanner(line);
					scanner.useDelimiter(";");
					
					Integer dniAlumno = Integer.parseInt(scanner.next());
					Integer materiasAprobadas = Integer.parseInt(scanner.next());
					Integer materiasDesaprobadas = Integer.parseInt(scanner.next());
					Float inasistencias = Float.parseFloat(scanner.next());					
					String observaciones = scanner.next();
					session = sessionFactory.openSession();
					Transaction tx = session.beginTransaction();
					
					
					PerfilAlumno alumno = obtenerPerfilesAlumnos(dniAlumno);
					
					if (alumno != null){
						InformeIS2 is2 = obtenerIs2PorAlumno(dniAlumno, alumno.getId());
						AlumnoPanelEA ape = obtenerApe(alumno.getId());
						if (is2 != null){
							is2.setObsBoletin(observaciones);
							is2.setMateriasAprobadas(materiasAprobadas);
							is2.setMateriasDesaprobadas(materiasDesaprobadas);
							is2.setInasistencias(inasistencias);
							
							Boletin boletin = alumno.getBoletin();
							alumno.setBoletin(null);
							
							ape.setColorBoletin(ConstantesPaneles.GRAY);
							
							session.update(ape);
							if(boletin != null)
								session.delete(boletin);
							session.update(alumno);
							session.update(is2);
							tx.commit();
							session.close();									
						}
						else{
							System.out.println("No se encuentra el informe IS2 para el alumno " + dniAlumno);
						}							
					} 
					else{
						System.out.println("No se encuentra el alumno con el dni " + dniAlumno + "del archivo is2.csv");
					}
				
				}
				catch (Exception e) 
				{
					System.out.println("Ocurrio un error en el registro " + (count + 1) + " del archivos is2.csv");					
				}
			}

		};
	}


	private static void modificarBoletinesAlumnoPanelEA() throws Exception 
	{	
		Session session = sessionFactory.openSession();
		Transaction tx = session.beginTransaction();	
		List<PerfilAlumno> alumnos2011 = obtenerAlumnos2011();
		int i = 0;
		if(alumnos2011 != null)
		{
			for (PerfilAlumno alumno : alumnos2011) 
			{
				i = i + 1;
				if (alumno != null)
				{
					AlumnoPanelEA ape = obtenerApe(alumno.getId());
					if (ape != null)
					{						
						Boletin boletin = alumno.getBoletin();
						if(boletin != null)
						{
							List<MateriaPreviaDTO> materiasPrevias = obtenerMateriasPreviasDesaprobadasBoletinAnterior(boletin);
							if( materiasPrevias != null && !materiasPrevias.isEmpty())
							{
								ape.setCantidadPrevias(materiasPrevias.size());
								session.update(ape);
								
							}
						}
						
					}
					else
					{
						System.out.println("No se encuentra el alumno panel ea " + ape.getNombreApellido());
						logger.log(Level.WARNING,"No se encuentra el alumno panel ea " + ape.getNombreApellido());
					}							
				} 
				else
				{
					System.out.println("No se encuentra el alumno con el dni " + alumno.getDatosPersonales().getDni());
					logger.log(Level.WARNING,"No se encuentra el alumno con el dni " + alumno.getDatosPersonales().getDni());
				}
				
			}
			
		}
		else
		{
			System.out.println("No hay alumnos 2011");
			logger.log(Level.WARNING,"No hay alumnos 2011");
		}
		
		tx.commit();
		session.close();
		
	}
				
	

private static List<MateriaPreviaDTO> obtenerMateriasPreviasDesaprobadasBoletinAnterior(
		Boletin boletinAnterior) 
	{
	if(boletinAnterior.getPrevias() != null)
	{
	List<Trimestre> previas = boletinAnterior.getPrevias();
	List<MateriaPreviaDTO> materiasPreviasDesaprobadas = new ArrayList<MateriaPreviaDTO>();
	List<MateriaPreviaDTO> aprobadas = new ArrayList<MateriaPreviaDTO>();
	
	for (Trimestre previa : previas) {
		for (NotaMateria notaMateria : previa.getMaterias()) {
			if(notaMateria.getEstado().equals(EstadoMateria.APROBADA)){
				aprobadas.add(new MateriaPreviaDTO(notaMateria));
			}
		}
	}
	//obtengo las previas que no aprobo restando de las previas totales del boletin las previas aprobadas.
	materiasPreviasDesaprobadas = (List<MateriaPreviaDTO>) CollectionUtils.subtract(obtenerListaMateriaPreviaDTO(boletinAnterior), aprobadas);
	return materiasPreviasDesaprobadas;
	}
	else
		return null;
}

/**
 * Obtiene las materias previas en forma de lista de materiasPreviasDTO para poder mostrarlas en la vista
 * junto con su ciclo.
 * @param boletin
 * @return
 */
@SuppressWarnings("unchecked")
private static List<MateriaPreviaDTO> obtenerListaMateriaPreviaDTO(Boletin boletin){
	List<Trimestre> previas = boletin.getPrevias();
	List<MateriaPreviaDTO> materiasPreviasDto = new ArrayList<MateriaPreviaDTO>();

	if(previas != null && !previas.isEmpty()){
		//obtengo todas las materias previas (las saco del 1er trimestre_previa ya que se repiten en los 3)
		List<NotaMateria> previasPrimerTrimestre = previas.get(0).getMaterias();
		materiasPreviasDto = (List<MateriaPreviaDTO>) CollectionUtils.collect(previasPrimerTrimestre, new Transformer() {
			@Override  
			public Object transform(Object notaMateria) {  
				return new MateriaPreviaDTO((NotaMateria)notaMateria);  
			}  
		}); 

	}


	return materiasPreviasDto;
}

	private static void migrarCuentasRa() throws IOException {

		Parser paisesParser = new Parser(new File(FILE_HOME,
				"cuentas_ra.csv"), sessionFactory.openSession()) {

			@Override
			public void handleLine(String line, Session session, int count) {
				Scanner scanner = new Scanner(line);
				scanner.useDelimiter(";");
				String idAlumno = scanner.next();
				Long idAlu = Long.parseLong(idAlumno);
				String nrocuenta = "";
				if(scanner.hasNext())
					nrocuenta = scanner.next();
				
				if(StringUtils.isNotBlank(nrocuenta))
					cuentas.put(idAlu, nrocuenta);
				else
					System.out.println("La cuenta " + nrocuenta + " es vacia");

			}
		};
	}
	
	private static void migrarNacionalidadAlumnos() throws Exception 
	{	

		Parser relaciones = new Parser(new File(FILE_HOME,"alumnosNacionalidad.csv"),sessionFactory.openSession()) 
		{		
			@Override
			public void handleLine(String line, Session session, int count) 
			{
				try 
				{				
					Scanner scanner = new Scanner(line);
					scanner.useDelimiter(";");
					String dni = scanner.next();
					String nacionalidad = scanner.next();	
					String nombre = scanner.next();
					String apellido = scanner.next();
					
					session = sessionFactory.openSession();

					Transaction tx = session.beginTransaction();
					
					if(StringUtils.isNotBlank(dni))
					{	
						Integer dniAlumno = Integer.parseInt(dni);
						PerfilAlumno alumno = obtenerPerfilesAlumnos(dniAlumno);
						if (alumno != null) 
						{
							EntrevistaSeleccion es = obtenerEntrevistaSeleccion(alumno.getId());
							Persona persona = alumno.getDatosPersonales();
							if (persona != null) 
							{
								persona.setNacionalidad(getNacionalidad(nacionalidad));
								es.getPerfilAlumno().getDatosPersonales().setNacionalidad(persona.getNacionalidad());
								es.getPerfilAlumno().getDatosPersonales().setDireccion(persona.getDireccion());
								es.getPerfilAlumno().getDatosPersonales().setLocalidad(persona.getLocalidad());
								session.update(es);
								session.update(persona);
								tx.commit();									
							} 
							else 
							{
								System.out.println("No se encuentra la persona para el alumno " + alumno.getId());
								logger.log(Level.WARNING,"No se encuentra la persona para el alumno " + alumno.getId());
							}							
						} 
						else 
						{
							
							alumno = obtenerPerfilesAlumnosPorNombreApellido(nombre, apellido);
							if(alumno != null)
							{
								EntrevistaSeleccion es = obtenerEntrevistaSeleccion(alumno.getId());
								Persona persona = alumno.getDatosPersonales();
								if (persona != null) 
								{
									persona.setNacionalidad(getNacionalidad(nacionalidad));
									es.getPerfilAlumno().getDatosPersonales().setNacionalidad(persona.getNacionalidad());
									es.getPerfilAlumno().getDatosPersonales().setDireccion(persona.getDireccion());
									es.getPerfilAlumno().getDatosPersonales().setLocalidad(persona.getLocalidad());
									session.update(es);
									session.update(persona);
									tx.commit();									
								} 
								else 
								{
									System.out.println("No se encuentra la persona para el alumno con nombre y apellido" + nombre + apellido);
									logger.log(Level.WARNING,"No se encuentra la persona para el alumno con nombre y apellido" + nombre + apellido);
								}
							}
						}
					}
					else
					{
						System.out.println("El archivo tiene el DNI en blanco ");
						logger.log(Level.SEVERE, "El archivo tiene el DNI en blanco");
					}	
					session.close();
				}
				catch (Exception e) 
				{
					System.out.println("Ocurrio un error en el registro " + (count + 1) + " del archivo alumnosNacionalidad.csv");	
					logger.log(Level.SEVERE, "Ocurrio un error en el registro " + (count + 1) + " del archivo alumnosNacionalidad.csv");
				}
			}
		};
	}
	
	
	private static void migrarOtroMotivoEntrevistasRenovacion2011() throws Exception 
	{	

		Parser relaciones = new Parser(new File(FILE_HOME,"renovacionMotivoOtro.csv"),sessionFactory.openSession()) 
		{		
			@Override
			public void handleLine(String line, Session session, int count) 
			{
				try 
				{				
					Scanner scanner = new Scanner(line);
					scanner.useDelimiter(";");
					String rr = scanner.next();
					String idRR = scanner.next();
					String ea = scanner.next();
					String idEA = scanner.next();
					String idZona = scanner.next();
					String nombreZona = scanner.next();
					String idAlumnoTroop = scanner.next();
					String apellidoBecado = scanner.next();
					String nombreBecado = scanner.next();
					String tipoDni = scanner.next();
					String dni = scanner.next();
					String idAnioEscolar = scanner.next();
					String anioEscolar = scanner.next();
					String modalidad = scanner.next();
					String idEscuela = scanner.next();
					String escuela = scanner.next();
					String cambioEscuela = scanner.next();
					Formateador.quitarAcentos(cambioEscuela);
					String realizoEntrevista = scanner.next();
					Formateador.quitarAcentos(realizoEntrevista);
					String entrevistaReprogramda = scanner.next();
					String fechaEntrevista = scanner.next();
					String lugarEntrevista = scanner.next();
					String tipoEntrevista = scanner.next();
					String participoBecado = scanner.next();
					Formateador.quitarAcentos(participoBecado);
					String motivoAusencia = scanner.next();
					String motivoAusenciaOtro = scanner.next();
					String participoRA = scanner.next();
					Formateador.quitarAcentos(participoRA);
					String motivoAusenciaRA = scanner.next();
					String motivoAusenciaRAotro = scanner.next();				
					String evaluacionDiciembreEvaluacionRenovacion = scanner.next();
					String diciembreSituacionEscolar = scanner.next();
					String renovacionBeca2011 = scanner.next();
					String motivoNoRenovacion = scanner.next();
					String detalleMotivoNoRenovacion = scanner.next();
					String motivoPendiente = scanner.next();
					String detalleMotivoPendienteOtro = scanner.next();
					String situacionEscolar = scanner.next();
					String certificadoAlumnoRegular = scanner.next();
					String notasFinalesBoletin = scanner.next();
					String detalleMateriasPrevias = scanner.next();
					String obsMateriasExamen = scanner.next();				
					String firmaActaCompromiso = scanner.next();
					String firmaAutorizacionCierreCaja = scanner.next();
					String firmaAutImagen = scanner.next();
					String fotocopiaBoletin = scanner.next();
					String materialCompleto = scanner.next();
					String entregaMaterialCimientos = scanner.next();
					String escolaridadCompromiso = scanner.next();
					String actividadesVacaciones = scanner.next();
					String propositoAnio = scanner.next();
					String expectativasRA = scanner.next();
					String utilizacionBeca = scanner.next();				
					String obsEntrevistaREnovacion = scanner.next();
					String proximaEntrevista = scanner.next();
					String lugarProximaEntrevista = scanner.next();
					String periodoPago = scanner.next();
					String evaluacionCobroBeca  = scanner.next();
					String motivoSuspension = scanner.next();
					String quienCargaEntrevista = scanner.next();
					String cicloLectivo = scanner.next();
					String fechaIncorporacionPBE = scanner.next();
					String fechaNacimiento = scanner.next();
					String edad = scanner.next();				
					String idVinculaRA = scanner.next();
					String vinculaRABecado = scanner.next();
					String localidadBecado = scanner.next();
					String tipoInforme = scanner.next();
					String estadoInformeAPadrino = scanner.next();				
					String idPadrinoTroop = scanner.next();				
					String tipoPadrino = scanner.next();
					String padrino = scanner.next();
					String mailPadrinoTO = scanner.next();
					String mailsPadrinoCC = scanner.next();
					String nombrePadrino = scanner.next();
					String apellidoPadrino = scanner.next();
					String banco = scanner.next();
					String dniRA = scanner.next();
					String cuilRA = scanner.next();
					String nroCuentaRA = scanner.next();
					String apellidoNombreRA = scanner.next();
					String montoBeca;
					if(scanner.hasNext())
						montoBeca = scanner.next();
					
					session = sessionFactory.openSession();

					Transaction tx = session.beginTransaction();
					
					if(renovacionBeca2011.equalsIgnoreCase("Pendiente") && motivoPendiente.equalsIgnoreCase("Otro"))
					{	
						Integer dniAlumno = Integer.parseInt(dni);
						PerfilAlumno alumno = obtenerPerfilesAlumnos(dniAlumno);
						if (alumno != null) 
						{
							EntrevistaRenovacion entrevista = obtenerEntrevistaRenovacionPorAlumno(dniAlumno, alumno.getId());
							if (entrevista != null) 
							{
								entrevista.setMotivoOtro(detalleMotivoPendienteOtro);
								session.update(entrevista);
								tx.commit();
								session.close();
									
							} 
							else 
							{
								System.out.println("No se encuentra la entrevista de renovación para el alumno " + apellidoBecado + ","+ nombreBecado);
							}							
						} 
						else 
						{
							System.out.println("No se encuentra el alumno con el dni " + dniAlumno + "del archivo renovacionMotivoOtro.csv");
						}
					}
					else
						System.out.println("El archivo no tiene los datos que deberían!!!!");
				}
				catch (Exception e) 
				{
					System.out.println("Ocurrio un error en el registro " + (count + 1) + " del archivos renovacionMotivoOtro.csv");					
				}
			}
		};
	}
	
	
	private static void migrarEntrevistasRenovacion2011() throws Exception {
		
		Parser relaciones = new Parser(new File(FILE_HOME,"renovacion2011.csv"),sessionFactory.openSession()) {
			
			@Override
			public void handleLine(String line, Session session, int count) {
				try {				
					Scanner scanner = new Scanner(line);
					scanner.useDelimiter(";");
					String rr = scanner.next();
					String idRR = scanner.next();
					String ea = scanner.next();
					String idEA = scanner.next();
					String idZona = scanner.next();
					String nombreZona = scanner.next();
					String idAlumnoTroop = scanner.next();
					String apellidoBecado = scanner.next();
					String nombreBecado = scanner.next();
					String tipoDni = scanner.next();
					String dni = scanner.next(); 
					String idAnioEscolar = scanner.next();
					String anioEscolar = scanner.next();
					String modalidad = scanner.next();
					String idEscuela = scanner.next();
					String escuela = scanner.next();
					String cambioEscuela = scanner.next();
					Formateador.quitarAcentos(cambioEscuela);
					String realizoEntrevista = scanner.next();
					Formateador.quitarAcentos(realizoEntrevista);
					String entrevistaReprogramda = scanner.next();
					String fechaEntrevista = scanner.next();
					String lugarEntrevista = scanner.next();
					String tipoEntrevista = scanner.next();
					String participoBecado = scanner.next();
					Formateador.quitarAcentos(participoBecado);
					String motivoAusencia = scanner.next();
					String motivoAusenciaOtro = scanner.next();
					String participoRA = scanner.next();
					Formateador.quitarAcentos(participoRA);
					String motivoAusenciaRA = scanner.next();
					String motivoAusenciaRAotro = scanner.next();				
					String evaluacionDiciembreEvaluacionRenovacion = scanner.next();
					String diciembreSituacionEscolar = scanner.next();
					String renovacionBeca2011 = scanner.next();
					String motivoNoRenovacion = scanner.next();
					String detalleMotivoNoRenovacion = scanner.next();
					String motivoPendiente = scanner.next();
					String detalleMotivoPendienteOtro = scanner.next();
					String situacionEscolar = scanner.next();
					String certificadoAlumnoRegular = scanner.next();
					String notasFinalesBoletin = scanner.next();
					String detalleMateriasPrevias = scanner.next();
					String obsMateriasExamen = scanner.next();				
					String firmaActaCompromiso = scanner.next();
					String firmaAutorizacionCierreCaja = scanner.next();
					String firmaAutImagen = scanner.next();
					String fotocopiaBoletin = scanner.next();
					String materialCompleto = scanner.next();
					String entregaMaterialCimientos = scanner.next();
					String escolaridadCompromiso = scanner.next();
					String actividadesVacaciones = scanner.next();
					String propositoAnio = scanner.next();
					String expectativasRA = scanner.next();
					String utilizacionBeca = scanner.next();				
					String obsEntrevistaREnovacion = scanner.next();
					String proximaEntrevista = scanner.next();
					String lugarProximaEntrevista = scanner.next();
					String periodoPago = scanner.next();
					String evaluacionCobroBeca  = scanner.next();
					String motivoSuspension = scanner.next();
					String quienCargaEntrevista = scanner.next();
					String cicloLectivo = scanner.next();
					String fechaIncorporacionPBE = scanner.next();
					String fechaNacimiento = scanner.next();
					String edad = scanner.next();				
					String idVinculaRA = scanner.next();
					String vinculaRABecado = scanner.next();
					String localidadBecado = scanner.next();
					String tipoInforme = scanner.next();
					String estadoInformeAPadrino = scanner.next();				
					String idPadrinoTroop = scanner.next();				
					String tipoPadrino = scanner.next();
					String padrino = scanner.next();
					String mailPadrinoTO = scanner.next();
					String mailsPadrinoCC = scanner.next();
					String nombrePadrino = scanner.next();
					String apellidoPadrino = scanner.next();
					String banco = scanner.next();
					String dniRA = scanner.next();
					String cuilRA = scanner.next();
					String nroCuentaRA = scanner.next();
					String apellidoNombreRA = scanner.next();
					String montoBeca;
					if(scanner.hasNext())
						montoBeca = scanner.next();
					
					PerfilAlumno alumno = alumnos.get(new Long(idAlumnoTroop));
					Persona personaRR = usuarios.get(idRR);
					Persona personaEa = usuarios.get(idEA);
					Escuela escuelaAlumno = escuelas.get(idEscuela);
					PerfilPadrino padrinoAlumno = null;
					if(StringUtils.isNotBlank(idPadrinoTroop))
					{
						Long idP = Long.parseLong(idPadrinoTroop);
						padrinoAlumno = (padrinos.get(idP));
					}
												
					if(alumno != null){
						if (personaEa != null) {
							if (personaRR != null){
								if(escuelaAlumno != null){		
									if(padrinoAlumno != null){	
										
										AlumnoPanelEA ape = alumnos_panelEA.get(alumno.getId());
										ape.setActivo(true);
										ape.setIdPerfilEA(personaEa.getPerfilEA().getIdPerfilEA());
										alumno.setEa(personaEa.getPerfilEA());
										alumno.setEscuela(escuelaAlumno);
										Beca beca = obtenerBeca(padrinoAlumno,alumno);
										Periodo periodo = null;
										if(beca != null){											
											alumno.setBeca(beca);
											periodo = buscarPeriodoPorNombre(alumno.getBeca().getCiclo(), periodoPago);
											ape.setFechaAltaBeca(periodo.getFechaInicio());
											alumno.setFechaAltaBeca(ape.getFechaAltaBeca());
										}
										else{
											if(alumno.getEstadoAlumno() != EstadoAlumno.PENDIENTE_RENOVACION_CON_ASIGNACION){												
												System.out.println("No se encuentra una beca para el alumno idTroop " + idAlumnoTroop + ". El padrino " +
														"no tiene becas para la zona " + alumno.getEscuela().getLocalidad().getZona().getNombre() 
														+ ".Registro " + (count + 1));
												return;
											}
											else{
												periodo = buscarPeriodoPorNombre(alumno.getBeca().getCiclo(), periodoPago);
											}
										}
										EntrevistaRenovacion entrevista = new EntrevistaRenovacion();
										entrevista.setPagaEntrevista(true);
										entrevista.setRr(personaRR.getPerfilRR());
										entrevista.setEa(personaEa.getPerfilEA());
										entrevista.setPerfilAlumno(alumno);
										if(StringUtils.isNotBlank(idAnioEscolar))
										{
											AnioEscolar anioEscolar1 = AnioEscolar.getAnioEscolar(Integer.parseInt(idAnioEscolar));
											entrevista.setAnioEscolar(anioEscolar1);
											alumno.setAnioEscolar(anioEscolar1);
											ape.setAnio(anioEscolar1);
										}
										
										entrevista.setEscuelaAlumno(escuelaAlumno);
										entrevista.setCambioEscuela(cambioEscuela.equalsIgnoreCase("si")?true:false);
										entrevista.setRealizoEntrevista(realizoEntrevista.equalsIgnoreCase("si")?true:false);
										entrevista.setEntrevistaReprogramada(obtenerEntrevistaReprogramada(entrevistaReprogramda));
										
										
										SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy");
										Date fecha;
										if(StringUtils.isNotBlank(fechaEntrevista)){
											fecha = sdf.parse(fechaEntrevista);
											entrevista.setFechaEntrevista(fecha);
											entrevista.setFechaCarga(fecha);
										}
										else{
											entrevista.setFechaCarga(alumno.getFechaAltaBeca());
										}

										agregarExportacionEspecial(entrevista, alumno, null, alumno.getBeca(), session);
										
										if(StringUtils.isNotBlank(lugarEntrevista))
											entrevista.setLugarEntrevista(escuelas.get(lugarEntrevista));
										
										entrevista.setTipoEntrevista(TipoEntrevista.RENOVACION);
										entrevista.setParticipoBecado(participoBecado.equalsIgnoreCase("si")?true:false);
										
										obtenerMotivoAusencia(motivoAusencia.toLowerCase(),motivoAusenciaOtro, entrevista);
													
										entrevista.setParticipoRA(participoRA.equalsIgnoreCase("si")?true:false);
										
										obtenerMotivoAusenciaRA(motivoAusenciaRA.toLowerCase(),	motivoAusenciaRAotro, entrevista);									
																			
										obtenerEvaluacionRenovacionDiciembre(evaluacionDiciembreEvaluacionRenovacion.toLowerCase(),entrevista);									
	
										obtenerSituacionEscolarDiciembre(diciembreSituacionEscolar.toLowerCase(),	entrevista);
										
										obtenerEvaluacionRenovacion(renovacionBeca2011,entrevista,motivoNoRenovacion,
												detalleMotivoNoRenovacion,detalleMotivoPendienteOtro,motivoPendiente,alumno,ape);
	
										obtenerSituacionEscolar(situacionEscolar.toLowerCase(),entrevista);
										
										entrevista.setCertificadoAlumnoRegular(obtenerOpciones(certificadoAlumnoRegular));									
						
										entrevista.setObservacionMateriasExamenes(obsMateriasExamen);
										entrevista.setFirmaActaCompromiso(obtenerOpciones(firmaActaCompromiso));
										entrevista.setFirmaAutorizacionCierreCaja(obtenerOpciones(firmaAutorizacionCierreCaja));
										entrevista.setFirmaAutorizacionImagen(obtenerOpciones(firmaAutImagen));
										entrevista.setFotocipiaBoletin(obtenerOpciones(fotocopiaBoletin));
										Formateador.quitarAcentos(materialCompleto);
										entrevista.setMaterialCompleto(materialCompleto.equalsIgnoreCase("si")?true:false);
										Formateador.quitarAcentos(entregaMaterialCimientos);
										entrevista.setEntregaMaterial(entregaMaterialCimientos.equalsIgnoreCase("si")?true:false);
										entrevista.setEscolaridadCompromisoAnterior(escolaridadCompromiso);
										entrevista.setRealizadoVacaciones(actividadesVacaciones);
										entrevista.setPropositoAnioComienza(propositoAnio);
										entrevista.setExpectativasRA(expectativasRA);

										//obtenerDestinoDinero(entrevista,utilizacionBeca);
										
										entrevista.setObservacionesGenerales(obsEntrevistaREnovacion);
										
										Date proximaFecha;
										if(StringUtils.isNotBlank(proximaEntrevista)){
											proximaFecha = sdf.parse(proximaEntrevista);
											entrevista.setProximaEntrevista(proximaFecha);										
										}
										if(StringUtils.isNotBlank(lugarProximaEntrevista))
											entrevista.setLugarProximaEntrevista(escuelas.get(lugarProximaEntrevista));
										
										
										entrevista.setPeriodoDePago(periodo);
										
										obtenerEvaluacionCobroBeca(evaluacionCobroBeca,entrevista,motivoSuspension);
										
										entrevista.setEstadoEntrevista(EstadoEntrevista.FINALIZADA);
										ape.setEntrevistasFinalizadas(true);
										
										
										ape.incrementarEntrevista(entrevista.getEstadoEntrevista());
										ape.actualizarEntrevista(entrevista.getEstadoEntrevista());
										Pago pagoBecado = null;
										if(!entrevista.getEvaluacionRenovacionMergeada().equals(EvaluacionRenovacionMergeada.NO_RENUEVA)){
											pagoBecado = crearPagoBecado(alumno,entrevista,periodo);
											ape.incrementarPago(pagoBecado.getEstadoPago());
											ape.actualizarSemaforoPago(pagoBecado.getEstadoPago());
										}
										
										InformeIS1 is1 = null;
										if(alumno.getEstadoAlumno().equals(EstadoAlumno.RENOVADO)){											
											is1 = generarInformeSI1(alumno.getBeca().getPadrino(), entrevista, alumno.getBeca(), alumno, ape);
										}

										session.saveOrUpdate(entrevista);
										
										if(beca != null)
											session.saveOrUpdate(beca);
										
										session.update(alumno);
										
										if(is1 != null)
											session.saveOrUpdate(is1);
										
										if(pagoBecado != null)
											session.saveOrUpdate(pagoBecado);
										
										Pago pagoEa = crearPagoEa(entrevista,alumno,periodo);
										
										
										
										session.saveOrUpdate(ape);
										session.saveOrUpdate(pagoEa);
									}
									else{
										System.out.println("El padrino cuyo id es " + idPadrinoTroop + " no existe");
									}								
								}
								else{
									System.out.println("La escuela cuyo id es " + idEscuela + " no existe");
								}
							}
							else{
								System.out.println("El RR cuyo id es " + idRR + " no existe");
							}
						}
						else{
							System.out.println("El EA cuyo id es " + idEA + " no existe");
						}
					}
					else{
						System.out.println("El alumno cuyo id es " + idAlumnoTroop + " no existe");
					}
				} catch (Exception e) {
					System.out.println("Ocurrio un error en el registro " + (count + 1) + " del archivos renovacion2011.csv");					
				}
			}

			private InformeIS1 generarInformeSI1(PerfilPadrino padrino,
					EntrevistaRenovacion entrevista, Beca beca,
					PerfilAlumno alumno, AlumnoPanelEA ape) {

				//Se genera el informeIS1
				InformeIS1 informe = new InformeIS1();
				informe.setBecado(alumno);
				informe.setEr(entrevista);
				informe.setBeca(beca);
				//Boletin anio anterior
				Boletin boletinAnterior = boletines.get(alumno.getId());
				informe.setBoletinAnioAnterior(boletinAnterior);
				informe.setCicloActual(ciclos.get("2011"));
				informe.setFechaAlta(new Date());
				informe.setEstado(EstadoInforme.FINALIZADO);
//				informe.setSituacion(informe.getEr().getSituacionEscolar());
				informe.setSituacion(informe.getEr().getSituacionEscolarMergeada());
				informe.setEaPerfil(alumno.getEa());
				informe.setRrPerfil(alumno.getEa().getRr());
				informe.setNombre(ConstantesInformes.nombreInformeIS1);	
				Calendar calendarHoy = GregorianCalendar.getInstance();
				calendarHoy.setTime(new Date());
				Calendar calendarNac = GregorianCalendar.getInstance();
				calendarNac.setTime(alumno.getDatosPersonales().getFechaNacimiento());
				Integer edad = calendarHoy.get(Calendar.YEAR) - calendarNac.get(Calendar.YEAR);
				informe.setEdad(edad);
				informe.setFechaPBE(alumno.getFechaPBE());	
				informe.setPadrino(padrino);
				informe.setEscolaridadCompromisoAnterior(informe.getEr().getEscolaridadCompromisoAnterior());
				informe.setPropositoAnioComienza(informe.getEr().getPropositoAnioComienza());
				informe.setObservaciones(informe.getEr().getObservacionesGenerales());
				informe.setObservacionMateriasExamenes(informe.getEr().getObservacionMateriasExamenes());
				informe.setActividadesVacaciones(informe.getEr().getRealizadoVacaciones());
				informe.setExpectativasRA(informe.getEr().getExpectativasRA());
				String utilizacion = "";
				if(informe.getEr().getDestinoDinero() != null){
					for (DetalleGastos detalle : informe.getEr().getDestinoDinero()) {
						utilizacion = utilizacion + detalle.getValor() + ", ";
					} 
				}	
				informe.setUtilizacionBeca(utilizacion);
				informe.setFechaUltimaModificacion(new Date());
				//Se modifica el alumnoPanelEa, se cambia de color el boletin(se mando el anterior al historial) y cambia el color del IS1
				ape.setColorBoletin(ConstantesPaneles.GRAY);
				ape.setColorIS1(ConstantesPaneles.GREEN);
			
				entrevista.getExportacionEspecial().setIdInforme(informe.getId());
				
				return informe;
			}


			private Pago crearPagoBecado(PerfilAlumno a, EntrevistaRenovacion entrevista, Periodo periodo) {
				Pago pagoBeca = new Pago();
				pagoBeca.setBecado(a);
				pagoBeca.setExtra(new Double(0));
				if (entrevista.getEvaluacionCobroBeca().equals(EvaluacionCobroBeca.APROBADO))
					pagoBeca.setEstadoPago(EstadoPago.APROBADO);
				else if (entrevista.getEvaluacionCobroBeca().equals(EvaluacionCobroBeca.SUSPENDIDO))
				{
					pagoBeca.setEstadoPago(EstadoPago.SUSPENDIDO);					
				}
				else if (entrevista.getEvaluacionCobroBeca().equals(EvaluacionCobroBeca.NO_APLICA))
					pagoBeca.setEstadoPago(EstadoPago.NO_APLICA);
				pagoBeca.setPeriodo(periodo);
				pagoBeca.setMonto(a.getBeca().getCiclo().getMontoBeca());
				pagoBeca.setFechaAprobacionRR(new Date());
				
				return pagoBeca;
			}

			private void obtenerEvaluacionCobroBeca(String evaluacionCobroBeca,
					EntrevistaRenovacion entrevista, String motivoSuspension) {

				if(evaluacionCobroBeca.equalsIgnoreCase("Aprobado"))
					entrevista.setEvaluacionCobroBeca(EvaluacionCobroBeca.APROBADO);
				else
					if(evaluacionCobroBeca.equalsIgnoreCase("Suspendido")){
						entrevista.setEvaluacionCobroBeca(EvaluacionCobroBeca.SUSPENDIDO);
						entrevista.setMotivoSuspension(obtenerMotivoSuspension(Formateador.quitarAcentos(motivoSuspension.toLowerCase())));						
					}
					else
						if(evaluacionCobroBeca.equalsIgnoreCase("Dudoso"))
							entrevista.setEvaluacionCobroBeca(EvaluacionCobroBeca.DUDOSO);
						else
							if(evaluacionCobroBeca.equalsIgnoreCase("Cesado"))
								entrevista.setEvaluacionCobroBeca(EvaluacionCobroBeca.CESADO);
							else
								if(evaluacionCobroBeca.equalsIgnoreCase(""))
									entrevista.setEvaluacionCobroBeca(EvaluacionCobroBeca.NULO);
								else
									entrevista.setEvaluacionCobroBeca(EvaluacionCobroBeca.NO_APLICA);
				
			}

			private MotivoSuspension obtenerMotivoSuspension(String motivoSuspension) {
				
				if((motivoSuspension.equalsIgnoreCase("Desempeño escolar insuficiente")||(contiene(motivoSuspension,"desempeño","escolar"))))
					return MotivoSuspension.DESEMPENO;
				else
					if((motivoSuspension.equalsIgnoreCase("Inasistencia a entrevista sin justificacion")||(contiene(motivoSuspension,"entrevista","justificacion"))))
						return MotivoSuspension.INASISTENCIAESJ;
					else
						if((motivoSuspension.equalsIgnoreCase("2 inasistencias consecutivas a entrevistas bdo/RA")||(contiene(motivoSuspension,"insistencias","consecutivas"))))
							return MotivoSuspension.INASISTENCIACE;
						else
							if((motivoSuspension.equalsIgnoreCase("Inasistencia a la Jornada sin justificacion")||(contiene(motivoSuspension,"inasistencia","jornada"))))
								return MotivoSuspension.INASISTENCIAJ;
							else
								if((motivoSuspension.equalsIgnoreCase("Mas de 5 faltas a clase o 10 por trimestre ")||(contiene(motivoSuspension,"faltas","trimestre"))))
									return MotivoSuspension.FALTAS;
								else
									if((motivoSuspension.equalsIgnoreCase("Perdida de condicion de alumno regular")||(contiene(motivoSuspension,"condicion","regular"))))
										return MotivoSuspension.PERDIDAREGULAR;
									else
										if((motivoSuspension.equalsIgnoreCase("Conducta insuficiente")||(contiene(motivoSuspension,"insuficiente","Conducta"))))
											return MotivoSuspension.CONDUCTA;
										else
											return MotivoSuspension.FALTAMATERIAL;
			}

			private void obtenerSituacionEscolar(String situacionEscolar,EntrevistaRenovacion entrevista) {
				Formateador.quitarAcentos(situacionEscolar);
				
				if (!situacionEscolar.equalsIgnoreCase("Seleccione")){
					
					if((situacionEscolar.equalsIgnoreCase("Promovido con previas")||(contiene(situacionEscolar,"promovido","previas"))))
//						entrevista.setSituacionEscolar(SituacionEscolar.CONPREVIAS);
						entrevista.setSituacionEscolarMergeada(SituacionEscolarMergeada.PROMOVIDO_CON_PREVIAS);	//!!!
					else
						if(situacionEscolar.equalsIgnoreCase("Promovido"))
//							entrevista.setSituacionEscolar(SituacionEscolar.PROMOVIDO);
							entrevista.setSituacionEscolarMergeada(SituacionEscolarMergeada.PROMOVIDO);		//!!!
						else
							if(situacionEscolar.equalsIgnoreCase("Pendiente"))
//								entrevista.setSituacionEscolar(SituacionEscolar.PENDIENTE);
								entrevista.setSituacionEscolarMergeada(SituacionEscolarMergeada.PENDIENTE);
							else
//								entrevista.setSituacionEscolar(SituacionEscolar.REPITIO);
								entrevista.setSituacionEscolarMergeada(SituacionEscolarMergeada.REPITIO);	//!!!
				}
			}

			private void obtenerEvaluacionRenovacion(String renovacionBeca2011,
					EntrevistaRenovacion entrevista, String motivoNoRenovacion,
					String detalleMotivoNoRenovacion,
					String detalleMotivoPendienteOtro, String motivoPendiente, PerfilAlumno alumno, AlumnoPanelEA ape) {
				
			 
				if(renovacionBeca2011.equalsIgnoreCase("Renueva")){
					entrevista.setEvaluacionRenovacionMergeada(EvaluacionRenovacionMergeada.RENUEVA);
					alumno.setEstadoAlumno(EstadoAlumno.RENOVADO);
					ape.setRenovacionPendiente(false);
					alumno.getHistorialBoletin().add(alumno.getBoletin());
					alumno.setBoletin(null);
				}
				else
					if(renovacionBeca2011.equalsIgnoreCase("No renueva")){
						entrevista.setEvaluacionRenovacionMergeada(EvaluacionRenovacionMergeada.NO_RENUEVA);						
						obtenerMotivoNoRenovacion(motivoNoRenovacion.toLowerCase(),entrevista);
						//TODO chequear que este campo sea el correcto. Se puede comparar como se carga la jsp
						entrevista.setMotivoOtro(detalleMotivoNoRenovacion);
						alumno.setEstadoAlumno(EstadoAlumno.NO_RENOVADO);
						ape.setActivo(false);
						desasignarBecaBecado(alumno);
						alumno.setFechaBaja(new Date());
					}
					else{
						entrevista.setEvaluacionRenovacionMergeada(EvaluacionRenovacionMergeada.PENDIENTE);
						obtenerMotivoPendiente(motivoPendiente.toLowerCase(),entrevista,detalleMotivoPendienteOtro);
						alumno.setEstadoAlumno(EstadoAlumno.PENDIENTE_RENOVACION_CON_ASIGNACION);
						ape.setRenovacionPendiente(true);									
					}
				
			}

			private void obtenerMotivoPendiente(String motivoPendiente,EntrevistaRenovacion entrevista, String detalleMotivoPendienteOtro) {
				
				Formateador.quitarAcentos(detalleMotivoPendienteOtro);
				if (!motivoPendiente.equalsIgnoreCase("seleccione")){
					
					if((motivoPendiente.equalsIgnoreCase("Aun debe rendir materias")||(contiene(motivoPendiente,"rendir","materias"))))
						entrevista.setMotivoPendiente(MotivoPendiente.DEBERENDIR);
					else
						if((motivoPendiente.equalsIgnoreCase("Todavia no se ha podido localizar")||(contiene(motivoPendiente,"podido","localizar"))))
							entrevista.setMotivoPendiente(MotivoPendiente.LOCALIZAR);
						else{						
							//entrevista.setMotivoPendiente(MotivoPendiente.OTRO);
							//TODO ver que campo se usa para esta propiedad
							//entrevista.setMotivoOtro(detalleMotivoPendienteOtro);
						}
				}
			}

			private void obtenerMotivoNoRenovacion(String motivoNoRenovacion,EntrevistaRenovacion entrevista) {				
				Formateador.quitarAcentos(motivoNoRenovacion);
				if (!motivoNoRenovacion.equalsIgnoreCase("Seleccione")){
				
					if((motivoNoRenovacion.equalsIgnoreCase("Bajo compromiso con el PBE")||(contiene(motivoNoRenovacion,"bajo","compromiso"))))
						entrevista.setMotivoNoRenovacion(MotivoNoRenovacion.BAJOCOMPROMISO);
					else
						if((motivoNoRenovacion.equalsIgnoreCase("Cambio en la situacion economica")||(contiene(motivoNoRenovacion,"situacion","economica"))))
							entrevista.setMotivoNoRenovacion(MotivoNoRenovacion.CAMBIOSITUACIONECO);
						else
							if(motivoNoRenovacion.equalsIgnoreCase("Repitencia"))
								entrevista.setMotivoNoRenovacion(MotivoNoRenovacion.REPITENCIA);
							else
								if((motivoNoRenovacion.equalsIgnoreCase("Renuncia a la beca")||(contiene(motivoNoRenovacion,"renuncia","beca"))))
									entrevista.setMotivoNoRenovacion(MotivoNoRenovacion.RENUNCIABECA);
								else
									if(motivoNoRenovacion.equalsIgnoreCase("Mudanza"))
										entrevista.setMotivoNoRenovacion(MotivoNoRenovacion.MUDANZA);
									else
										if((motivoNoRenovacion.equalsIgnoreCase("Abandono escolar")||(contiene(motivoNoRenovacion,"abandono","escolar"))))
											entrevista.setMotivoNoRenovacion(MotivoNoRenovacion.ABANDONO);
										else
											if((motivoNoRenovacion.equalsIgnoreCase("Cambio de escuela")||(contiene(motivoNoRenovacion,"cambio","escuela"))))
												entrevista.setMotivoNoRenovacion(MotivoNoRenovacion.CAMBIOESCUELA);
											else
												entrevista.setMotivoNoRenovacion(MotivoNoRenovacion.MATERIASPREVIAS);
				}
			}

			private void obtenerSituacionEscolarDiciembre(
					String diciembreSituacionEscolar,
					EntrevistaRenovacion entrevista) {
				Formateador.quitarAcentos(diciembreSituacionEscolar);
				if(!diciembreSituacionEscolar.equalsIgnoreCase("Seleccione")){
					
					if(diciembreSituacionEscolar.equalsIgnoreCase("Pendiente"))
//						entrevista.setSituacionEscolarDiciembre(ResultadoAnioEscolar.PENDIENTE);
						entrevista.setSituacionEscolarDiciembre(SituacionEscolarMergeada.PENDIENTE);	//!!!
					else
						if(diciembreSituacionEscolar.equalsIgnoreCase("Promovido"))
//							entrevista.setSituacionEscolarDiciembre(ResultadoAnioEscolar.PROMOVIDO);
							entrevista.setSituacionEscolarDiciembre(SituacionEscolarMergeada.PROMOVIDO);	//!!!
						else
							if(diciembreSituacionEscolar.equalsIgnoreCase("Egreso"))
//								entrevista.setSituacionEscolarDiciembre(ResultadoAnioEscolar.EGRESO);
								entrevista.setSituacionEscolarDiciembre(SituacionEscolarMergeada.EGRESO);	//!!!
							else
								if((diciembreSituacionEscolar.equals("Promovido con previas")||(contiene(diciembreSituacionEscolar,"promovido","previas"))))
//									entrevista.setSituacionEscolarDiciembre(ResultadoAnioEscolar.PROMOVIDO_CON_PREVIAS);
									entrevista.setSituacionEscolarDiciembre(SituacionEscolarMergeada.PROMOVIDO_CON_PREVIAS);	//!!!
								else
//									entrevista.setSituacionEscolarDiciembre(ResultadoAnioEscolar.REPITIO);
									entrevista.setSituacionEscolarDiciembre(SituacionEscolarMergeada.REPITIO);	//!!!
				}
			}

			private void obtenerEvaluacionRenovacionDiciembre(
					String evaluacionDiciembreEvaluacionRenovacion,
					EntrevistaRenovacion entrevista) {
				Formateador.quitarAcentos(evaluacionDiciembreEvaluacionRenovacion);
				if (!evaluacionDiciembreEvaluacionRenovacion.equalsIgnoreCase("Seleccione")){
					
					if(evaluacionDiciembreEvaluacionRenovacion.equalsIgnoreCase("En condiciones de renovar")|| contiene(evaluacionDiciembreEvaluacionRenovacion, "condiciones", "renovar"))
						entrevista.setEvaluacionRenovacionFinal(EvaluacionRenovacionFinal.EN_CONDICIONES_DE_RENOVAR);
					else
						if(evaluacionDiciembreEvaluacionRenovacion.equalsIgnoreCase("No renueva"))
							entrevista.setEvaluacionRenovacionFinal(EvaluacionRenovacionFinal.NO_RENUEVA);
						else
							entrevista.setEvaluacionRenovacionFinal(EvaluacionRenovacionFinal.PENDIENTE);
				}
			}

			private EntrevistaReprogramada obtenerEntrevistaReprogramada(String entrevistaReprogramda) {
				if(entrevistaReprogramda.equalsIgnoreCase("1 Vez"))
					return EntrevistaReprogramada.UNAVEZ;
				else
					if(entrevistaReprogramda.equalsIgnoreCase("2 Veces"))
						return EntrevistaReprogramada.DOSVECES;
					else
						if(entrevistaReprogramda.equalsIgnoreCase("Mas de 2 veces"))
							return EntrevistaReprogramada.MASDEDOS;
						else
							return EntrevistaReprogramada.NO;
			}
			
		};
	}

	private static void migrarEntrevistasIncorporacion2011() throws Exception {
			
			Parser relaciones = new Parser(new File(FILE_HOME,"incorporacion2011.csv"),sessionFactory.openSession()) {
				
				@Override
				public void handleLine(String line, Session session, int count) {
					
					try {				
						Scanner scanner = new Scanner(line);
						scanner.useDelimiter(";");
						String rr = scanner.next();
						String idRR = scanner.next();
						String ea = scanner.next();
						String idEA = scanner.next();
						String idZona = scanner.next();
						String nombreZona = scanner.next();
						String idAlumnoTroop = scanner.next();
						String fechaAltaBeca= scanner.next();
						String apellidoBecado = scanner.next();
						String nombreBecado = scanner.next();
						String tipoDni = scanner.next();
						String dni = scanner.next(); 
						String idAnioEscolar = scanner.next();
						String anioEscolar = scanner.next();
						String modalidad = scanner.next();
						String idEscuela = scanner.next();
						String escuela = scanner.next();
						String cambioEscuela = scanner.next();
						String realizoEntrevista = scanner.next();
						Formateador.quitarAcentos(realizoEntrevista);
						String entrevistaReprogramda = scanner.next();
						String tipoContacto = scanner.next();
						String incorpora = scanner.next();
						String motivoNoIncorporacion = scanner.next();
						String otroMotivoNoIncorporacion = scanner.next();
						String fechaEntrevista = scanner.next();
						String lugarEntrevista = scanner.next();
						String participoBecado = scanner.next();
						Formateador.quitarAcentos(participoBecado);
						String motivoAusencia = scanner.next();
						String motivoAusenciaOtro = scanner.next();
						String participoRA = scanner.next();
						Formateador.quitarAcentos(participoRA);
						String motivoAusenciaRA = scanner.next();
						String motivoAusenciaRAotro = scanner.next();	
						String certificadoAlumnoRegular = scanner.next();
						String entregaMaterialCimientos = scanner.next();
						Formateador.quitarAcentos(entregaMaterialCimientos);
						String firmaActaCompromiso = scanner.next();
						String firmaAutorizacionCierreCaja = scanner.next();
						String firmaAutImagen = scanner.next();
						String fotocopiaBoletin = scanner.next();
						String notasFinalesBoletin = scanner.next();
						String obsMateriasExamen = scanner.next();				
						String materialCompleto = scanner.next();
						Formateador.quitarAcentos(materialCompleto);
						String propositoAnio = scanner.next();
						String expectativasRA = scanner.next();
						String utilizacionBeca = scanner.next();				
						String obsGenerales = scanner.next();
						String periodoPago = scanner.next();
						String evaluacionCobroBeca  = scanner.next();
						String proximaEntrevista = scanner.next();
						String lugarProximaEntrevista = scanner.next();
						String quienCargaEntrevista = scanner.next();
						String cicloLectivo = scanner.next();
						String idPadrinoTroop = scanner.next();				
						String tipoPadrino = scanner.next();
						String padrino = scanner.next();
						String mailPadrinoTO = scanner.next();
						String mailsPadrinoCC = scanner.next();
						String nombrePadrino = scanner.next();
						String apellidoPadrino = scanner.next();
						String banco = scanner.next();
						String apellidoNombreRA = scanner.next();
						String dniRA = scanner.next();
						String cuilRA = scanner.next();
						String nroCuentaRA = scanner.next();
						String montoBeca =null;	
						if (scanner.hasNext())
							montoBeca = scanner.next();
							
						
						PerfilAlumno alumno = alumnos.get(new Long(idAlumnoTroop));
						Persona personaRR = usuarios.get(idRR);
						Persona personaEa = usuarios.get(idEA);
						Escuela escuelaAlumno = escuelas.get(idEscuela);
						PerfilPadrino padrinoAlumno = null;
						if(StringUtils.isNotBlank(idPadrinoTroop))
						{
							Long idP = Long.parseLong(idPadrinoTroop);
							padrinoAlumno = (padrinos.get(idP));
						}
													
						if(alumno != null){
							if (personaEa != null) {
								if (personaRR != null){
									if(escuelaAlumno != null){		
										if(padrinoAlumno != null){
																						
											Beca beca = obtenerBeca(padrinoAlumno,alumno);
											AlumnoPanelEA ape = alumnos_panelEA.get(alumno.getId());
											Periodo periodo;
											if(beca != null){											
												alumno.setBeca(beca);
												periodo = buscarPeriodoPorNombre(alumno.getBeca().getCiclo(), periodoPago);
												ape.setFechaAltaBeca(periodo.getFechaInicio());
												alumno.setFechaAltaBeca(ape.getFechaAltaBeca());
											}
											else{											
												System.out.println("No se encuentra una beca para el alumno idTroop " + idAlumnoTroop + ". El padrino " +
														"no tiene becas para la zona " + alumno.getEscuela().getLocalidad().getZona().getNombre() 
														+ ".Registro " + (count + 1));
												return;
											}
											alumno.setEa(personaEa.getPerfilEA());
											alumno.setEscuela(escuelaAlumno);
											EntrevistaReIncorporacion entrevista = new EntrevistaReIncorporacion();
											entrevista.setPagaEntrevista(true);
											entrevista.setRr(personaRR.getPerfilRR());
											entrevista.setEa(personaEa.getPerfilEA());
											entrevista.setPerfilAlumno(alumno);
											if(StringUtils.isNotBlank(idAnioEscolar))
											{
												AnioEscolar anioEscolar1 = AnioEscolar.getAnioEscolar(Integer.parseInt(idAnioEscolar));
												entrevista.setAnioEscolar(anioEscolar1);
												alumno.setAnioEscolar(anioEscolar1);
												ape.setAnio(anioEscolar1); 
											}
											
											entrevista.setEscuelaAlumno(escuelaAlumno);
											if(StringUtils.isNotBlank(lugarEntrevista))
												entrevista.setLugarEntrevista(escuelas.get(lugarEntrevista));
											agregarExportacionEspecial(entrevista, alumno, null, alumno.getBeca(), session);
											obtenerEvaluacionIncorporacion(incorpora, entrevista, motivoNoIncorporacion,
																		   otroMotivoNoIncorporacion,alumno,ape, periodo); 
											entrevista.setRealizoEntrevista(realizoEntrevista.equalsIgnoreCase("si")?true:false);
											
											SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy");
											Date fecha;
											if(StringUtils.isNotBlank(fechaEntrevista)){
												fecha = sdf.parse(fechaEntrevista);
												entrevista.setFechaEntrevista(fecha);
												entrevista.setFechaCarga(fecha);
											}else{
												entrevista.setFechaCarga(alumno.getFechaAltaBeca());
											}
											
											if(StringUtils.isNotBlank(fechaAltaBeca)){
												fecha = sdf.parse(fechaAltaBeca);
												entrevista.setFechaAltaBeca(fecha);
												ape.setFechaAltaBeca(fecha);
												alumno.setFechaAltaBeca(fecha);
											}
											else{
												entrevista.setFechaCarga(alumno.getFechaAltaBeca());
											}
											
											obtenerTipoContacto(tipoContacto, entrevista);
											obtenerDestinoDinero(entrevista,utilizacionBeca);
											entrevista.setTipoEntrevista(TipoEntrevista.INCORPORACION);
											
											entrevista.setParticipoBecado(participoBecado.equalsIgnoreCase("si")?true:false);
											
											obtenerMotivoAusencia(motivoAusencia.toLowerCase(),motivoAusenciaOtro, entrevista);
											
											entrevista.setParticipoRA(participoRA.equalsIgnoreCase("si")?true:false);
											
											obtenerMotivoAusenciaRA(motivoAusenciaRA.toLowerCase(), motivoAusenciaRAotro, entrevista);									
											
											entrevista.setCertificadoAlumnoRegular(obtenerOpciones(certificadoAlumnoRegular));									
											entrevista.setFirmaActaCompromiso(obtenerOpciones(firmaActaCompromiso));
											entrevista.setFirmaAutorizacionCierreCaja(obtenerOpciones(firmaAutorizacionCierreCaja));
											entrevista.setFirmaAutorizacionImagen(obtenerOpciones(firmaAutImagen));
											entrevista.setFotocipiaBoletin(obtenerOpciones(fotocopiaBoletin));
											entrevista.setMaterialCompleto(materialCompleto.equalsIgnoreCase("si")?true:false);
											
											entrevista.setEntregaMaterial(entregaMaterialCimientos.equalsIgnoreCase("si")?true:false);
											
											entrevista.setProposito(propositoAnio);
											
											entrevista.setExpectativasRA(expectativasRA);
											
											entrevista.setObservacionesGenerales(obsGenerales);

											Date proximaFecha;
											if(StringUtils.isNotBlank(proximaEntrevista)){
												proximaFecha = sdf.parse(proximaEntrevista);
												entrevista.setProximaEntrevista(proximaFecha);										
											}
											if(StringUtils.isNotBlank(lugarProximaEntrevista))
												entrevista.setLugarProximaEntrevista(escuelas.get(lugarProximaEntrevista));
											entrevista.setPeriodoDePago(periodo);
											obtenerEvaluacionCobroBeca(evaluacionCobroBeca,entrevista);
											
											resetearAlumnoPanelEa(ape, alumno, entrevista.getFechaEntrevista());
											entrevista.setEstadoEntrevista(EstadoEntrevista.FINALIZADA);
											ape.setEntrevistasFinalizadas(true);
											ape.setRenovacionPendiente(false);
											ape.incrementarEntrevista(entrevista.getEstadoEntrevista());
											ape.actualizarEntrevista(entrevista.getEstadoEntrevista());
											if(!entrevista.getIncorporacion().equals(EvaluacionIncorporacion.NOINCORPORA)){
												Pago pagoBecado = crearPagoBecado(alumno,entrevista,periodo);
												ape.incrementarPago(pagoBecado.getEstadoPago());
												ape.actualizarSemaforoPago(pagoBecado.getEstadoPago());
												session.save(pagoBecado);
											}
											
											session.saveOrUpdate(beca);
											session.update(alumno);
											session.save(entrevista);
											Pago pagoEa = crearPagoEa(entrevista,alumno,periodo);
											session.update(ape);
											session.save(pagoEa);
										
										}
										else{
											System.out.println("El padrino cuyo id es " + idPadrinoTroop + " no existe, registro " + (count + 1) + " del archivo incorporacion2011.csv");
										}								
									}
									else{
										System.out.println("La escuela cuyo id es " + idEscuela + " no existe, registro " + (count + 1) + " del archivo incorporacion2011.csv");
									}
								}
								else{
									System.out.println("El RR cuyo id es " + idRR + " no existe, registro " + (count + 1) + " del archivo incorporacion2011.csv");
								}
							}
							else{
								System.out.println("El EA cuyo id es " + idEA + " no existe, registro " + (count + 1) + " del archivo incorporacion2011.csv");
							}
						}
						else{
							System.out.println("El alumno cuyo id es " + idAlumnoTroop + " no existe, registro " + (count + 1) + " del archivo incorporacion2011.csv");
						}
					} catch (Exception e) {
						System.out.println("Ocurrio un error en el registro " + (count + 1) + " del archivos incorporacion2011.csv");
					}
				}
	
				private Pago crearPagoBecado(PerfilAlumno a, EntrevistaReIncorporacion  entrevista, Periodo periodo) {
					Pago pagoBeca = new Pago();
					pagoBeca.setBecado(a);
					pagoBeca.setExtra(new Double(0));
					if (entrevista.getEvaluacionCobroBeca().equals(EvaluacionCobroBeca.APROBADO))
						pagoBeca.setEstadoPago(EstadoPago.APROBADO);
					else if (entrevista.getEvaluacionCobroBeca().equals(EvaluacionCobroBeca.DUDOSO))
					{
						pagoBeca.setEstadoPago(EstadoPago.SUSPENDIDO);						
					}
					else if (entrevista.getEvaluacionCobroBeca().equals(EvaluacionCobroBeca.NO_APLICA))
						pagoBeca.setEstadoPago(EstadoPago.NO_APLICA);
					pagoBeca.setPeriodo(periodo);
					pagoBeca.setMonto(a.getBeca().getCiclo().getMontoBeca());
					pagoBeca.setFechaAprobacionRR(new Date());
					
					return pagoBeca;
				}
	
				private void obtenerEvaluacionCobroBeca(String evaluacionCobroBeca,	EntrevistaReIncorporacion entrevista) {
	
					if(evaluacionCobroBeca.equalsIgnoreCase("Aprobado"))
						entrevista.setEvaluacionCobroBeca(EvaluacionCobroBeca.APROBADO);
					else
						if(evaluacionCobroBeca.equalsIgnoreCase("Dudoso"))
							entrevista.setEvaluacionCobroBeca(EvaluacionCobroBeca.DUDOSO);
							else
								entrevista.setEvaluacionCobroBeca(EvaluacionCobroBeca.NO_APLICA);
					
				}

				private void obtenerEvaluacionIncorporacion(String incorporacion, EntrevistaReIncorporacion entrevista, 
															String motivoNoIncorp,String otroMotivoNoIncorp, PerfilAlumno alumno,
															AlumnoPanelEA ape, Periodo periodo){
					Formateador.quitarAcentos(incorporacion);
					if (!incorporacion.equalsIgnoreCase("seleccione")){
				
						if(incorporacion.equalsIgnoreCase("SI")){
							entrevista.setIncorporacion(EvaluacionIncorporacion.INCORPORA);
							alumno.setEstadoAlumno(EstadoAlumno.INCORPORADO);
							alumno.setFechaPBE(periodo.getFechaInicio());
							
						}
						else
							if(incorporacion.equalsIgnoreCase("No")){
								entrevista.setIncorporacion(EvaluacionIncorporacion.NOINCORPORA);						
								obtenerMotivoNoIncorporacion(motivoNoIncorp.toLowerCase(),entrevista,otroMotivoNoIncorp);
								alumno.setEstadoAlumno(EstadoAlumno.NO_INCORPORADO);
								ape.setActivo(false);
								desasignarBecaBecado(alumno);
								alumno.setFechaBaja(new Date());
							}
					}
						
				}
	
				private void obtenerMotivoNoIncorporacion(String motivoNoIncorp,EntrevistaReIncorporacion entrevista, String motivoOtroNoIncorp) {				
					Formateador.quitarAcentos(motivoNoIncorp);
					if (!motivoNoIncorp.equalsIgnoreCase("seleccione")){
						
						if((motivoNoIncorp.equalsIgnoreCase("cambio de escuela")||(contiene(motivoNoIncorp,"cambio","escuela"))))
							entrevista.setMotivoNoIncorporacion(motivoNoIncorporacion.CAMBIOESCUELA);
						else
							if((motivoNoIncorp.equalsIgnoreCase("no se pudo establecer contacto")||(contiene(motivoNoIncorp,"establecer","contacto"))))
								entrevista.setMotivoNoIncorporacion(motivoNoIncorporacion.NOCONTACTO);
							else
								if((motivoNoIncorp.equalsIgnoreCase("no interesado en pbe por otra beca")||(contiene(motivoNoIncorp,"interesado","beca"))))
									entrevista.setMotivoNoIncorporacion(motivoNoIncorporacion.NOINTERESBECA);
								else
									if((motivoNoIncorp.equalsIgnoreCase("no interesado en pbe por condiciones")||(contiene(motivoNoIncorp,"pbe","condiciones"))))
										entrevista.setMotivoNoIncorporacion(motivoNoIncorporacion.NOINTERESCONDICIONES);
									else
										entrevista.setMotivoNoIncorporacion(motivoNoIncorporacion.OTRO);
										entrevista.setMotivoNoIncorporacionOtro(motivoOtroNoIncorp);
					}				
				}
				
				
				private void obtenerTipoContacto(String tipoContacto,EntrevistaReIncorporacion entrevista) {				
					Formateador.quitarAcentos(tipoContacto);
					if (!tipoContacto.equalsIgnoreCase("seleccione")){
					
						if(tipoContacto.equalsIgnoreCase("Escuela"))
							entrevista.setTipoContacto(TipoContacto.ESCUELA);
						else
							if(tipoContacto.equalsIgnoreCase("Telefonico con flia"))
								entrevista.setTipoContacto(TipoContacto.TELEFONICO);
							else
								if(tipoContacto.equalsIgnoreCase("Visita TS"))
									entrevista.setTipoContacto(TipoContacto.VISITA);
								else
									if(tipoContacto.equalsIgnoreCase("Nulo"))
										entrevista.setTipoContacto(TipoContacto.NULO);
									else 
										entrevista.setTipoContacto(TipoContacto.OTRO);
										
					}	
				}
			};
		}
	

	private static void migrarEntrevistasMensuales2011() throws Exception {
		
		Parser relaciones = new Parser(new File(FILE_HOME,"mensual2011.csv"),sessionFactory.openSession()) {
			
			@Override
			public void handleLine(String line, Session session, int count) {
				try {				
					Scanner scanner = new Scanner(line);
					scanner.useDelimiter(";");
					String rr = scanner.next();
					String idRR = scanner.next();
					String ea = scanner.next();
					String idEA = scanner.next();
					String idZona = scanner.next();
					String nombreZona = scanner.next();
					String idAlumnoTroop = scanner.next();
					String apellidoBecado = scanner.next();
					String nombreBecado = scanner.next();
					String tipoDni = scanner.next();
					String dni = scanner.next(); 
					String idAnioEscolar = scanner.next();
					String anioEscolar = scanner.next();
					String modalidad = scanner.next();
					String idEscuela = scanner.next();
					String escuela = scanner.next();
					String fechaIncorpPBE = scanner.next();
					String fechaCargaEntrevista = scanner.next();					
					String entrevistaReprogramda = scanner.next();
					String fechaEntrevista = scanner.next();
					String lugarEntrevista = scanner.next();
					String tipoEntrevista = scanner.next();
					String periodoDePago = scanner.next();
					String participoBecado = scanner.next();
					String motivoAusencia = scanner.next();
					String motivoAusenciaOtro = scanner.next();
					String participoRA = scanner.next();
					String motivoAusenciaRA = scanner.next();
					String motivoAusenciaRAotro = scanner.next();	
					String listadoDePrevias = scanner.next();
					String boletin = scanner.next();
					String carpeta = scanner.next();
					String cuadernoComunicados = scanner.next();
					String informeProfesores = scanner.next();
					String materiaInformeProfesores = scanner.next();
					String certificadoInasistencias = scanner.next();
					String cantidadInasistenciasMes = scanner.next();
					String motivoInasistencias = scanner.next();
					String rendicionGastos = scanner.next();
					String detalleGastos = scanner.next();
					String materialCompleto = scanner.next();
					String evolucionPropositoMesAnterior = scanner.next();
					String logros = scanner.next();
					String dificultades = scanner.next();
					String proposito = scanner.next();
					String compromisoRA = scanner.next();
					String recomendacionEstrategiaCompl = scanner.next();
					String otraEstrategiaCompl = scanner.next();
					String contenidosAbordados = scanner.next();
					String situacionCrisis = scanner.next();
					String otraSituacion = scanner.next();
					String observaciones = scanner.next();
					String evaluacionCobroBeca  = scanner.next();
					String motivoSuspension = scanner.next();
					String motivoCesasion = scanner.next();
					String fechaProximaEntrevista = scanner.next();
					String horaProximaEntrevista = scanner.next();
					String lugarProximaEntrevista = scanner.next();
					String quienCargaEntrevista = scanner.next();
					String banco = scanner.next();
					String dniRA = scanner.next();
					String cuilRA = scanner.next();
					String nroCuentaRA = scanner.next();
					String apellidoNombreRA = scanner.next();
					String montoBeca = scanner.next();
					String idPadrinoTroop = scanner.next();	
					
					PerfilAlumno alumno = alumnos.get(new Long(idAlumnoTroop));
					Persona personaRR = usuarios.get(idRR);
					Persona personaEa = usuarios.get(idEA);
					Escuela escuelaAlumno = escuelas.get(idEscuela);
					PerfilPadrino padrinoAlumno = null;
					if(StringUtils.isNotBlank(idPadrinoTroop)){
						Long idP = Long.parseLong(idPadrinoTroop);
						padrinoAlumno = (padrinos.get(idP));
					}
													
					if(alumno != null){
						if (personaEa != null) {
							if (personaRR != null){
								if(escuelaAlumno != null){
									if(padrinoAlumno != null){
										Beca beca = null;
										if(!padrinoAlumno.equals(alumno.getBeca().getPadrino())){											
											beca = obtenerBeca(padrinoAlumno,alumno);
											if(beca != null){
												desasignarBecaBecado(alumno);
												alumno.setBeca(beca);
												System.out.println("Se cambio la beca para el alumno " + alumno.getDatosPersonales().getNombre() 
														+ "," + alumno.getDatosPersonales().getApellido() );
											}
											else{
												System.out.println("No se encuentra una beca para el alumno idTroop " + idAlumnoTroop + ". El padrino " +
														"no tiene becas para la zona " + alumno.getEscuela().getLocalidad().getZona().getNombre() 
														+ ".Registro " + (count + 1));
												return;
											}
										}
										else{
											beca = alumno.getBeca();
										}
										AlumnoPanelEA ape = alumnos_panelEA.get(alumno.getId());
										ape.setActivo(true);
										ape.setIdPerfilEA(personaEa.getPerfilEA().getIdPerfilEA());
										alumno.setEa(personaEa.getPerfilEA());
										alumno.setEscuela(escuelaAlumno);
										EntrevistaIndividual entrevista = new EntrevistaIndividual();
										entrevista.setPagaEntrevista(true);
										entrevista.setRr(personaRR.getPerfilRR());
										entrevista.setEa(personaEa.getPerfilEA());
										entrevista.setPerfilAlumno(alumno);
										if(StringUtils.isNotBlank(idAnioEscolar)){
											AnioEscolar anioEscolar1 = AnioEscolar.getAnioEscolar(Integer.parseInt(idAnioEscolar));
											entrevista.setAnioEscolar(anioEscolar1);
											alumno.setAnioEscolar(anioEscolar1);
											ape.setAnio(anioEscolar1);
										}
										
										entrevista.setEscuelaAlumno(escuelaAlumno);
										if(StringUtils.isNotBlank(lugarEntrevista))
											entrevista.setLugarEntrevista(escuelas.get(lugarEntrevista));
										entrevista.setEntrevistaReprogramada(obtenerEntrevistaReprogramada(entrevistaReprogramda));
										
										SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy");
										Date fecha;
										if(StringUtils.isNotBlank(fechaEntrevista)){
											fecha = sdf.parse(fechaEntrevista);
											entrevista.setFechaEntrevista(fecha);
											entrevista.setFechaCarga(fecha);
										}
										
										entrevista.setTipoEntrevista(TipoEntrevista.MENSUAL);
										entrevista.setParticipoBecado(participoBecado.equalsIgnoreCase("si")?true:false);
										
										obtenerMotivoAusencia(motivoAusencia.toLowerCase(),motivoAusenciaOtro, entrevista);
													
										entrevista.setParticipoRA(participoRA.equalsIgnoreCase("si")?true:false);
										
										obtenerMotivoAusenciaRA(motivoAusenciaRA.toLowerCase(),	motivoAusenciaRAotro, entrevista);									
																
										entrevista.setBoletin(obtenerOpciones(boletin));
										entrevista.setCarpeta(obtenerOpciones(carpeta));
										entrevista.setCuadernoComunicados(obtenerOpciones(cuadernoComunicados));
										entrevista.setInformeProfesores(obtenerOpciones(informeProfesores));
										entrevista.setMateriaBoletin(materias.get(materiaInformeProfesores));
										
										entrevista.setCertificadoAsistencia(obtenerOpciones(certificadoInasistencias));
										if(StringUtils.isNotBlank(cantidadInasistenciasMes))
										{
											cantidadInasistenciasMes = cantidadInasistenciasMes.replace(",", ".");
											entrevista.setCantidadInasistencias(Float.parseFloat(cantidadInasistenciasMes)); 
										}
										entrevista.setMotivoInasistencia(motivoInasistencias);
										entrevista.setRendicionGastos(rendicionGastos.equalsIgnoreCase("si")?true:false);
										obtenerDestinoDinero(entrevista,detalleGastos);
										entrevista.setMaterialCompleto(materialCompleto.equalsIgnoreCase("si")?true:false);
										
										entrevista.setEvolucionMesAnterior(evolucionPropositoMesAnterior);
										entrevista.setLogros(logros);
										entrevista.setDificultades(dificultades);
										entrevista.setProposito(proposito);
										obtenerContenidosAbordados(entrevista, contenidosAbordados);
										entrevista.setCompromisoRA(obtenerCompromisoRA(compromisoRA));
										obtenerRecomendacionEstrategiaComp(entrevista, recomendacionEstrategiaCompl);
										obtenerSituacionCrisis(entrevista, situacionCrisis);
																		
										entrevista.setObservacionesGenerales(observaciones);
												
										Date proximaFecha;
										if(StringUtils.isNotBlank(fechaProximaEntrevista)){
											proximaFecha = sdf.parse(fechaProximaEntrevista);
											entrevista.setProximaEntrevista(proximaFecha);										
										}
										entrevista.setHoraProxEntrevista(horaProximaEntrevista);
										if(StringUtils.isNotBlank(lugarProximaEntrevista))
											entrevista.setLugarProximaEntrevista(escuelas.get(lugarProximaEntrevista));
										
										Periodo periodo = buscarPeriodoPorNombre(alumno.getBeca().getCiclo(), periodoDePago);
										entrevista.setPeriodoDePago(periodo);
																		
										obtenerEvaluacionCobroBeca(evaluacionCobroBeca,entrevista,motivoSuspension, motivoCesasion);
										
										entrevista.setEstadoEntrevista(EstadoEntrevista.FINALIZADA);
										ape.setEntrevistasFinalizadas(true);
										
										agregarExportacionEspecial(entrevista, alumno, null, beca, session);
										
										if(alumno.getEstadoAlumno().equals(EstadoAlumno.CESADO)){	
											InformeCesacion InfCesa;
											InfCesa = generarInformeCesacion(entrevista, beca, alumno, padrinoAlumno, ape);		
											session.save(InfCesa);
										}
										
										ape.incrementarEntrevista(entrevista.getEstadoEntrevista());
										ape.actualizarEntrevista(entrevista.getEstadoEntrevista());
										if(!entrevista.getEvaluacionCobroBeca().equals(EvaluacionCobroBeca.CESADO)){
											Pago pagoBecado = crearPagoBecado(alumno,entrevista,periodo);
											ape.incrementarPago(pagoBecado.getEstadoPago());
											ape.actualizarSemaforoPago(pagoBecado.getEstadoPago());
											session.save(pagoBecado);
										}	
																				
										session.update(alumno);
										session.save(entrevista);
										Pago pagoEa = crearPagoEa(entrevista,alumno,periodo);
										session.update(ape);
										session.save(pagoEa);
									}
									else{
										System.out.println("El padrino cuyo id es " + idPadrinoTroop + " no existe");
									}
								}
								else{
									System.out.println("La escuela cuyo id es " + idEscuela + " no existe");
								}
							}
							else{
								System.out.println("El RR cuyo id es " + idRR + " no existe");
							}
						}
						else{
							System.out.println("El EA cuyo id es " + idEA + " no existe");
						}
					}
					else{
						System.out.println("El alumno cuyo id es " + idAlumnoTroop + " no existe");
					}
				} catch (Exception e) {
					System.out.println("Ocurrio un error en el registro " + (count + 1) + " del archivos mensual2011.csv");
				}
			}


			private Pago crearPagoBecado(PerfilAlumno a, EntrevistaIndividual entrevista, Periodo periodo) {
				Pago pagoBeca = new Pago();
				pagoBeca.setBecado(a);
				pagoBeca.setExtra(new Double(0));
				if (entrevista.getEvaluacionCobroBeca().equals(EvaluacionCobroBeca.APROBADO))
					pagoBeca.setEstadoPago(EstadoPago.APROBADO);
				else if (entrevista.getEvaluacionCobroBeca().equals(EvaluacionCobroBeca.SUSPENDIDO))
				{
					pagoBeca.setEstadoPago(EstadoPago.SUSPENDIDO);					
				}
				else if (entrevista.getEvaluacionCobroBeca().equals(EvaluacionCobroBeca.NO_APLICA))
					pagoBeca.setEstadoPago(EstadoPago.NO_APLICA);
				pagoBeca.setPeriodo(periodo);
				pagoBeca.setMonto(a.getBeca().getCiclo().getMontoBeca());
				pagoBeca.setFechaAprobacionRR(new Date());
				
				return pagoBeca;
			}
			
		
			private void obtenerEvaluacionCobroBeca(String evaluacionCobroBeca,
					EntrevistaIndividual entrevista, String motivoSuspension, String motivoCesacion) {

				if(evaluacionCobroBeca.equalsIgnoreCase("Aprobado"))
					entrevista.setEvaluacionCobroBeca(EvaluacionCobroBeca.APROBADO);
				else
					if(evaluacionCobroBeca.equalsIgnoreCase("Suspendido")){
						entrevista.setEvaluacionCobroBeca(EvaluacionCobroBeca.SUSPENDIDO);
						entrevista.setMotivoSuspension(obtenerMotivoSuspension(motivoSuspension.toLowerCase()));						
					}
					else
						if(evaluacionCobroBeca.equalsIgnoreCase("Dudoso"))
							entrevista.setEvaluacionCobroBeca(EvaluacionCobroBeca.DUDOSO);
						else
							if(evaluacionCobroBeca.equalsIgnoreCase("Cesado")){
								entrevista.setEvaluacionCobroBeca(EvaluacionCobroBeca.CESADO);
								entrevista.setMotivoCesacion(obtenerMotivoCesasion(motivoCesacion.toLowerCase()));
								cesarBecado(entrevista, entrevista.getPerfilAlumno());
								
							}	
							else
								if(evaluacionCobroBeca.equalsIgnoreCase(""))
									entrevista.setEvaluacionCobroBeca(EvaluacionCobroBeca.NULO);
								else
									entrevista.setEvaluacionCobroBeca(EvaluacionCobroBeca.NO_APLICA);
				
			}
			
			private void cesarBecado(EntrevistaIndividual entrevista, PerfilAlumno alumno)  {
				
				alumno.setEstadoAlumno(EstadoAlumno.CESADO);
				alumno.setFechaBaja(new Date());
				PerfilPadrino padrino = alumno.getBeca().getPadrino();
				Beca beca = alumno.getBeca();
				desasignarBecaBecado(alumno);
			}
			
			private InformeCesacion generarInformeCesacion(EntrevistaIndividual entrevista, Beca beca, PerfilAlumno alumno, PerfilPadrino padrino, AlumnoPanelEA ape ) 
			{		
					//Se genera el informe de Cesacion
				InformeCesacion informe = new InformeCesacion();
				informe.setBecado(alumno);
				informe.setBeca(beca);
				informe.setEi(entrevista);
				informe.setEaPerfil(alumno.getEa());
				informe.setRrPerfil(alumno.getEa().getRr());
				informe.setFechaPBE(alumno.getFechaPBE());
				informe.setCicloActual(ciclos.get("2011"));
				informe.setMotivoCesacion(informe.getEi().getMotivoCesacion().getValor());
				informe.setNombre(ConstantesInformes.nombreInformeCesacion);
				//El periodo se saca de la entrevista, ya que cuando un alumno se cesa se le saca la beca!
				informe.setEstado(EstadoInforme.SUPERVISOR);
				informe.setFechaAlta(new Date());
				Calendar calendarHoy = GregorianCalendar.getInstance();
				calendarHoy.setTime(new Date());
				Calendar calendarNac = GregorianCalendar.getInstance();
				calendarNac.setTime(alumno.getDatosPersonales().getFechaNacimiento());
				Integer edad = calendarHoy.get(Calendar.YEAR) - calendarNac.get(Calendar.YEAR);
				informe.setEdad(edad);
				informe.setPadrino(padrino);
				String fecha = Formateador.formatearFechas(new Date(), "dd/MM/yyyy");
				String mesCesacion = entrevista.getPeriodoDePago().getNombre();
				informe.setMesCesacion(mesCesacion); 
				String utilizacion = "";
				if(informe.getEi().getDetalleGastos() != null){
					List<DetalleGastos> detalles = informe.getEi().getDetalleGastos();
					for (DetalleGastos unDetalle : detalles) 
					{
						utilizacion = utilizacion + unDetalle.getValor() + ", ";
					}
				}
				informe.setDetalle(utilizacion);
				informe.setFechaUltimaModificacion(new Date());
				Integer cantidadSuspensiones = 0;
				String periodoSuspension = "";
				String motivoSuspension = "";
				//Se modifica el alumnoPanelEa, cuando se cesa un alumno se desactiva el AlumnoPanelEa para que no aparezca en el panel
				ape.setActivo(false);
				entrevista.getExportacionEspecial().setIdInforme(informe.getId());
				
				return informe;
				
			}


			private MotivoSuspension obtenerMotivoSuspension(String motivoSuspension) {				
				if((motivoSuspension.equalsIgnoreCase("Desempeño escolar insuficiente")||(contiene(motivoSuspension,"desempeño","escolar"))))
					return MotivoSuspension.DESEMPENO;
				else
					if((motivoSuspension.equalsIgnoreCase("Inasistencia a entrevista sin justificacion")||(contiene(motivoSuspension,"inasistencia","entrevista"))))
						return MotivoSuspension.INASISTENCIAESJ;
					else
						if((motivoSuspension.equalsIgnoreCase("2 inasistencias consecutivas a entrevistas bdo/RA")||(contiene(motivoSuspension,"consecutivas","entrevistas"))))
							return MotivoSuspension.INASISTENCIACE;
						else
							if((motivoSuspension.equalsIgnoreCase("Inasistencia a la Jornada sin justificacion")||(contiene(motivoSuspension,"jornada","justificacion"))))
								return MotivoSuspension.INASISTENCIAJ;
							else
								if((motivoSuspension.equalsIgnoreCase("Mas de 5 faltas a clase o 10 por trimestre ")||(contiene(motivoSuspension,"faltas","trimestre"))))
									return MotivoSuspension.FALTAS;
								else
									if((motivoSuspension.equalsIgnoreCase("Perdida de condicion de alumno regular")||(contiene(motivoSuspension,"perdida","regular"))))
										return MotivoSuspension.PERDIDAREGULAR;
									else
										if((motivoSuspension.equalsIgnoreCase("Conducta insuficiente")||(contiene(motivoSuspension,"conducta","insuficiente"))))
											return MotivoSuspension.CONDUCTA;
										else
											return MotivoSuspension.FALTAMATERIAL;
			}
			
			private MotivoCesacion obtenerMotivoCesasion(String motivoCesacion) {				
				if((motivoCesacion.equalsIgnoreCase("Abandono escolar")||(contiene(motivoCesacion,"abandono","escolar"))))
					return MotivoCesacion.ABANDONO;
				else
					if((motivoCesacion.equalsIgnoreCase("Mudanza a donde PBE no esta")||(contiene(motivoCesacion,"mudanza","pbe"))))
						return MotivoCesacion.MUDANZA;
					else
						if((motivoCesacion.equalsIgnoreCase("Falta grave de conducta")||(contiene(motivoCesacion,"grave","conducta"))))
							return MotivoCesacion.CONDUCTA;
						else
							if((motivoCesacion.equalsIgnoreCase("Deja PBE por otra beca")||(contiene(motivoCesacion,"otra","beca"))))
								return MotivoCesacion.DEJAXBECA;
							else
								if((motivoCesacion.equalsIgnoreCase("Deja PBE x trabajo")||(contiene(motivoCesacion,"deja","trabajo"))))
									return MotivoCesacion.DEJAXTRABAJO;
								else
									if((motivoCesacion.equalsIgnoreCase("Deja PBE por exigencias")||(contiene(motivoCesacion,"por","exigencias"))))
										return MotivoCesacion.DEJAXEXIGENCIA;
									else
										if((motivoCesacion.equalsIgnoreCase("Deja PBE x 3-4 inasistencias a entrevista")||(contiene(motivoCesacion,"inasistencias","entrevista"))))
											return MotivoCesacion.DEJAXINASISTENCIA;
										else
											if((motivoCesacion.equalsIgnoreCase("Deja PBE x cambio de situacion economica")||(contiene(motivoCesacion,"situacion","economica"))))
												return MotivoCesacion.DEJAXESITECO;
											else
												return MotivoCesacion.FALLECIMIENTO;
			}
		
			private void obtenerContenidosAbordados(EntrevistaIndividual entrevista,String contenidosAb) {
				List<ContenidosAbordados> contenidos = new ArrayList<ContenidosAbordados>();
				for (String cont : contenidosAb.split(",")) {
					ContenidosAbordados ca = buscarContenidos(Formateador.quitarAcentos(cont.toLowerCase())); 
					if(!contenidos.contains(ca))
						contenidos.add(ca);
				}
				entrevista.setContenidosAbordados(contenidos);
			}
			
			private ContenidosAbordados buscarContenidos(String contenido) {
				if((contenido.equalsIgnoreCase("Planificacion del estudio")||(contiene(contenido,"planificacion","estudio"))))
					return ContenidosAbordados.PLANIFICACION;
				else
					if((contenido.equalsIgnoreCase("Estrategias de aprendizaje")||(contiene(contenido,"estrategias","aprendizaje"))))
						return ContenidosAbordados.ESTRATEGIAS;
					else
						if((contenido.equalsIgnoreCase("Criterios de permanencia PBE")||(contiene(contenido,"criterios","permanencia"))))
							return ContenidosAbordados.CRITERIOS;
						else
							if((contenido.equalsIgnoreCase("Planificacion Proyecto de Vida")||(contiene(contenido,"proyecto","Vida"))))
								return ContenidosAbordados.PLANIFICACIONPROYECTO;
							else
								if((contenido.equalsIgnoreCase("Planificacion Tiempo Libre")||(contiene(contenido,"tiempo","libre"))))
									return ContenidosAbordados.PLANIFICACIONTIEMPO;
								else
									if(contenido.equalsIgnoreCase("Autonomia"))
										return ContenidosAbordados.AUTONOMIA;
									else
										if(contenido.equalsIgnoreCase("Responsabilidad"))
											return ContenidosAbordados.AUTOCONOCIMIENTO;
										else
											if((contenido.equalsIgnoreCase("Compromiso del becado")||(contiene(contenido,"compromiso","becado"))))
												return ContenidosAbordados.COMPROMISOBECADO;
											else
												return ContenidosAbordados.COMPROMISORA;
												
			}
		
			
			private void obtenerRecomendacionEstrategiaComp(EntrevistaIndividual entrevista,String recomendacionEst) {
				List<EstrategiaComplementaria> estrategias = new ArrayList<EstrategiaComplementaria>();
				for (String est : recomendacionEst.split(",")) {
					EstrategiaComplementaria ec = buscarEstrategias(Formateador.quitarAcentos(est.toLowerCase())); 
					if(!estrategias.contains(ec))
						estrategias.add(ec);
				}
				entrevista.setEstrategiaComp(estrategias);
			}
			
			private EstrategiaComplementaria buscarEstrategias(String estrategia) {
				if((estrategia.equalsIgnoreCase("Taller de materias previas")||(contiene(estrategia,"materias","previas"))))
					return EstrategiaComplementaria.TALLER;
				else
					if((estrategia.equalsIgnoreCase("Taller complementario")||(contiene(estrategia,"taller","complementario"))))
						return EstrategiaComplementaria.TALLERCOMPLEMENTARIO;
					else
						if((estrategia.equalsIgnoreCase("Intervencion TS")||(contiene(estrategia,"intervencion","ts"))))
							return EstrategiaComplementaria.INTERVENCIONTS;
						else
							if((estrategia.equalsIgnoreCase("Entrevista adicional")||(contiene(estrategia,"entrevista","adicional"))))
								return EstrategiaComplementaria.ENTREVISTAADI;
							else
								if((estrategia.equalsIgnoreCase("Encuentro de padres")||(contiene(estrategia,"encuentro","padres"))))
									return EstrategiaComplementaria.ENCUENTRO;
								else
									return EstrategiaComplementaria.OTRO;
			}
			

			private void obtenerSituacionCrisis(EntrevistaIndividual entrevista,String situacionCrisis) {
				List<SituacionCrisis> situaciones = new ArrayList<SituacionCrisis>();
				for (String sit : situacionCrisis.split(",")) {
					SituacionCrisis st = buscarSituacion(Formateador.quitarAcentos(sit.toLowerCase())); 
					if(!situaciones.contains(st))
						situaciones.add(st);
				}
				entrevista.setSituacionCrisis(situaciones);
			}
			
			private SituacionCrisis buscarSituacion(String situacion) {
				if((situacion.equalsIgnoreCase("Fallecimiento de una persona significativa")||(contiene(situacion,"fallecimiento","significativa"))))
					return SituacionCrisis.FALLECIMIENTO;
				else
					if((situacion.equalsIgnoreCase("Enfermedad propia o de una persona significativa")||(contiene(situacion,"enfermedad","propia"))))
						return SituacionCrisis.ENFERMEDAD;
					else
						if((situacion.equalsIgnoreCase("Maternidad/Paternidad")||(contiene(situacion,"maternidad","paternidad"))))
							return SituacionCrisis.MATERNIDAD;
						else
							if(situacion.equalsIgnoreCase("Mudanza"))
								return SituacionCrisis.MUDANZA;
							else
								if((situacion.equalsIgnoreCase("Situacion de violencia")||(contiene(situacion,"situacion","violencia"))))
									return SituacionCrisis.VIOLENCIA;
								else
									if((situacion.equalsIgnoreCase("Situación de crisis economica")||(contiene(situacion,"crisis","economica"))))
										return SituacionCrisis.CRISIS;
									else
										if((situacion.equalsIgnoreCase("Cambio de estructura familiar/convivientes")||(contiene(situacion,"cambio","familiar"))))
											return SituacionCrisis.CAMBIOFAMILIAR;
										else
											return SituacionCrisis.OTRO;
			}
		
			
			private Compromiso obtenerCompromisoRA(String compromisoRA) {				
				if(compromisoRA.equalsIgnoreCase("Excelente"))
					return Compromiso.EXCELENTE;
				else
					if(compromisoRA.equalsIgnoreCase("Muy Bueno"))
						return Compromiso.MUYBUENO;
					else
						if(compromisoRA.equalsIgnoreCase("Bueno"))
							return Compromiso.BUENO;
						else
							if(compromisoRA.equalsIgnoreCase("Regular"))
								return Compromiso.REGULAR;
							else
	 							return Compromiso.MALO;
			}

			private EntrevistaReprogramada obtenerEntrevistaReprogramada(String entrevistaReprogramda) {
				if(entrevistaReprogramda.equalsIgnoreCase("1 Vez"))
					return EntrevistaReprogramada.UNAVEZ;
				else
					if(entrevistaReprogramda.equalsIgnoreCase("2 Veces"))
						return EntrevistaReprogramada.DOSVECES;
					else
						if(entrevistaReprogramda.equalsIgnoreCase("Mas de 2 veces"))
							return EntrevistaReprogramada.MASDEDOS;
						else
							return EntrevistaReprogramada.NO;
			}
			
		};
	}	
	
	private static Beca obtenerBeca(PerfilPadrino padrino, PerfilAlumno alumno) {
		List<Beca> becas = padrino.getBecas();
		Beca beca = null;
		if (becas != null){
			for (Beca beca2 : becas){						
				if(beca2.getZona().equals(alumno.getEscuela().getLocalidad().getZona()) &&  beca2.getCiclo().getNombre().equalsIgnoreCase("2011")){
					beca2.getBecados().add(alumno);
					beca2.setCantidadAsignada(beca2.getCantidadAsignada()+1);
					beca = beca2;
					break;
				}						
			}
			if(alumno.getBeca() == null){
				//System.out.println("********* el alumno " + alumno.getIdTroop() + " no tiene beca asignada");
			}
		} 
		else {
			System.out.println("el padrino " + padrino.getIdPlataforma() + " no tiene becas");
		}
		return beca;
	}

	private static void obtenerMotivoAusenciaRA(String motivoAusenciaRA, String motivoAusenciaRAotro, EntrevistaIndividual entrevista) {
		Formateador.quitarAcentos(motivoAusenciaRA);
		
		if (!motivoAusenciaRA.equalsIgnoreCase("seleccione")){
		
			if((motivoAusenciaRA.equalsIgnoreCase("Enfermedad")||(contiene(motivoAusenciaRA,"enfermo","enfermedad"))))
				entrevista.setMotivoAusenciaRA(MotivoAusencia.ENFERMEDAD);
			else
				if((motivoAusenciaRA.equalsIgnoreCase("Eventualidad de ultimo momento")||(contiene(motivoAusenciaRA,"eventualidad","momento"))))
					entrevista.setMotivoAusenciaRA(MotivoAusencia.EVENTUALIDAD);
				else
					if((motivoAusenciaRA.equalsIgnoreCase("Becado o RA no podian asistir")||(contiene(motivoAusenciaRA,"podian","asistir"))))
						entrevista.setMotivoAusenciaRA(MotivoAusencia.INASISTENCIA);
					else
						if(motivoAusenciaRA.equalsIgnoreCase("Otros")||motivoAusenciaRA.equalsIgnoreCase("Otro"))
						{
						entrevista.setMotivoAusenciaRA(MotivoAusencia.OTROS);
						entrevista.setOtroMotivoAusenciaRA(motivoAusenciaRAotro);									
						}								
					
		}
	}

	private static void obtenerMotivoAusencia(String motivoAusencia,String motivoAusenciaOtro, EntrevistaIndividual entrevista) {
		Formateador.quitarAcentos(motivoAusencia);
		
		if (!motivoAusencia.equalsIgnoreCase("seleccione")){
			if((motivoAusencia.equalsIgnoreCase("Enfermedad")||(contiene(motivoAusencia,"enfermo","enfermedad"))))
				entrevista.setMotivoAusencia(MotivoAusencia.ENFERMEDAD);
			else
				if((motivoAusencia.equalsIgnoreCase("Eventualidad de ultimo momento")||(contiene(motivoAusencia,"eventualidad","momento"))))
					entrevista.setMotivoAusencia(MotivoAusencia.EVENTUALIDAD);
				else
					if((motivoAusencia.equalsIgnoreCase("Becado o RA no podian asistir")||(contiene(motivoAusencia,"podian","asistir"))))
						entrevista.setMotivoAusencia(MotivoAusencia.INASISTENCIA);
					else
						if(motivoAusencia.equalsIgnoreCase("Otros")||motivoAusencia.equalsIgnoreCase("Otro"))
						{
						entrevista.setMotivoAusencia(MotivoAusencia.OTROS);
						entrevista.setOtroMotivoAusencia(motivoAusenciaOtro);									
						}
		}	
	}
	
	
	private static void desasignarBecaBecado(PerfilAlumno alumno) {
		if (alumno.getHistorialBeca()== null){
			List<Beca> historialBeca = new ArrayList<Beca>();
			alumno.setHistorialBeca(historialBeca);
		}
		Beca beca = alumno.getBeca(); 
		beca.getBecados().remove(alumno);
		beca.setCantidadAsignada(beca.getCantidadAsignada() - 1);
		alumno.getHistorialBeca().add(beca);		
		alumno.setBeca(null);				
	}
	
	
	
	private static Pago crearPagoEa(EntrevistaIndividual entrevista, PerfilAlumno p, Periodo periodo) {
		Pago pagoEA = new Pago();
		if(entrevista.isPagaEntrevista())
		{	
			pagoEA.setEa(entrevista.getEa());
			pagoEA.setBecado(p);
			pagoEA.setEstadoPago(EstadoPago.APROBADO);			
			pagoEA.setPeriodo(periodo);		
		}
		else 
		{
			pagoEA.setEstadoPago(EstadoPago.NO_APROBADO);
		}
		return pagoEA;
	}
	
	
	private static Opciones obtenerOpciones(String opcion) {
		Formateador.quitarAcentos(opcion);
		if(opcion.equalsIgnoreCase("si"))
			return Opciones.SI;
		else
			if(opcion.equalsIgnoreCase("no"))
				return Opciones.NO;
			else
				return Opciones.NOCORRESPONDE;
	}
	
	/**
	 * Busca en el ciclo dado el periodo correspondiente por el nombre pasado por parametro. Si no encuentre ninguno retorna el primero
	 * @param ciclo
	 * @param periodoPago
	 * @return
	 */
	private static Periodo buscarPeriodoPorNombre(CicloPrograma ciclo,	String periodoPago) {
		for (Periodo p : ciclo.getPeriodos()) {
			if(p.getNombre().equalsIgnoreCase(periodoPago))
				return p;
		}
		return ciclo.getPeriodos().get(0);
	}
	
	
	private static void obtenerDestinoDinero(EntrevistaIndividual entrevista,String utilizacionBeca) {
		List<DetalleGastos> gastos = new ArrayList<DetalleGastos>();
		for (String detalle : utilizacionBeca.split(",")) {
			DetalleGastos dg = buscarDetalleGastos(Formateador.quitarAcentos(detalle.toLowerCase())); 
			if(!gastos.contains(dg))
				gastos.add(dg);
		}
		entrevista.setDestinoDinero(gastos);
		entrevista.setDetalleGastos(gastos);
	}
	
	
	private static DetalleGastos buscarDetalleGastos(String detalle) {
		if((detalle.equalsIgnoreCase("utiles escolares")||(contiene(detalle,"utiles","escolares"))))
			return DetalleGastos.UTILES;
		else
			if(detalle.equalsIgnoreCase("libros"))
				return DetalleGastos.LIBROS;
			else
				if(detalle.equalsIgnoreCase("transporte"))
					return DetalleGastos.TRANSPORTE;
				else
					if(detalle.equalsIgnoreCase("vestimenta"))
						return DetalleGastos.VESTIMENTA;
					else
						if(detalle.equalsIgnoreCase("calzado"))
							return DetalleGastos.CALZADO;
						else
							if((detalle.equalsIgnoreCase("higiene personal")||(contiene(detalle,"higiene","personal"))))
								return DetalleGastos.HIGIENE;
							else
								if((detalle.equalsIgnoreCase("elementos para el hogar")||(contiene(detalle,"elementos","hogar"))))
									return DetalleGastos.ELEMENTOS;
								else
									if(detalle.equalsIgnoreCase("cooperadora escolar"))
										return DetalleGastos.COOPERADORA;
									else
										if(detalle.equalsIgnoreCase("servicios del hogar"))
											return DetalleGastos.SERVICIOS;
										else
											if(detalle.equalsIgnoreCase("tecnologia"))
												return DetalleGastos.TECNOLOGIA;
											else
												if(detalle.equalsIgnoreCase("deporte"))
													return DetalleGastos.DEPORTE;
												else
													if(detalle.equalsIgnoreCase("recreacion"))
														return DetalleGastos.RECREACION;
													else
														return DetalleGastos.OTRO;
	}
	
	private static boolean contiene(String cadena, String p1, String p2){
		
		return (cadena.contains(p1) || cadena.contains(p2));
	}


	private static void migrarEntrevistasSeleccion() throws Exception {
		
		Parser entrevistasSeleccion = new Parser(new File(FILE_HOME,"entrev_seleccion.csv"),sessionFactory.openSession()) {
			/*
			 * idsegundaentrevista;fentrevista;participantes_entrevista;repitio;repitio_ano;
			 * faltas;materias_pendientes;pn_idperiodonotas;compromiso_escolaridad;recibe_otra_beca;
			 * observaciones_alumno;observaciones_responzable;observaciones_asistente;posibilidad_compromiso;
			 * falta;fbaja;con_idconvocatoria;alu_idalumno;aprobado;cimientos_idalumno;cimientos_idas;
			 * compromisoprogramaresponsable;compromisoescolaridadresponsable;aptocomoresponsable;
			 * historiaas;boletin;fecha Incorp
			 */
			@Override
			public void handleLine(String line, Session session, int count) {
 				try{
					Scanner scanner = new Scanner(line);
					scanner.useDelimiter(";");
					EntrevistaSeleccion entrevistaSeleccion = new EntrevistaSeleccion();
					/*id segunda entrevista*/
					Long id = Long.parseLong(scanner.next());
					Date fechaEntrevista = null;
					SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy");
					try 
					{
						fechaEntrevista = sdf.parse(scanner.next());
					}
					catch (ParseException e) 
					{
						e.printStackTrace();
					}
					String participantes = null;
					/*participantes*/ 
					if(scanner.hasNext())
					{
						String participante = scanner.next();
						if(StringUtils.isNotBlank(participante))
						{
							participantes =participante;
						}
						else
						{
							participantes = "";
						}
					}
					String repitio = scanner.next();
					Integer anioRepitio = null;
					if(scanner.hasNext())
					{
						String anio = scanner.next();
						if(StringUtils.isNotBlank(anio))
						{
							anioRepitio =Integer.parseInt(anio);
						}
						else
						{
							anioRepitio = null;
						}
					}
					Integer cantidadInasistencias = null;
					if(scanner.hasNext())
					{
						String inasistencias = scanner.next();
						if(StringUtils.isNotBlank(inasistencias))
						{
							cantidadInasistencias =Integer.parseInt(inasistencias);
						}
						else
						{
							cantidadInasistencias = null;
						}
					}
					String materiasPendientes = scanner.next();
					String nombrePeriodo = scanner.next();
					String compromisoEscolar = scanner.next();
					String otraBeca = scanner.next();
					String percepcionesCandidato = scanner.next();
					String obsResponsable = scanner.next();
					String obsAsist = scanner.next();
					String posibilidadCompromiso = scanner.next();
					String fechaAlta = scanner.next();
					String fechaBaja = scanner.next();
					String idConvocatoria = scanner.next();
					ConvocatoriaSeleccion convocatoria = convocatorias.get(idConvocatoria);
					String idAlumno = scanner.next();
					String aprobado = scanner.next();
					/*cimi id alum*/ 
					String idAlumnoCimientos = scanner.next();
					/*cimi id as*/ 
					String idAsCimientos = scanner.next();
					/*compromiso prog RA*/ 
					String compromisoRespPbe = scanner.next();
					/*compromiso educ RA*/
					String compromisoRespEduc = scanner.next();
					/*apto RA*/ 
					String aptoResponsable = scanner.next();
					/*historiaas*/
					String historias = scanner.next();
					/*boletin*/
					String tieneBoletin = scanner.next();
					/*fechaInc*/
					String fechaInc;
					if(scanner.hasNext())
						fechaInc = scanner.next();
					
					entrevistaSeleccion.setFechaCargaEntrevista(fechaEntrevista);
					//entrevistaSeleccion.set
					//FIXME no hay tabla de equivalencias con el anio escolar
					if(repitio.equals("SI"))
						entrevistaSeleccion.setRepitio(true);
					else
						if(repitio.equals("NO"))
							entrevistaSeleccion.setRepitio(false);
					
					List<AnioEscolar> aniosRepitencia = AnioEscolar.getAnioEscolares();
					/*for (AnioEscolar anioRepitio2 : aniosRepitencia) {
						if(anioRepitio2.getValor().equalsIgnoreCase(anioRepitio))
						{
							entrevistaSeleccion.setAnioRepitio(anioRepitio2);
						}
					}*/
					entrevistaSeleccion.setCantidadInasistenciaAnioCurso(cantidadInasistencias);
					/*periodo notas*/ 
					entrevistaSeleccion.setNombrePeriodo(nombrePeriodo);
					
					/*compromiso escolar*/ 
					
					AlumnoSeleccion alumnoSeleccion = alumnos_seleccion.get(new Long(idAlumno));
					if(alumnoSeleccion != null){					
						List<Compromiso> compromisos = Compromiso.getCompromiso();
						for (Compromiso compromiso2 : compromisos) 
						{
							if(compromiso2.getValor().equalsIgnoreCase(compromisoEscolar))
							{
								alumnoSeleccion.setCompromisoEscolaridad(compromiso2);
							}
						}
						entrevistaSeleccion.setPercepcionesCandidato(percepcionesCandidato);
						//Esto es para tener un registro en el alumno, de la fecha de su ultima entrevista 
						alumnoSeleccion.setFechaEntrevista(fechaEntrevista);
						
						entrevistaSeleccion.setPerfilAlumno(alumnoSeleccion);
						/*otra beca*/
						Boolean recibeOtraBeca = Boolean.parseBoolean(otraBeca);
						entrevistaSeleccion.setRecibeOtraBeca(recibeOtraBeca);
						if(repitio.equals("SI"))
							entrevistaSeleccion.setRecibeOtraBeca(true);
						else
							if(repitio.equals("NO"))
								entrevistaSeleccion.setRecibeOtraBeca(false);
						
						
						alumnoSeleccion.getResponsable1().setObservaciones(obsResponsable);
						List<CompromisoPBE> compromisosPBE = CompromisoPBE.getCompromisoPBEs();
						for (CompromisoPBE compromisoPbe : compromisosPBE) 
						{
							if(compromisoPbe.getValor().equalsIgnoreCase(compromisoRespPbe))
							{
								alumnoSeleccion.getResponsable1().setIdCompromisoPBE(compromisoPbe);
		
							}
						}
		
						
						/*
						 * observaciones_asistente; posibilidad_compromiso; ver estos 2!
						 * 
						 * falta; fbaja; alu_idalumno; aprobado; cimientos_idalumno; cimientos_idas;
						 * compromisoprogramaresponsable; compromisoescolaridadresponsable; aptocomoresponsable;
						 * historiaas; boletin; fecha Incorp
						 */
						
						entrevistaSeleccion.setAbandono(false);
						
						if(anioRepitio != null && anioRepitio != 0){
							List<AnioEscolar> aniosRepitio = new ArrayList<AnioEscolar>();
							aniosRepitio.add(AnioEscolar.getAnioEscolar(anioRepitio));
							entrevistaSeleccion.setAnioRepitio(aniosRepitio);
						}
						
						//entrevistaSeleccion.setBoletinSeleccions(boletinSeleccions);
						entrevistaSeleccion.setConvocatoria(convocatoria);
						CicloPrograma cicloPrograma = ciclos.get(Formateador.extractYear(fechaEntrevista));
						Periodo periodo = PeriodoHelper.getPeriodoActual(cicloPrograma.getPeriodos(), fechaEntrevista);
						entrevistaSeleccion.setNombreCiclo(cicloPrograma.getNombre());
						entrevistaSeleccion.setNombrePeriodo(periodo.getNombre());
						entrevistaSeleccion.setEstadoEntrevistaAlumno(alumnoSeleccion.getEstadoAlumno());
						if(entrevistaSeleccion.getEstadoEntrevistaAlumno().equals(EstadoAlumno.PRESELECCIONADO)){
							entrevistaSeleccion.setMotivoEnvioTS(MotivoEnvioTS.DUDAS_RA);
						}
						session.save(entrevistaSeleccion);
						entrevistasSel.put(new Long(idAlumno), entrevistaSeleccion);
					}
					else{
						System.out.println("no se encontro el alumno con idTroop:" + idAlumno);
					}
 				} catch (Exception e) {
					System.out.println("Ocurrio un error en el registro " + (count + 1) + " del archivos entrev_seleccion.csv");
				}
			}

		};
	}

	/**
	 * @throws IOException
	 * @throws HibernateException
	 * 
	 */
	/**
	 * @throws IOException
	 * @throws HibernateException
	 * 
	 */
	private static void migrarStaff() throws HibernateException, IOException {

		Parser staff = new Parser(new File(FILE_HOME, "staff.csv"),
				sessionFactory.openSession()) {

			@Override
			public void handleLine(String line, Session session, int count) {
				/*
				 *idusuariostaff	Area/Programa	Rol	Estado	nombre	apellido
				 *	falta	fbaja	fecha_ingreso	Sexo	DNI	nro_documento	cuit
				 *	direccion_calle	direccion_numero	direccion_piso	direccion_dpto	codigo_postal	barrio
				 *	localidad	pro_idprovincia	pai_idpais	car_idcargo	are_idarea	pro_idprograma	username
				 *	password	falta	fbaja

				 */
				try{
					Scanner scanner = new Scanner(line);
					scanner.useDelimiter(";");
					
					String idTroop = scanner.next();
					String programa = scanner.next();
					String rol = scanner.next();
					boolean activo = scanner.next().equalsIgnoreCase("Activo");
					boolean tieneOtroRol = false;
					String nombre = scanner.next();
					String apellido = scanner.next();
					
					Persona persona = usuarios_nombre_apellido.get(apellido + " " + nombre); 
					if(persona == null ){
						persona = new Persona();
						persona.setActivo(true);
						persona.setApellido(apellido);
						persona.setNombre(nombre);					
					}
					
					PerfilStaff staff = new PerfilStaff();
					staff.setDatosPersonales(persona);
					staff.setActivo(true);
					session.save(staff);
					persona.setPerfilStaff(staff);
					
					if (rol.equalsIgnoreCase("Coordinador"))
					{
						if(programa.contains("PBE"))
						{
							persona.setPerfilCoordPBE(true);
							tieneOtroRol = true;
						}
					}
					if (programa.contains("DI")) 
					{
						persona.setPerfilDI(true);
						tieneOtroRol = true;
					}
					if (programa.contains("Adm")) 
					{
						persona.setPerfilAdmin(true);
						tieneOtroRol = true; 
					}
					if (rol.contains("EA")) 
					{
						if(programa.contains("PBE"))
						{
							PerfilEA ea = new PerfilEA();
							ea.setActivo(true);
							ea.setDatosPersonales(persona);
							ea.setZona(new ArrayList<ZonaCimientos>());
							session.save(ea);
							persona.setPerfilEA(ea);
							tieneOtroRol = true;
						}
					}
					if(rol.contains("TS"))
					{
						if(programa.contains("PBE"))
						{
							PerfilTS ts = new PerfilTS();
							ts.setActivo(true);
							ts.setDatosPersonales(persona);
							ts.setZonas(new ArrayList<ZonaCimientos>());
							session.save(ts);
							persona.setPerfilTS(ts);
							tieneOtroRol = true;
						}
					}
					if (rol.contains("RR")) 
					{
						if(programa.contains("PBE"))
						{
							PerfilRR rr = new PerfilRR();
							rr.setActivo(true);
							rr.setDatosPersonales(persona);
							rr.setZona(new ArrayList<ZonaCimientos>());
							rr.setEas(new ArrayList<PerfilEA>());
							session.save(rr);
							persona.setPerfilRR(rr);
							tieneOtroRol = true;
						}
					}
					if (rol.contains("Selección")) 
					{
						persona.setPerfilSelector(true);
						tieneOtroRol = true;
					}
					if (rol.contains("Administrador")) 
					{
						persona.setPerfilSysAdmin(true);
						tieneOtroRol = true;
					}
					if (rol.contains("Corrector")) 
					{
						persona.setPerfilCorrector(true);
						tieneOtroRol = true;
					}
					if (programa.contains("RRHH")) 
					{
						persona.setPerfilRRHH(true);
						tieneOtroRol = true;
					}
					if(programa.contains("PBE") && rol.contains("Asistente")){
						persona.setPerfilAsist(true);
						tieneOtroRol = true;
					}
					
					String[] ids = null;
					if (!idTroop.equals("No tuvo usuario en troop")) {
						if (idTroop.contains("/")) {
							ids = idTroop.split("/");
						} else {
							ids = new String[] { idTroop };
						}
					}
					/* fecha alta */
					String fechaAlta = scanner.next();
					/* fecha baja */
					String fechaBaja = scanner.next();
					/* fecha_ingreso */
					String fechaIngreso = scanner.next();
					/* sexo */
					String sexo = scanner.next();
					if(sexo.equalsIgnoreCase("f"))
						persona.setSexo(false);
					else {
						persona.setSexo(true);
					}
					/* dni */
					String dni = scanner.next();
					/* cuilcuit */
					String cuil = scanner.next();
					if (dni.equals("")) 
					{
						persona.setCuilCuit(cuil.replaceAll("-", ""));
						if(StringUtils.isNotBlank(cuil))
						{
							persona.setDni(Integer.parseInt(cuil.split("-")[1]));
						}
					} else 
					{
						if(dni.length() == 7)
							dni = "0" + dni; 
						persona.setDni(Integer.parseInt(dni));
						persona.setCuilCuit(calclarCuil(dni, persona.isSexo() ? 1: 2));
					}
					/* otro cuil */
					String otroCuil = scanner.next();
					/* direccion */
					String direccion = scanner.next();
					/* calle */
					String calle = scanner.next();
					/* piso */
					String piso = scanner.next();
					/* dpto */
					String depto = scanner.next();
					/* codigo postal */
					String cp = scanner.next();
					/* barrio */
					String barrio = scanner.next();
					/* pais */
					String localidad = scanner.next();
					/* idProvincia */
					String idProvincia = scanner.next();
					/* idPais */
					String idPais = scanner.next();
					/* id cargo */
					String idCargo = scanner.next();
					/* id area */
					String idArea = scanner.next();
					/* id prog */
					String idPrograma = scanner.next();
					/* usuario */
					String nombreUsuario = scanner.next();
					/* password */
					String password = scanner.next();
					/* otra fecha alta*/
					String otraFechaAlta = scanner.next();
					/* otra fecha baja*/
					String otraFechaBaja = scanner.next();
					/* nro cuenta*/
					String nroCuenta = scanner.next();
					/* id sucursal */
					String idSucursal = scanner.next();
					/* fecha nacimiento*/
					String fechaNacimiento = scanner.next();
					/* telefono*/
					String telefono = scanner.next();
					/* modalidad contratacion*/
					String modalidadContratacion = scanner.next();
					/* dedicacion */
					String cargaHoraria = scanner.next();
					/* legajo */
					String legajo = scanner.next();
					/* banco */
					String banco = "";
					if(scanner.hasNext())
						banco = scanner.next();
					persona.setDireccion(direccion);
					persona.setNumeroCalle(calle);
					
					if (!piso.equals("")) 
					{
						persona.setPiso(piso);
					}
					if (!depto.equals("")) 
					{
						persona.setDepartamento(depto);
					}
					if(!cp.equals(""))
						persona.setCodigoPostal(cp);
					
					if(!barrio.equals(""))
						persona.setBarrio(barrio);
					
					persona.setProvincia(provincias.get(idProvincia));
					persona.setLocalidad(localidades.get(localidad));
					fechaNacimiento = fechaNacimiento.trim();
					if(!fechaNacimiento.equals(""))
					{
						persona.setFechaNacimiento(Formateador.parsearFecha(fechaNacimiento));
					}
					if(!telefono.equals(""))
						if(telefono.contains("/") || telefono.contains("15-"))
						{
							String[] telefonos = telefono.split("/");
							for (int i = 0; i < telefonos.length; i++) 
							{
								if(telefonos[i].contains("15-"))
									persona.setCelular(telefonos[i]);
								else
									persona.setTelefono(telefonos[i]);
							}
						}	
						
					if(!idSucursal.equals(""))
						staff.setSucursal(sucursales.get(Long.valueOf(idSucursal)));
					
					if(!nroCuenta.equals(""))
					{
						staff.setNroCuenta(nroCuenta);
						staff.setEstadoCuenta(EstadoCuenta.ACTIVA);
					}
					else
					{
						staff.setEstadoCuenta(EstadoCuenta.NO_SOLICITADA);
					}

					fechaIngreso = fechaIngreso.trim();
					if(!fechaIngreso.equals(""))
						staff.setFechaIngreso(Formateador.parsearFecha(fechaIngreso));
					
					if(modalidadContratacion.equalsIgnoreCase("Relación de dependencia"))
						staff.setModalidadContratacion(ModalidadContratacion.EFECTIVO);
					else if (modalidadContratacion.equalsIgnoreCase("Voluntaria"))
						staff.setModalidadContratacion(ModalidadContratacion.VOLUNTARIA);
					else if (modalidadContratacion.equalsIgnoreCase("Plazo Fijo"))
						staff.setModalidadContratacion(ModalidadContratacion.PLAZO_FIJO);
					else if (modalidadContratacion.equalsIgnoreCase("Factura"))
						staff.setModalidadContratacion(ModalidadContratacion.FACTURA);
					else if (modalidadContratacion.equalsIgnoreCase("Otros"))
						staff.setModalidadContratacion(ModalidadContratacion.OTROS);
					else if (modalidadContratacion.equalsIgnoreCase(""))
						staff.setModalidadContratacion(ModalidadContratacion.VACIO);
					
					if(cargaHoraria.equalsIgnoreCase("full time"))
						staff.setCargaHoraria(CargaHoraria.FULLTIME);
					else if(cargaHoraria.equalsIgnoreCase("part time"))
						staff.setCargaHoraria(CargaHoraria.PARTTIME);
					
					legajo = legajo.trim(); 
					if(!legajo.equals(""))
						if(legajo.equals("-"))
							staff.setLegajo(null);
						else
							staff.setLegajo(Long.valueOf(legajo));
					

					Banco unBanco = bancos.get(banco);
					if(unBanco != null)
					{
						if(unBanco.getNombre().equalsIgnoreCase("Galicia") || unBanco.getNombre().equalsIgnoreCase("Macro")|| unBanco.getNombre().equalsIgnoreCase("Industrial"))
							staff.setBanco(bancos.get(banco));
					}
					else 
						staff.setBanco(null);
					staff.setPiso(persona.getPiso());
					staff.setNroCalle(persona.getNumeroCalle());
					staff.setCodigoPostal(persona.getCodigoPostal());
					staff.setDpto(persona.getDepartamento());
					
					Usuario credenciales = new Usuario();
					if(tieneOtroRol)
					{
						credenciales.setActivo(activo);
						credenciales.setUsuario(nombreUsuario);
						credenciales.setPassword(password);
						credenciales.setPersona(persona);
						credenciales.setNombre(persona.getNombre());
						session.save(credenciales);
						persona.setCredenciales(credenciales);
						staff.setDatosPersonales(credenciales.getPersona());
						
					}
					session.update(staff);
					session.update(persona);
					usuarios_nombre_apellido.put(persona.getApellido() + " " + persona.getNombre(), persona);
					if (ids != null) 
					{
						for (String id : ids) 
						{
							usuarios.put(id, persona);
						}
					}
				} catch (Exception e) {
					System.out.println("Ocurrio un error en el registro " + (count + 1) + " del archivos staff.csv");
				}
			}
		};
		
		// zonas eas y rr
		Parser zonasEasRrParser = new Parser(new File(FILE_HOME,
				"eas_rrs_zonas.csv"), sessionFactory.openSession()) {

			@Override
			public void handleLine(String line, Session session, int count) {
				try{
					Scanner scanner = new Scanner(line);
					scanner.useDelimiter(";");
					String idEa = scanner.next();
					String apellidoEa = scanner.next();
					String nombreEa = scanner.next();
					String idZona = scanner.next();
					String zona = scanner.next();
					ZonaCimientos zonaCimientos = zonas.get(idZona);
					List<ZonaCimientos> zonas = new ArrayList<ZonaCimientos>();
					zonas.add(zonaCimientos);
					String idRr = scanner.next();
					String apellidoRr = scanner.next();
					String nombreRr = scanner.next();
					Persona personaEa = null;
					Persona personaRr = null;
					
					personaEa = usuarios.get(idEa);
				
					personaRr = usuarios.get(idRr);
					
					if(personaEa != null)
					{
						PerfilEA eaPerfil = personaEa.getPerfilEA();
						if(eaPerfil != null)
						{
							eaPerfil.getZona().add(zonaCimientos);
							session.update(eaPerfil);
						}
						else
						{
							PerfilEA ea = new PerfilEA();
							ea.setActivo(true);
							ea.getZona().add(zonaCimientos);
							ea.setDatosPersonales(personaEa);
							session.save(ea);
							personaEa.setPerfilEA(ea);
							session.update(personaEa);
						}
	
					}
					else
					{
						PerfilEA eaPerfil = new PerfilEA();
						eaPerfil.setActivo(true);
						String nombre = nombreEa;
						String apellido = apellidoEa;
						
						Persona persona = usuarios_nombre_apellido.get(apellido + " " + nombre);
						if(persona == null ){
							System.out.println("");		
						}
						else
						{
							session.save(persona);
							eaPerfil.setDatosPersonales(persona);
							eaPerfil.setZona(zonas);
							session.save(eaPerfil);
							persona.setPerfilEA(eaPerfil);
							session.update(persona);
						}
					}
					if(personaRr != null)
					{
						PerfilRR rrPerfil = personaRr.getPerfilRR();
						if(rrPerfil != null)
						{
							
							
							if(!rrPerfil.getZona().contains(zonaCimientos)){
								rrPerfil.getZona().add(zonaCimientos);
							}
							session.update(rrPerfil);
							if(personaEa.getPerfilEA() != null)
							{
								PerfilEA eaPerfil = personaEa.getPerfilEA();
								rrPerfil.getEas().add(eaPerfil);
								eaPerfil.setRr(rrPerfil);
								session.update(eaPerfil);
							}
							else
							{
								System.out.println("");
								PerfilEA ea = new PerfilEA();
								ea.setActivo(true);
								ea.setZona(new ArrayList<ZonaCimientos>());
								ea.getZona().add(zonaCimientos);
								ea.setDatosPersonales(personaEa);
								session.save(ea);
								personaEa.setPerfilEA(ea);
								session.update(personaEa);
							}
							
						}
						else
						{
							System.out.println("");
							PerfilRR rr = new PerfilRR();
							rr.setActivo(true);
							rr.setZona(new ArrayList<ZonaCimientos>());
							rr.getZona().add(zonaCimientos);
							rr.setDatosPersonales(personaRr);
							personaRr.setPerfilRR(rr);
							if(personaEa.getPerfilEA() != null)
							{
							PerfilEA eaPerfil = personaEa.getPerfilEA();
							rr.setEas(new ArrayList<PerfilEA>());
							rr.getEas().add(eaPerfil);
							eaPerfil.setRr(rr);
							session.update(eaPerfil);
							}
	
							session.save(rr);
							session.update(personaRr);
						}
	
					}
					else
					{
						PerfilRR rrPerfil = new PerfilRR();
						rrPerfil.setActivo(true);
						String nombre = nombreRr;
						String apellido = apellidoRr;
						
						Persona persona = usuarios_nombre_apellido.get(apellido + " " + nombre);
						if(persona == null ){
							System.out.println("");
						}
						else
						{
							session.save(persona);
							rrPerfil.setDatosPersonales(persona);
							rrPerfil.setZona(zonas);
							session.save(rrPerfil);
							persona.setPerfilRR(rrPerfil);
							session.update(persona);
						}
					}
				} catch (Exception e) {
					System.out.println("Ocurrio un error en el registro " + (count + 1) + " del archivos eas_rrs_zonas.csv");
				}
			}
		};
		

	}

	/**
	 * @throws IOException
	 * @throws HibernateException
	 * 
	 */
	private static void migrarEntrevistas() throws HibernateException,
			IOException {


			Parser entrevistasRenovacion = new Parser(new File(FILE_HOME,
				"entrev_finales_2010.csv"), sessionFactory.openSession()) {
			@Override
			public void handleLine(String line, Session session, int count) 
			{

				/*
				 * id_alumno;IdEscuela;IdGrado;id_beca;id_informe;tipo_entrevista
				 * ;zona_cimientos;EA;RR;apellido_alumno;
				 * nombre_alumno
				 * ;fecha_incorporacion_al_pbe;tipo_de_documento_alumno
				 * ;Nº_documento_alumno
				 * ;Edad;Sexo;Asistio_becado;Asistio_ra;Material_completo
				 * ;Periodo_entrevista
				 * ;Fecha_de_entrevista;Total_inasistencias;Esfuerzo
				 * ;Conducta;Compromiso_del_alumno_con_pbe
				 * ;Compromiso_del_alumno_con_escolaridad
				 * ;Compromiso_del_ra_con_pbe
				 * ;Estado;Motivo_de_suspension;Motivo_de_cesacion
				 * ;Logros;Dificultades
				 * ;Propositos;Situacion_escolar;Evaluacion_renovacion_de_la_beca
				 * ;motivo_no_renovacion;Observaciones;Padrino;;;;
				 */
				try{
					Scanner scanner = new Scanner(line);
					scanner.useDelimiter(";");
					EntrevistaFinal entrevista = new EntrevistaFinal();
					String id = scanner.next();
					Long idAlumno = null;
					if(StringUtils.isNotBlank(id))
					{
						idAlumno = Long.parseLong(id);
					}
					PerfilAlumno alumno = alumnos.get(idAlumno);
					if (alumno == null) {
						System.out.println("No se puso migrar la entrevista final 2010 del alumno idTroop "+ idAlumno +
						" porque dicho alumno no existe en el archivo alumnos_2011");
						return;
					}

					entrevista.setPerfilAlumno(alumno);
					String idEsc = scanner.next();
					Long idEscuela = null;
					Escuela escuela = null;
					if(StringUtils.isNotBlank(idEsc))
					{
						escuela = escuelas.get(idEsc);				
					}
					entrevista.setLugarEntrevista(escuela);
					alumno.setEscuela(escuela);
					
					if(alumno.getEscuela() != null)
						entrevista.setEscuelaAlumno(alumno.getEscuela());
					else
						entrevista.setEscuelaAlumno(escuela);
					
					String anioString = scanner.next();
					Integer anio = null;
					if(StringUtils.isNotBlank(anioString))
					{
						anio = Integer.parseInt(anioString);
						entrevista.setAnioEscolar(AnioEscolar.getAnioEscolar(anio));
					}
					
					/* beca */
					String beca = scanner.next();
					Long idBeca = Long.parseLong(beca);
					/* id infrome */
					String idInforme = scanner.next();
					/* tipo entrevista */
					String tipoEntrevista = scanner.next();
					entrevista.setTipoEntrevista(TipoEntrevista.FINAL);
					/* zona id */ 
					String idZona = scanner.next();
					/* zona */
					String zona = scanner.next();
					/* ea */
					String eaNombreApellido = StringUtils.stripEnd(scanner.next(), " ");
					String idUsuario = scanner.next();
					String[] idsEas = null;
					
					if (!idUsuario.equals("No tuvo usuario en troop")) {
						if (idUsuario.contains("/")) {
							idsEas = idUsuario.split("/");
						} else {
							idsEas = new String[] { idUsuario };
						}
					}
					if (idsEas != null) {
						for (String idUsuarioEa : idsEas) {
							Persona usuario = usuarios.get(idUsuarioEa);
							if(usuario == null)
							{
								System.out.println("no existe el usuario " + idUsuario + " en el staff");
							}
							else
							{
							if(usuario.getPerfilEA() != null)
							{
								PerfilEA ea = usuario.getPerfilEA();
								ea.agregarBecado(alumno);
								alumno.setEa(ea);
								entrevista.setEa(ea);
								session.update(ea);
								//session.save(alumno);
							}
							else
							{
								PerfilEA ea = new PerfilEA();
								ea.setActivo(true);
								ea.setDatosPersonales(usuario);
								ea.agregarBecado(alumno);
								alumno.setEa(ea);
								entrevista.setEa(ea);
								session.save(ea);
								//session.save(alumno);
								usuario.setPerfilEA(ea);
								session.update(usuario);
							}
							}
						}
					}
	
					/* rr */
					String rrNombreApellido = StringUtils.stripEnd(scanner.next(), " ");		
					String idRr = scanner.next();
					String[] idsRrs = null;
					if (!idRr.equals("No tuvo usuario en troop")) {
						if (idRr.contains("/")) {
							idsRrs = idRr.split("/");
						} else {
							idsRrs = new String[] { idRr };
						}
					}
					if (idsRrs != null) {
						for (String idUsuarioRr : idsRrs) {
							Persona usuario = usuarios.get(idUsuarioRr);
							if(usuario == null)
							{
								System.out.println("no existe el usuario " + idUsuarioRr + " en el staff");
							}
							else
							{
							if(usuario.getPerfilRR() != null)
							{
								PerfilRR rr = usuario.getPerfilRR();
								entrevista.setRr(rr);	
								//session.update(rr);
							}
							else
							{
								PerfilRR rr = new PerfilRR();
								rr.setActivo(true);
								rr.setDatosPersonales(usuario);
								entrevista.setRr(rr);
								//session.save(rr);
								//session.save(alumno);
								usuario.setPerfilRR(rr);
								session.update(usuario);
							}
							}
						}
					}
					/* apellido alumno */
					String apellidoAlu = scanner.next();
					/* nombre alumno */
					String nombreAlu = scanner.next();
					String fecha = scanner.next();
					Date fechaPbe = null;
					
					try
					{
						SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy");
						
						if(StringUtils.isNotBlank(fecha))
						{
							alumno.setFechaPBE(sdf.parse(fecha));
						}
						
//					if(StringUtils.isNotBlank(fecha))
//					{
//						fechaPbe = FormateadorMeses.getFecha(fecha);
//						alumno.setFechaPBE(fechaPbe);
//					}
					
					//TODO poner una fecha por defecto para los alumnos que no traigan en la migracion. Se puede poner una fija para todos
					
					/* tipo dni */
					String tipoDni = scanner.next();
					/* dni */
					String dni = scanner.next();
					/* edad */
					String edad = scanner.next();
					Integer edadAlumno = null;
					if(StringUtils.isNotBlank(edad))
					{
						edadAlumno = Integer.parseInt(edad);
					}
					/* sexo */
					String sexo = scanner.next();
					String participoBecado = scanner.next();
					String participoRa = scanner.next();
					String materialCompleto = scanner.next();
					entrevista.setParticipoBecado(participoBecado.equals("SI") ? true: false);
					entrevista.setParticipoRA(participoRa.equals("SI") ? true: false);
					entrevista.setMaterialCompleto(materialCompleto.equals("SI") ? true: false);
					/* periodo */
					String periodo = scanner.next();// seteear a dic 2010?
					String fechaCarga = scanner.next();
					Date fechaDeCarga = null;
					if(StringUtils.isNotBlank(fechaCarga))
					{
						entrevista.setFechaCarga(sdf.parse(fechaCarga));
						entrevista.setFechaEntrevista(entrevista.getFechaCarga());
					}
					else{
						CicloPrograma ciclo = ciclos.get("2010");
						entrevista.setFechaCarga(ciclo.getFechaInicio());
						entrevista.setFechaEntrevista(entrevista.getFechaCarga());
					}
										
					
	
					/* inasistencias */
					String inas = scanner.next();
					Float inasistencias = null;
					if(StringUtils.isNotBlank(inas)){
						inasistencias = Float.parseFloat(inas);
					}
					entrevista.setCantidadInasistencias(inasistencias);
					/* esfuerzo */
					String esfuerzo = scanner.next();
					/* conducta */
					String conducta = scanner.next();
					/* compromiso PBE */
					String comproPbe = scanner.next();
					/* comromiso escolaridad */
					String comproEscolar = scanner.next();
					String compromisoRA = scanner.next();
					if (compromisoRA.equalsIgnoreCase("excelente")) {
						entrevista.setCompromisoRA(Compromiso.EXCELENTE);
					} else if (compromisoRA.equalsIgnoreCase("muy bueno")) {
						entrevista.setCompromisoRA(Compromiso.MUYBUENO);
					} else if (compromisoRA.equalsIgnoreCase("bueno")) {
						entrevista.setCompromisoRA(Compromiso.BUENO);
					} else if (compromisoRA.equalsIgnoreCase("regular")) {
						entrevista.setCompromisoRA(Compromiso.REGULAR);
					} else if (compromisoRA.equalsIgnoreCase("malo")) {
						entrevista.setCompromisoRA(Compromiso.MALO);
					}
					String pago = scanner.next();
					if (pago.equalsIgnoreCase("aprobado")) {
						entrevista
								.setEvaluacionCobroBeca(EvaluacionCobroBeca.APROBADO);
					} else if (pago.equalsIgnoreCase("suspendido")) {
						entrevista
								.setEvaluacionCobroBeca(EvaluacionCobroBeca.SUSPENDIDO);
					} else {
						entrevista
								.setEvaluacionCobroBeca(EvaluacionCobroBeca.DUDOSO);
					}
					/* motivo suspension */
					String motivoSuspension = scanner.next();
					if(StringUtils.isNotBlank(motivoSuspension)){
						MotivoSuspension motivo = null;
						if(motivoSuspension.equalsIgnoreCase("Desempeño escolar insufic")){
							motivo = MotivoSuspension.DESEMPENO;
						}else if (motivoSuspension.equalsIgnoreCase("Inasis a entrev. s/justific.")){
							motivo = MotivoSuspension.INASISTENCIAESJ;
						}else if (motivoSuspension.equalsIgnoreCase("2 inasis consec a ent. bdo/RA ")){
							motivo = MotivoSuspension.INASISTENCIACE;
						}else if (motivoSuspension.equalsIgnoreCase("Inasis a Jornada s/justific.")){
							motivo = MotivoSuspension.INASISTENCIAJ;
						}else if (motivoSuspension.equalsIgnoreCase("Más de 5 faltas o 10 x Trim")){
							motivo = MotivoSuspension.FALTAS;
						}else if (motivoSuspension.equalsIgnoreCase("Pérdida condic.alumno reg")){
							motivo = MotivoSuspension.PERDIDAREGULAR;
						}else if (motivoSuspension.equalsIgnoreCase("Conducta insuficiente")){
							motivo = MotivoSuspension.CONDUCTA;
						}else if (motivoSuspension.equalsIgnoreCase("Falta material varias veces")){
							motivo = MotivoSuspension.FALTAMATERIAL;
						}
						entrevista.setMotivoSuspension(motivo);
					}
					
					/* motivo cesacion */
					String motivoCesacion = scanner.next();
					String logros = scanner.next();
					entrevista.setLogros(logros);
					String dificultades = scanner.next();
					entrevista.setDificultades(dificultades);
					String proposito = scanner.next();
					entrevista.setProposito(proposito);
					String situacionEscolar = scanner.next();
					String evaluacionRenovacion = scanner.next();
					String motivoNoRenovacion = scanner.next();
					
					if(StringUtils.isNotBlank(motivoNoRenovacion)){
						MotivoNoRenovacion motivo = null;
						if(motivoNoRenovacion.equalsIgnoreCase("Abandono escolar")){
							motivo = MotivoNoRenovacion.ABANDONO;
						}else if (motivoNoRenovacion.equalsIgnoreCase("Cambio situación económica")){
							motivo = MotivoNoRenovacion.CAMBIOSITUACIONECO;
						}else if (motivoNoRenovacion.equalsIgnoreCase("incumpl compromisos escolares")){
							motivo = MotivoNoRenovacion.BAJOCOMPROMISO;
						}else if (motivoNoRenovacion.equalsIgnoreCase("incumpl compromisos PBE")){
							motivo = MotivoNoRenovacion.BAJOCOMPROMISO;
						}else if (motivoNoRenovacion.equalsIgnoreCase("Mudanza / PBE no está")){
							motivo = MotivoNoRenovacion.MUDANZA;
						}else if (motivoNoRenovacion.equalsIgnoreCase("renuncia a la beca")){
							motivo = MotivoNoRenovacion.RENUNCIABECA;
						}else if (motivoNoRenovacion.equalsIgnoreCase("repitencia")){
							motivo = MotivoNoRenovacion.REPITENCIA;
						}
						entrevista.setMotivoNoRenovacion(motivo);
					}
					
					if (situacionEscolar.equalsIgnoreCase("Pendiente")) 
					{
//						entrevista.setResultadoAnioEscolar(ResultadoAnioEscolar.PENDIENTE);
						entrevista.setSituacionEscolarMergeada(SituacionEscolarMergeada.PENDIENTE);		//!!!
					} 
				    else if (situacionEscolar.equalsIgnoreCase("Egreso")) 
					{
//				    	entrevista.setResultadoAnioEscolar(ResultadoAnioEscolar.EGRESO);
				    	entrevista.setSituacionEscolarMergeada(SituacionEscolarMergeada.EGRESO);	//!!!
					} 
					else if (situacionEscolar.equalsIgnoreCase("Promovido")) 
					{
//						entrevista.setResultadoAnioEscolar(ResultadoAnioEscolar.PROMOVIDO);
						entrevista.setSituacionEscolarMergeada(SituacionEscolarMergeada.PROMOVIDO);		//!!!
					} 
					else if (situacionEscolar.equalsIgnoreCase("Promovido con previas")) 
					{ 
//						entrevista.setResultadoAnioEscolar(ResultadoAnioEscolar.PROMOVIDO_CON_PREVIAS); 
						entrevista.setSituacionEscolarMergeada(SituacionEscolarMergeada.PROMOVIDO_CON_PREVIAS);		//!!! 
					} 
					else
					{ 
//						entrevista.setResultadoAnioEscolar(ResultadoAnioEscolar.REPITIO);
						entrevista.setSituacionEscolarMergeada(SituacionEscolarMergeada.REPITIO);		//!!!
					}
					
					
					
					if (evaluacionRenovacion.equalsIgnoreCase("Fin de participación PFE")) 
					{
						entrevista.setEvaluacionRenovacionFinal(EvaluacionRenovacionFinal.FIN_PARTICIPACION_PFE);
						alumno.setEstadoAlumno(EstadoAlumno.EGRESADO);
					} 
					else if (evaluacionRenovacion.equalsIgnoreCase("No Renueva")) 
					{
						entrevista.setEvaluacionRenovacionFinal(EvaluacionRenovacionFinal.NO_RENUEVA);
						alumno.setEstadoAlumno(EstadoAlumno.NO_RENOVADO);
					} 
					else if (evaluacionRenovacion.equalsIgnoreCase("En condiciones de Renovar"))
					{
						entrevista.setEvaluacionRenovacionFinal(EvaluacionRenovacionFinal.EN_CONDICIONES_DE_RENOVAR);
						alumno.setEstadoAlumno(EstadoAlumno.PENDIENTE_RENOVACION_SIN_ASIGNACION);
						alumno.setEstadoRenovacion(entrevista.getEvaluacionRenovacionFinal());
					}
					else if (evaluacionRenovacion.equalsIgnoreCase("Pendiente"))
					{
						entrevista.setEvaluacionRenovacionFinal(EvaluacionRenovacionFinal.PENDIENTE);
						alumno.setEstadoAlumno(EstadoAlumno.PENDIENTE_RENOVACION_SIN_ASIGNACION);
						alumno.setEstadoRenovacion(entrevista.getEvaluacionRenovacionFinal());		
					}
					
					String observaciones = scanner.next();
					entrevista.setObservaciones(observaciones);
					entrevista.setObservacionesGenerales(observaciones);
					String nombrePadrino = scanner.next();
					String idPadrino = scanner.next();	
					Beca becaAlumno = null;
					if(StringUtils.isNotBlank(idPadrino))
					{
						Long idP = Long.parseLong(idPadrino);
						PerfilPadrino padrino = (padrinos.get(idP));
						if(padrino == null)
						{
							System.out.println("el padrino " + idP + " no existe!");
						}
						else
						{
								List<Beca> becas = padrino.getBecas();
								if (becas != null) 
								{
									for (Beca beca2 : becas) 
									{
										
											if(beca2.getZona().equals(alumno.getEscuela().getLocalidad().getZona()) &&  beca2.getCiclo().getNombre().equalsIgnoreCase("2010"))
											{
												becaAlumno = beca2;
												if (alumno.getEstadoAlumno().equals(EstadoAlumno.PENDIENTE_RENOVACION_SIN_ASIGNACION)){
													alumno.setBeca(beca2);
													beca2.getBecados().add(alumno);
													beca2.setCantidadAsignada(beca2.getCantidadAsignada()+1);
												}
												break;
											}
										
									}
									if(alumno.getBeca() == null)
									{
										alumno.setBeca(null);
										//System.out.println("********* el alumno " + idAlumno + " tiene estado: " + alumno.getEstadoAlumno().getValor() + " y por eso no tiene beca. ");
									}
								} 
								else 
								{
									//System.out.println("el padrino " + idPadrino + " no tiene becas");
								}
						}
					}
					
					if(becaAlumno == null){
						System.out.println("No se puso migrar la entrevista final 2010 del alumno idTroop "+ idAlumno +
						" porque no se pudo asignar una beca al alumno");
						return;
					}
					
					// Pablo
					entrevista.setEstadoEntrevista(EstadoEntrevista.FINALIZADA);
					if(alumno.getFechaAltaBeca() != null)
					{
						entrevista.setFechaAltaBeca(alumno.getFechaAltaBeca());
					}
					else
					{
						Calendar cal = Calendar.getInstance();
						int hora, minutos, segundos;
						hora = cal.get(Calendar.HOUR_OF_DAY);
						minutos = cal.get(Calendar.MINUTE);
						segundos = cal.get(Calendar.SECOND);
						String horario = String.valueOf(hora) + ":" + String.valueOf(minutos) + ":" + String.valueOf(segundos); 
						String unaFecha = "01/01/2010 " + horario;
						Date fechaAltaBeca = Formateador.parsearFechaConHora(unaFecha);
						alumno.setFechaAltaBeca(fechaAltaBeca);
						entrevista.setFechaAltaBeca(alumno.getFechaAltaBeca());
						
					}
					
					if(entrevista.getFechaCarga() == null){
						entrevista.setFechaCarga(alumno.getFechaAltaBeca());
						entrevista.setFechaEntrevista(entrevista.getFechaCarga());
					}
					entrevista.setPerfilAlumno(alumno);
					
					if(alumno.getBeca() != null)
					{
						Periodo unPeriodo = alumno.getBeca().getCiclo().getPeriodos().get(alumno.getBeca().getCiclo().getPeriodos().size() - 1);
						entrevista.setPeriodoDePago(unPeriodo);
					}
					// Fin Pablo
					session.update(alumno);
					entrevista.setPagaEntrevista(true);
					agregarExportacionEspecial(entrevista, alumno, edadAlumno, becaAlumno, session);
					session.save(entrevista);
					AlumnoPanelEA ape = alumnos_panelEA.get(alumno.getId());
					actualizarAlumnoPanelEa(ape,alumno,entrevista.getFechaEntrevista());
					session.update(ape);
	
				} catch (ParseException e) {
					e.printStackTrace();
				}
					
			} catch (Exception e) {
				System.out.println("Ocurrio un error en el registro " + (count + 1) + " del archivos entrev_finales_2010.csv");
			}
			}
		};
	

		Parser entrevistasCesacion = new Parser(new File(FILE_HOME,
				"entrev_cesados_2010.csv"), sessionFactory.openSession()) {
			@Override
			public void handleLine(String line, Session session, int count) {

				/*
				 * id_alumno;IdEscuela;IdGrado;id_beca;id_informe;tipo_entrevista
				 * ;zona_cimientos;EA;RR;apellido_alumno;
				 * nombre_alumno
				 * ;fecha_incorporacion_al_pbe;tipo_de_documento_alumno
				 * ;Nº_documento_alumno
				 * ;Edad;Sexo;Asistio_becado;Asistio_ra;Material_completo
				 * ;Periodo_entrevista
				 * ;Fecha_de_entrevista;Total_inasistencias;Esfuerzo
				 * ;Conducta;Compromiso_del_alumno_con_pbe
				 * ;Compromiso_del_alumno_con_escolaridad
				 * ;Compromiso_del_ra_con_pbe
				 * ;Estado;Motivo_de_suspension;Motivo_de_cesacion
				 * ;Logros;Dificultades
				 * ;Propositos;Situacion_escolar;Evaluacion_renovacion_de_la_beca
				 * ;motivo_no_renovacion;Observaciones;Padrino;;;;
				 */
				try{
					Scanner scanner = new Scanner(line);
					scanner.useDelimiter(";");
					EntrevistaIndividual entrevista = new EntrevistaIndividual();
					String id = scanner.next();
					Long idAlumno = null;
					if(StringUtils.isNotBlank(id))
					{
						idAlumno = Long.parseLong(id);
					}
					PerfilAlumno alumno = alumnos.get(idAlumno);
					if (alumno == null) {
						System.out.println("No se puso migrar la entrevista de cesación 2010 del alumno idTroop "+ idAlumno +
						" porque dicho alumno no existe en el archivo alumnos_2011");
						return;
					}

					entrevista.setPerfilAlumno(alumno);
	
					String idEsc = scanner.next();
					Escuela escuela = null;
					if(StringUtils.isNotBlank(idEsc))
					{
						escuela = escuelas.get(idEsc);
					}
					entrevista.setLugarEntrevista(escuela);
					
					if(alumno.getEscuela() != null)
						entrevista.setEscuelaAlumno(alumno.getEscuela());
					else
						entrevista.setEscuelaAlumno(escuela);
					
					String anioString = scanner.next();
					Integer anio = null;
					if(StringUtils.isNotBlank(anioString))
					{
						anio = Integer.parseInt(anioString);
						entrevista.setAnioEscolar(AnioEscolar.getAnioEscolar(anio));
					}
					/* beca */String idBeca = scanner.next();
					/* id infrome */String idInforme = scanner.next();
					/* tipo entrevista */String tipo = scanner.next();
					entrevista.setTipoEntrevista(TipoEntrevista.MENSUAL);
					/* id zona */ String idZona = scanner.next();
					/* zona */String zona = scanner.next();
					String idUsuario = scanner.next();
					/* ea */String eaNombreApellido = StringUtils.stripStart(scanner.next(), " ");	
					
					String[] idsEas = null;
					if (!idUsuario.equals("No tuvo usuario en troop")) {
						if (idUsuario.contains("/")) {
							idsEas = idUsuario.split("/");
						} else {
							idsEas = new String[] { idUsuario };
						}
					}
					if (idsEas != null) {
						for (String idUsuarioEa : idsEas) {
							Persona usuario = usuarios.get(idUsuarioEa);
							if(usuario == null)
							{
								System.out.println("no existe el usuario " + idUsuario + " en el staff");
							}
							else
							{
							if(usuario.getPerfilEA() != null)
							{
								PerfilEA ea = usuario.getPerfilEA();
								ea.agregarBecado(alumno);
								alumno.setEa(ea);
								entrevista.setEa(ea);
								session.update(ea);
								//session.save(alumno);
							}
							else
							{
								PerfilEA ea = new PerfilEA();
								ea.setActivo(true);
								ea.agregarBecado(alumnos.get(idAlumno));
								alumno.setEa(ea);
								entrevista.setEa(ea);
								session.save(ea);
								//session.save(alumno);
								usuario.setPerfilEA(ea);
								session.update(usuario);
							}
							}
						}
					}
	
					String idRr = scanner.next();
					/* rr */
					String rrNombreApellido = StringUtils.stripEnd(scanner.next(), " ");
					String[] idsRrs = null;
					if (!idRr.equals("No tuvo usuario en troop")) {
						if (idRr.contains("/")) {
							idsRrs = idRr.split("/");
						} else {
							idsRrs = new String[] { idRr };
						}
					}
					if (idsRrs != null) 
					{
						for (String idUsuarioRr : idsRrs) 
						{
							Persona usuario = usuarios.get(idUsuarioRr);
							if(usuario == null)
							{
								System.out.println("no existe el usuario " + idUsuarioRr + " en el staff");
							}
							else
							{
								if(usuario.getPerfilRR() != null)
								{
									PerfilRR rr = usuario.getPerfilRR();
									entrevista.setRr(rr);	
									//session.update(rr);
								}
								else
								{
									PerfilRR rr = new PerfilRR();
									rr.setActivo(true);
									entrevista.setRr(rr);
									session.save(rr);
									//session.save(alumno);
									usuario.setPerfilRR(rr);
									session.update(usuario);
								}
							}
						}
					}
					/* apellido */String apellidoAlu = scanner.next();
					/* nombre */String nombreAlu = scanner.next();
					String fecha = scanner.next();
					Date fechaPbe = null;
					try 
					{
						SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy");
						
						if(StringUtils.isNotBlank(fecha))
						{
							alumno.setFechaPBE(sdf.parse(fecha));
						}
						
//						if(StringUtils.isNotBlank(fecha))
//						{
//							fechaPbe = FormateadorMeses.getFecha(fecha);
//							alumno.setFechaPBE(fechaPbe);
//						}
						
						/* tipo dni */
						String tipoDni = scanner.next();
						/* dni */String dni = scanner.next();
						/* edad */String edad = scanner.next();
						Integer edadAlumno = null;
						if(StringUtils.isNotBlank(edad))
						{
							edadAlumno = Integer.parseInt(edad);
						}
	
						/* sexo */String sexo = scanner.next();
						String participoBecado = scanner.next();
						String participoRa = scanner.next();
						String materialCompleto = scanner.next();
						//alumno.setFechaPBE(sdf.parse(scanner.next()));
				
						if(participoBecado.equals("SI"))
						{
							entrevista.setParticipoBecado(true);
						}
						else if(participoBecado.equals("NO"))
						{
							entrevista.setParticipoBecado(false);
						}
						
						if(participoRa.equals("SI"))
						{
							entrevista.setParticipoRA(true);
						}
						else if(participoRa.equals("NO"))
						{
							entrevista.setParticipoRA(false);
						}
	
						if(materialCompleto.equals("SI"))
						{
							entrevista.setMaterialCompleto(true);
						}
						else if(materialCompleto.equals("NO"))
						{
							entrevista.setMaterialCompleto(false);
						}
						
						/* periodo */
						String periodo = scanner.next();// seteear a dic 2010?
						String fechaCarga = scanner.next();
						entrevista.setFechaCarga(sdf.parse(fechaCarga));
						// Pablo
						entrevista.setFechaEntrevista(entrevista.getFechaCarga());
						alumno.setFechaBaja(entrevista.getFechaEntrevista());
						// Fin Pablo
	
						/* inasistencias */String inas = scanner.next();
						Float inasistencias = null;
						if(StringUtils.isNotBlank(inas)){
							inasistencias = Float.parseFloat(inas);
						}
						entrevista.setCantidadInasistencias(inasistencias);
						/* esfuerzo */String esfuerzo = scanner.next();
						/* conducta */String conducta = scanner.next();
						/* compromiso PBE */String comproPbe = scanner.next();
						/* comromiso escolaridad */String comproEscolar = scanner.next();
						String compromisoRA = scanner.next();
						if (compromisoRA.equalsIgnoreCase("excelente")) {
							entrevista.setCompromisoRA(Compromiso.EXCELENTE);
						} else if (compromisoRA.equalsIgnoreCase("muy bueno")) {
							entrevista.setCompromisoRA(Compromiso.MUYBUENO);
						} else if (compromisoRA.equalsIgnoreCase("bueno")) {
							entrevista.setCompromisoRA(Compromiso.BUENO);
						} else if (compromisoRA.equalsIgnoreCase("regular")) {
							entrevista.setCompromisoRA(Compromiso.REGULAR);
						} else if (compromisoRA.equalsIgnoreCase("malo")) {
							entrevista.setCompromisoRA(Compromiso.MALO);
						}
						String estadoPago = scanner.next();
						entrevista
								.setEvaluacionCobroBeca(EvaluacionCobroBeca.CESADO);
						/* motivo suspension */
						String motivoSusp = scanner.next();
						if(StringUtils.isNotBlank(motivoSusp))					
						{
							List<MotivoSuspension> motivos = MotivoSuspension.getMotivoSuspension();
							for (MotivoSuspension motivoSuspension : motivos) {
								if(motivoSuspension.getValor().equals(motivoSusp))
								{
									entrevista.setMotivoSuspension(motivoSuspension);
								}
							}
						}
						/* motivo cesacion */
						String motivoCesacion = scanner.next();
						if(StringUtils.isNotBlank(motivoCesacion))
						{
							List<MotivoCesacion> motivos = MotivoCesacion.getMotivoCesacion();
							for (MotivoCesacion motivoCes : motivos) {
								if(motivoCes.getValor().equalsIgnoreCase(motivoCesacion))
								{
									entrevista.setMotivoCesacion(motivoCes);
								}
							}
						}
	
						
						String logros = scanner.next();
						entrevista.setLogros(logros);
						String dificultades = scanner.next();
						entrevista.setDificultades(dificultades);
						String proposito = scanner.next();
						entrevista.setProposito(proposito);
						String situacionEscolar = scanner.next();
						String renovacion = scanner.next();
						alumno.setEstadoAlumno(EstadoAlumno.CESADO);
	
						/* motivo no renovacion */
						String motivoNoRenovacion = scanner.next();
						entrevista.setEvaluacionRenovacionBeca(renovacion);
						/* observaciones */
						String observaciones = scanner.next();
						entrevista.setObservaciones(observaciones);
						String nombrePadrino = scanner.next();
						String idPadrino = scanner.next();	
						Beca becaAlumno = null;
	
						if(StringUtils.isNotBlank(idPadrino))
						{
							Long idP = Long.parseLong(idPadrino);
							PerfilPadrino padrino = (padrinos.get(idP));
							if(padrino == null)
							{
								System.out.println("el padrino " + idP + " no existe!");
							}
							else
							{
									List<Beca> becas = padrino.getBecas();
									if (becas != null) 
									{
										for (Beca beca2 : becas) 
										{
												if(beca2.getZona().equals(alumno.getEscuela().getLocalidad().getZona()) && beca2.getCiclo().getNombre().equalsIgnoreCase("2010"))
												{
													becaAlumno = beca2;
													alumno.setBeca(beca2);
													beca2.getBecados().add(alumno);
													beca2.setCantidadAsignada(beca2.getCantidadAsignada()+1);
												
												}
											
										}
										if(alumno.getBeca() == null)
										{
											alumno.setBeca(null);
											System.out.println("********* el alumno " + idAlumno + " no tiene becas donde coincidan las zonas del padrino " + idPadrino);
										}
									} 
									else 
									{
										System.out.println("el padrino " + idPadrino + " no tiene becas");
									}
							}
						
						
						
						}
						// Pablo
						entrevista.setEstadoEntrevista(EstadoEntrevista.FINALIZADA);
						if(alumno.getFechaAltaBeca() != null)
						{
							entrevista.setFechaAltaBeca(alumno.getFechaAltaBeca());
						}
						else
						{
							Calendar cal = Calendar.getInstance();
							int hora, minutos, segundos;
							hora = cal.get(Calendar.HOUR_OF_DAY);
							minutos = cal.get(Calendar.MINUTE);
							segundos = cal.get(Calendar.SECOND);
							String horario = String.valueOf(hora) + ":" + String.valueOf(minutos) + ":" + String.valueOf(segundos); 
							String unaFecha = "01/01/2010 " + horario;
							Date fechaAltaBeca = Formateador.parsearFechaConHora(unaFecha);
							alumno.setFechaAltaBeca(fechaAltaBeca);
						}
						entrevista.setPerfilAlumno(alumno);
			
						//Periodo unPeriodo = alumno.getBeca().getCiclo().getPeriodos().get(alumno.getBeca().getCiclo().getPeriodos().size() - 1);
						//entrevista.setPeriodoDePago(unPeriodo);
						session.update(alumno);
						entrevista.setPagaEntrevista(true);
						agregarExportacionEspecial(entrevista, alumno, edadAlumno, becaAlumno, session);
						session.save(entrevista);
					} catch (ParseException e) {
						e.printStackTrace();
					}
				} catch (Exception e) {
					System.out.println("Ocurrio un error en el registro " + (count + 1) + " del archivos entrev_cesados_2010.csv");
				}
			}
		};
	
	}
	
	/**
	 * Agrega los datos de exportacion de la entrevista
	 * @param entrevista
	 */
	private static void agregarExportacionEspecial(EntrevistaIndividual entrevista, PerfilAlumno alumno, 
			Integer edadAlumno, Beca beca, Session session) {
		/*id_beca,id_informe,zona_cimientos,edad,Escuela, Previas ,
		 * Previas cuáles ,padrino ,tipo padrino, anio escolar*/
		
		ExportacionEspecial exportacion = new ExportacionEspecial();
//		exportacion.setAnioEscolar(anioEscolar.getValor());
//		exportacion.setEscuela(escuelaAlumno.getNombre());
//		exportacion.setZonaCimientos(escuelaAlumno.getLocalidad().getZona().getNombre());
		
		Integer edad = edadAlumno;
		if(edadAlumno == null && entrevista.getFechaEntrevista() != null){
			Calendar calendarHoy = GregorianCalendar.getInstance();
			calendarHoy.setTime(entrevista.getFechaEntrevista());
			Calendar calendarNac = GregorianCalendar.getInstance();
			calendarNac.setTime(alumno.getDatosPersonales().getFechaNacimiento());
			edad = calendarHoy.get(Calendar.YEAR) - calendarNac.get(Calendar.YEAR);
		}
		exportacion.setEdad(edad);
		
		String padrino = (beca.getPadrino().getEmpresa() != null ? 
				beca.getPadrino().getEmpresa().getDenominacion() :
					beca.getPadrino().getDatosPersonales().getApellido() + ", " 
				+ beca.getPadrino().getDatosPersonales().getNombre()	);
		exportacion.setIdBeca(beca.getId());
		exportacion.setPadrino(padrino);
		exportacion.setIdPadrino(beca.getPadrino().getId());
		exportacion.setTipoPadrino(beca.getPadrino().getTipo().getValor());
		
		Boletin boletin = alumno.getBoletin();
		boolean previas = false;
		if(boletin != null){
			if (boletin.getMateriasPrevias()!= null && !boletin.getMateriasPrevias().isEmpty()){
				previas = true;
				StringBuffer materiasPrevias = new StringBuffer();
				for (Materia previa : boletin.getMateriasPrevias()) {
					materiasPrevias.append( previa.getNombre() + ", ");
				}
				materiasPrevias.deleteCharAt(materiasPrevias.lastIndexOf(","));
				exportacion.setNombresPrevias(materiasPrevias.toString());
			}
		}
		exportacion.setPrevias(previas);
		//session.save(exportacion);
		entrevista.setExportacionEspecial(exportacion);
	}
	/**
	 * 
	 */
	private static void crearCiclosAnteriores() {
		Calendar cal = Calendar.getInstance();
		Session session = sessionFactory.openSession();

		Transaction tx = session.beginTransaction();
		//System.out.println("Creando Ciclos anteriores");
		//crea ciclos del 1990 al 2010
		int anioInicio = 1990;
		for (int year = anioInicio; year < 2011; year++) {
			List<Periodo> periodos = new ArrayList<Periodo>();
			
			String[] meses = new String[] {"Enero","Febrero", "Marzo", "Abril", "Mayo", "Junio",
					"Julio", "Agosto", "Septiembre", "Octubre", "Noviembre",
					"Diciembre" };
			int orden = 0;
			int m = 0;
			for (String mes : meses) 
			{
				Periodo periodo = new Periodo();
				periodo.setActivo(true);
				periodo.setNombre(mes);
				periodo.setOrden(++orden);
				Calendar calendar = Calendar.getInstance();
				calendar.set(year, m, calendar
						.getActualMaximum(GregorianCalendar.DAY_OF_MONTH));
				
				periodo.setFechaFin(Formateador
						.setearHoraFinDia(calendar.getTime()));
				calendar.set(year, m, calendar
						.getMinimum(GregorianCalendar.DAY_OF_MONTH));
				
				periodo.setFechaInicio(calendar.getTime());
				periodos.add(periodo);
				session.save(periodo);
				periodos_nombre.put(mes, periodo);
				m++;
			}
				
			cal.set(year, 0, 1);
			CicloPrograma ciclo = new CicloPrograma();
			ciclo.setActivo(true);
			ciclo.setEstado(EstadoCiclo.CERRADO);
			ciclo.setPeriodos(periodos);
			ciclo.setFechaInicio(cal.getTime());
			cal.set(year, 11, 31);
			ciclo.setFechaFin(cal.getTime());
			ciclo.setMontoBeca(200d);
			ciclo.setNombre(year + "");
			ciclo.setOrden(year - anioInicio);
			ciclos.put(year + "", ciclo);
			session.save(ciclo);
			for(Periodo periodo: periodos)
			{
				periodo.setCiclo(ciclo);
				session.update(periodo);
			}
		}
		
		CicloPrograma c = ciclos.get("2010");
		//c.setEstado(EstadoCiclo.ACTUAL);
		//session.update(c);
		
		//crea el ciclo actual
		//System.out.println("Cargando Ciclo 2011");
		int year = 2011;
		CicloPrograma ciclo = new CicloPrograma();
		ciclo.setActivo(true);
		ciclo.setEstado(EstadoCiclo.ACTUAL);
		cal.set(year, 0, 1);
		ciclo.setFechaInicio(cal.getTime());
		cal.set(year, 11, 31);
		ciclo.setFechaFin(Formateador.setearHoraFinDia(cal.getTime()));
		ciclo.setMontoBeca(0d);
		ciclo.setNombre(year + "");
		ciclo.setOrden(c.getOrden() + 1);
		
		Calendar calendar1 = Calendar.getInstance();
		int hora, minutos, segundos;
		hora = calendar1.get(Calendar.HOUR_OF_DAY);
		minutos = calendar1.get(Calendar.MINUTE);
		segundos = calendar1.get(Calendar.SECOND);
		String horario = String.valueOf(hora) + ":" + String.valueOf(minutos) + ":" + String.valueOf(segundos); 
		String unaFecha = "16/06/2011 " + horario;
		Date fechaPrimerTrimestre = Formateador.parsearFechaConHora(unaFecha);
		
		ciclo.setFecha1T(fechaPrimerTrimestre);
		
		Calendar calendar2 = Calendar.getInstance();
		hora = calendar2.get(Calendar.HOUR_OF_DAY);
		minutos = calendar2.get(Calendar.MINUTE);
		segundos = calendar2.get(Calendar.SECOND);
		horario = String.valueOf(hora) + ":" + String.valueOf(minutos) + ":" + String.valueOf(segundos); 
		unaFecha = "17/08/2011 " + horario;
		Date fechaSegundoTrimestre = Formateador.parsearFechaConHora(unaFecha);
		
		ciclo.setFecha2T(fechaSegundoTrimestre);
		
		Calendar calendar3 = Calendar.getInstance();
		hora = calendar3.get(Calendar.HOUR_OF_DAY);
		minutos = calendar3.get(Calendar.MINUTE);
		segundos = calendar3.get(Calendar.SECOND);
		horario = String.valueOf(hora) + ":" + String.valueOf(minutos) + ":" + String.valueOf(segundos); 
		unaFecha = "16/12/2011 " + horario;
		Date fechaTercerTrimestre = Formateador.parsearFechaConHora(unaFecha);
		
		ciclo.setFecha3T(fechaTercerTrimestre);
		
		session.save(ciclo);
		
		ciclos.put(year + "", ciclo);
		List<Periodo> periodos2011 = new ArrayList<Periodo>();
		String[] meses = new String[] {"Marzo", "Abril", "Mayo", "Junio",
				"Julio", "Agosto", "Septiembre", "Octubre", "Noviembre",
				"Diciembre"};
		int orden = 0;
		int m = 0;
		for (String mes : meses) 
		{
			Periodo periodo = crearPeriodo(ciclo,orden,mes);
			orden++;
			periodos2011.add(periodo);
			session.save(periodo);
			m++;
		}
		ciclo.setPeriodos(periodos2011);
		ciclo.setMontoBeca(new Double(190));
		session.update(ciclo);
		tx.commit();
		
		session.close();

	}


	private static Periodo crearPeriodo(CicloPrograma ciclo, int orden,	String mes) {
		Periodo periodo = new Periodo();
		periodo.setActivo(true);
		periodo.setCiclo(ciclo);
		periodo.setNombre(mes);
		periodo.setOrden(orden + 1);
		String unaFechaInicio;
		Date fechaInicio = null;
		String unaFechaFin;
		Date fechaFin = null;
		if(mes.equals("Marzo")){
			unaFechaInicio = "14/02/2011 00:00:01";
			fechaInicio = Formateador.parsearFechaConHora(unaFechaInicio);
			unaFechaFin = "15/03/2011 23:59:59";
			fechaFin = Formateador.parsearFechaConHora(unaFechaFin);
		}
		else{
			if(mes.equals("Abril")){
				unaFechaInicio = "16/03/2011 00:00:01";
				fechaInicio = Formateador.parsearFechaConHora(unaFechaInicio);
				unaFechaFin = "15/04/2011 23:59:59";
				fechaFin = Formateador.parsearFechaConHora(unaFechaFin);
			}
			else{
				if(mes.equals("Mayo")){
					unaFechaInicio = "16/04/2011 00:00:01";
					fechaInicio = Formateador.parsearFechaConHora(unaFechaInicio);
					unaFechaFin = "16/05/2011 23:59:59";
					fechaFin = Formateador.parsearFechaConHora(unaFechaFin);
				}
				else{
					if(mes.equals("Junio")){
						unaFechaInicio = "17/05/2011 00:00:01";
						fechaInicio = Formateador.parsearFechaConHora(unaFechaInicio);
						unaFechaFin = "15/06/2011 23:59:59";
						fechaFin = Formateador.parsearFechaConHora(unaFechaFin);
					}
					else{
						if(mes.equals("Julio")){
							unaFechaInicio = "16/06/2011 00:00:01";
							fechaInicio = Formateador.parsearFechaConHora(unaFechaInicio);
							unaFechaFin = "15/07/2011 23:59:59";
							fechaFin = Formateador.parsearFechaConHora(unaFechaFin);
						}
						else{
							if(mes.equals("Agosto")){
								unaFechaInicio = "16/07/2011 00:00:01";
								fechaInicio = Formateador.parsearFechaConHora(unaFechaInicio);
								unaFechaFin = "16/08/2011 23:59:59";
								fechaFin = Formateador.parsearFechaConHora(unaFechaFin);
							}
							else{
								if(mes.equals("Septiembre")){
									unaFechaInicio = "17/08/2011 00:00:01";
									fechaInicio = Formateador.parsearFechaConHora(unaFechaInicio);
									unaFechaFin = "15/09/2011 23:59:59";
									fechaFin = Formateador.parsearFechaConHora(unaFechaFin);
								}
								else{
									if(mes.equals("Octubre")){
										unaFechaInicio = "16/09/2011 00:00:01";
										fechaInicio = Formateador.parsearFechaConHora(unaFechaInicio);
										unaFechaFin = "17/10/2011 23:59:59";
										fechaFin = Formateador.parsearFechaConHora(unaFechaFin);
									}
									else{
										if(mes.equals("Noviembre")){
											unaFechaInicio = "18/10/2011 00:00:01";
											fechaInicio = Formateador.parsearFechaConHora(unaFechaInicio);
											unaFechaFin = "15/11/2011 23:59:59";
											fechaFin = Formateador.parsearFechaConHora(unaFechaFin);
										}
										else{
											if(mes.equals("Diciembre")){
												unaFechaInicio = "16/11/2011 00:00:01";
												fechaInicio = Formateador.parsearFechaConHora(unaFechaInicio);
												unaFechaFin = "12/12/2011 23:59:59";
												fechaFin = Formateador.parsearFechaConHora(unaFechaFin);
											}
										}
									}
								}
							}
						}
					}					
				}
			}
		}
		
		periodo.setFechaInicio(fechaInicio);
		periodo.setFechaFin(fechaFin);
		return periodo;
	}


	/**
	 * @throws java.text.ParseException
	 * 
	 */
	private static void migrarConvocatorias() throws Exception {
		// Convocatorias
		// idconvocatoria denominacion finicio ffin idzonacimientos
		Parser convocatoriaParser = new Parser(new File(FILE_HOME,
				"covocatorias.csv"), sessionFactory.openSession()) {

			@Override
			public void handleLine(String line, Session session, int count) {
				try{
					Scanner scanner = new Scanner(line);
					scanner.useDelimiter(";");
					String idTroop = scanner.next();
					String nombre = scanner.next();
					String inicio = scanner.next();
					String fin = scanner.next();
					String zona = scanner.next();
	
					Convocatoria convocatoria = new Convocatoria();
					ConvocatoriaSeleccion convocatoriaSeleccion = new ConvocatoriaSeleccion();
					
					convocatoriaSeleccion.setActivo(true);
					convocatoria.setActivo(true);
					
					convocatoria.setCicloPrograma(ciclos.get(inicio.split("/")[2]));
					
					
					SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy");
					try {
						convocatoria.setFechaInicio(sdf.parse(inicio));
						convocatoria.setFechaFin(sdf.parse(fin));
						convocatoriaSeleccion.setFechaInicio(sdf.parse(inicio));
						convocatoriaSeleccion.setFechaFin(sdf.parse(fin));
					} catch (java.text.ParseException e) {
						e.printStackTrace();
					}
					convocatoria
							.setTipoConvocatoria(TipoConvocatoria.INCORPORACION);
					convocatoria.setZonaCimientos(zonas.get(zona));
					
					convocatoria.setNombre(nombre);
					convocatoriaSeleccion.setNombre(nombre);
					
					session.save(convocatoria);
					session.save(convocatoriaSeleccion);
					convocatorias.put(idTroop, convocatoriaSeleccion);
					count++;
				} catch (Exception e) {
					System.out.println("Ocurrio un error en el registro " + (count + 1) + " del archivos covocatorias.csv");
				}
			}
		};

	}

	private static void migrarGografias() throws IOException {

		// provincias
		Parser provinciasParser = new Parser(new File(FILE_HOME,
		"provincias.csv"), sessionFactory.openSession()) {

		@Override
		public void handleLine(String line, Session session, int count) {
			try{
				Scanner scanner = new Scanner(line);
				scanner.useDelimiter(";");
				String idTroop = scanner.next();
				String nombre = scanner.next();
				String idPais = scanner.next();
				Provincia provincia = new Provincia();
				provincia.setActivo(true);
				provincia.setDescripcion(nombre);
				provincia.setIdPais(Long.parseLong(idPais));
				String pais = paises.get(idPais);
				if(pais != null)
					provincia.setPais(pais);
				session.save(provincia);
				provincias.put(idTroop, provincia);
				count++;
			} catch (Exception e) {
				System.out.println("Ocurrio un error en el registro " + (count + 1) + " del archivos provincias.csv");
			}
		}
		};


		// Zonas
		// Provincia;Localidades;Zona Cimientos FENIX;LIP;IdTroop;
		Parser zonaParser = new Parser(new File(FILE_HOME,
				"zonas_localidades.csv"), sessionFactory.openSession()) {

			@Override
			public void handleLine(String line, Session session, int count) {
				try{
					Scanner scanner = new Scanner(line);
					scanner.useDelimiter(";");
					String provincia = scanner.next();
					String nombreLocalidad = scanner.next();
					String nombre = scanner.next();
					String tipoZona = scanner.next();
					String idTRoop = scanner.next();
	
					Categoria categoria = null;
					if (tipoZona.equals("I")) {
						categoria = Categoria.INTERIOR;
					} else if (tipoZona.equals("L")) {
						categoria = Categoria.LOCAL;
					} else if (tipoZona.equals("P")) {
						categoria = Categoria.SUR;
					}
	
					ZonaCimientos zonaCimientos = new ZonaCimientos();
					zonaCimientos.setActivo(true);
					zonaCimientos.setCategoria(categoria);
					zonaCimientos.setNombre(nombre.trim());
	
					session.save(zonaCimientos);
	
					Localidad localidad = new Localidad();
					localidad.setActivo(true);
					localidad.setNombre(nombreLocalidad);
					localidad.setZona(zonaCimientos);
					localidades.put(localidad.getNombre(), localidad);
	
					Provincia provinciaObj = provincias.get(provincia);
					localidad.setProvincia(provinciaObj);
	
					session.save(localidad);
					provinciaObj.agregarLocalidad(localidad);
					session.update(provinciaObj);
	
					zonaCimientos.agregarLocalidad(localidad);
					session.update(zonaCimientos);
	
					zonas.put(idTRoop, zonaCimientos);
					zonas_nombre.put(zonaCimientos.getNombre(), zonaCimientos);
					count++;
				} catch (Exception e) {
					System.out.println("Ocurrio un error en el registro " + (count + 1) + " del archivos zonas_localidades.csv");
				}
			}
			
			
		};
	
	}

	private static  void crearZonaUnica() throws Exception {
		Session session = sessionFactory.openSession();
		Transaction tx = session.beginTransaction();
		ZonaCimientos zonaUnica = new ZonaCimientos();
		//List<Localidad> list = new ArrayList<Localidad>(localidades.values());
		zonaUnica.setLocalidades(new ArrayList<Localidad>());
		zonaUnica.setActivo(true);
		zonaUnica.setNombre("SIN ZONA");
		zonaUnica.setCategoria(Categoria.INTERIOR);
		zonaUnica.setEscuelas(new ArrayList<Escuela>());
		session.save(zonaUnica);
		zonas.put("33333", zonaUnica);
		zonas_nombre.put(zonaUnica.getNombre(), zonaUnica);
		tx.commit();
		System.out.println("Zona Única cargada");
		session.close();

	}
	
	private static void migrarEscuelas() throws Exception {

		// Escuelas
		// idescuela troop;denominacion Troop;Denominación para
		// Fénix;tdg_idtipodegestion;direccion;escuela_rural;
		// cp;localidad;barrio;zc_idzonascimientos;pro_idprovincia;email;directora;directora_telefono;
		// directora_direccion;directora_email;vicedirectora;vicedirectora_telefono;vicedirectora_email;contacto;
		// contacto_telefono;contacto_email;escuela_articula;tdt_idtipodeturno;tdn_idtipodenivel;taller;deporte;
		// comedor;gabinete;falta;fbaja;observaciones;nse_idnivelsoceco;subsidio;posibilidad_de_compromiso;
		// compromiso_educacion;distrito_escolar;pago_nombre;pago_dni;pago_cuit;pago_banco;pago_sucursal;
		// pago_cuenta;pago_cbu;cimientos_idescuela;cimientos_idEA;escuela_anio_adicional
		new Parser(new File(FILE_HOME, "escuelas.csv"), sessionFactory
				.openSession()) {

			@Override
			public void handleLine(String line, Session session, int count) {
				try {
					
					Scanner scanner = new Scanner(line);
					scanner.useDelimiter(";");
					String idTroop = scanner.next();
	
					/* Nombre viejo */scanner.next();
					Escuela escuela = new Escuela();
					escuela.setActivo(true);
					String nombreActual = scanner.next();
					escuela.setNombre(nombreActual);
					String dependencia = scanner.next();
					if(dependencia.equalsIgnoreCase("0"))
						escuela.setDependencia(null);
					else{
						Integer depInteger = Integer.parseInt(dependencia);
						escuela.setDependencia(Dependencia.getDependencia(depInteger));
					}
					String direccionCalle = scanner.next();
					escuela.setDireccionCalle(direccionCalle);
					String rural = scanner.next();
					escuela.setRural(rural.equals("1") ? true : false);
					String cp = scanner.next();
					escuela.setCodigoPostal(cp);
					String nombreLocalidad = scanner.next();
					String barrio = scanner.next();
					escuela.setBarrio(barrio);
					
					String idZona = scanner.next();
					ZonaCimientos zona = zonas.get(idZona);
					/*if (zona == null) {
						System.out.println("Zona inexistente " + idZona);
						zona = new ZonaCimientos();
						zona.setActivo(true);
						zona.setCategoria(Categoria.LOCAL);
						zona.setNombre("Zona " + idZona);
						zona.setLocalidades(new ArrayList<Localidad>());
						session.save(zona);
						zonas.put(idZona, zona);
					}
					*/
					String idProvincia = scanner.next();
					//Localidad localidadReal = null;
					if(zona != null){					
						for (Localidad localidad : zona.getLocalidades()) {
							escuela.setLocalidad(localidad);
						}
						
						escuela.setZonaCimientos(zona);
						zona.agregarEscuela(escuela);
						session.update(zona);					
						escuela.setProvincia(zona.getLocalidades().get(0).getProvincia());
					}
					/*if (localidadReal == null) {
						localidadReal = new Localidad();
						localidadReal.setActivo(true);
						localidadReal.setNombre(nombreLocalidad);
						localidadReal.setProvincia(provincias.get(idProvincia));
						localidadReal.setZona(zona);
						session.save(localidadReal);
						zona.agregarLocalidad(localidadReal);
						localidades.put(localidadReal.getNombre(), localidadReal);
					}
					*/
					escuela.setMail(scanner.next());
					escuela.setDirectorCelular(scanner.next());
					/* direccion director */scanner.next();
					escuela.setDirectorMail(scanner.next());
					/* vice */scanner.next();
					/* vicedirectora_telefono */scanner.next();
					/* vicedirectora_email */scanner.next();
					/* contacto */scanner.next();
					escuela.setTelefono1(scanner.next());
					/* contacto mail */scanner.next();
					/* articula */scanner.next();
					/* idtipodeturno */scanner.next();
					String tipoNivel = scanner.next();
					if(!tipoNivel.isEmpty())
						escuela.setNivelAtiendeEscuela(NivelEscuela.getNivelEscuela(new Integer(tipoNivel)));
					/* boolean taller = */scanner.next();
					/* boolean deporte = */scanner.next();
					/* boolean comedor = */scanner.next();
					/* boolean gabinete = */scanner.next();
					/* fecha alta */scanner.next();
					/* fecha baja */scanner.next();
					/* observaciones */scanner.next();
					escuelas.put(idTroop, escuela);
					
					session.save(escuela);
					
					EscuelaSeleccion eSeleccion =  new EscuelaSeleccion(escuela);
					
					escuelasSeleccion.put(eSeleccion.getId(), eSeleccion);
					
					session.save(eSeleccion);
				
				} catch (Exception e) {
					System.out.println("No se migro el registro nro " + (count + 1) + " del archivo escuelas.csv");
				}
			}

		};
		/*
		ESCUELA_FALSA.setActivo(true);
		ESCUELA_FALSA.setEstadoEscuela(EstadoEscuela.ACEPTADA);
		ESCUELA_FALSA.setNombre("-- SIN DATOS --");
		ESCUELA_FALSA.setZonaCimientos(zonas.get("6"));
		ESCUELA_FALSA.setLocalidad(localidades.get("Almagro"));
		
		Session session = sessionFactory.openSession();
		session.save(ESCUELA_FALSA);
		session.close();
		*/
	}

	private static void migrarPadrinosIndividuales() throws IOException {
		Parser individualesParser = new Parser(new File(FILE_HOME,
				"padrinos_individuales.csv"), sessionFactory.openSession()) {

			/*
			 * idT;apellido;nombre;tipo_beca;zona;id_zona;Becas 2010;Becas 2011;Estado de la Beca
			 * FENIX;email;IdPlataforma;CUIL
			 */
			@Override
			public void handleLine(String line, Session session, int count) {
				try {
					
					Scanner scanner = new Scanner(line);
					scanner.useDelimiter(";");
					long idTroop = scanner.nextLong();
					String apellido = scanner.next();
					String nombre = scanner.next();
					String tipoBeca = scanner.next();
					
					Persona persona = usuarios_nombre_apellido.get(apellido + " " + nombre);
					PerfilPadrino padrino = null;
					if(persona == null ){
						persona = new Persona();
						persona.setActivo(true);
						persona.setApellido(apellido);
						persona.setNombre(nombre);	
						padrino = 	new PerfilPadrino();
					}
					else
					{
						padrino = padrinos.get(idTroop);
					}
					padrino.setActivo(true);
					
					Beca beca2010 = new Beca();
					Beca beca2011 = new Beca();
					
					beca2010.setBecados(new ArrayList<PerfilAlumno>());
					beca2011.setBecados(new ArrayList<PerfilAlumno>());
					
					List<TipoBeca> tipos = TipoBeca.getListaTipoBecas();
					for (TipoBeca tipoBeca2 : tipos) {
						if(tipoBeca2.getValor().equalsIgnoreCase(tipoBeca))
						{
							beca2010.setTipo(tipoBeca2);
							beca2011.setTipo(tipoBeca2);	
						}
					}
					beca2010.setActivo(true);
					beca2011.setActivo(true);
					
					String zona = scanner.next();
					String idZona = scanner.next();
					beca2010.setZona(zonas.get(idZona));
					beca2011.setZona(zonas.get(idZona));
					
					CicloPrograma ciclo2010 = ciclos.get("2010");
					CicloPrograma ciclo2011 = ciclos.get("2011");

					beca2010.setFechaAlta(ciclo2010.getFechaInicio());
					beca2010.setCiclo(ciclo2010);
					beca2010.setPeriodoPago(ciclo2010.getPeriodos().get(0));
					beca2011.setFechaAlta(ciclo2011.getFechaInicio());
					beca2011.setCiclo(ciclo2011);
					beca2011.setPeriodoPago(ciclo2011.getPeriodos().get(0));
					
					String cant2010 = scanner.next();
					beca2010.setCantidad(Integer.parseInt(cant2010.split(
							"\\.")[0]));
					
					String cant2011 = scanner.next();
					beca2011.setCantidad(Integer.parseInt(cant2011.split(
					"\\.")[0]));
					
					String estadoBeca = scanner.next();
					if (estadoBeca.equalsIgnoreCase("Estimada")) {
						beca2010.setEstado(EstadoBeca.PLANIFICADA);
						beca2011.setEstado(EstadoBeca.PLANIFICADA);
					} else{ 
						if(estadoBeca.equalsIgnoreCase("Confirmada")){
							beca2010.setEstado(EstadoBeca.CONFIRMADA);	
							beca2011.setEstado(EstadoBeca.CONFIRMADA);
						}
						else{
							beca2010.setEstado(EstadoBeca.INACTIVA);	
							beca2011.setEstado(EstadoBeca.INACTIVA);
						}
					}
					
					String email = scanner.next();
					if(StringUtils.isNotBlank(email))
					{
						//persona.setMail(email.replace("-", ";"));
						persona.setMail("pablo.tamone@softtek.com");
					}
					String idPlataforma = scanner.next();
					if(StringUtils.isNotBlank(idPlataforma))
					{
						Long id = Long.parseLong(idPlataforma);
						padrino.setIdPlataforma(id);
					}
					if(scanner.hasNext())
					{
						String cuil = scanner.next();
						if(StringUtils.isNotBlank(cuil))
						{
							String cuilFormateado = Formateador.formatearCuilSinGuiones(cuil);
							persona.setCuilCuit(cuilFormateado);
							persona.setDni(Integer.parseInt(cuil.split("-")[1]));
						}
					}
					session.save(persona);
	
					padrino.setDatosPersonales(persona);
					padrino.setFechaAlta(new Date());
					padrino.setTipo(TipoPadrino.INDIVIDUAL);
					padrino.setRecibeInformesMasivos(true);
	
					session.save(padrino);					
					
					
					beca2010.setPadrino(padrino);
					padrino.agregarBeca(beca2010);
					beca2010.setCantidadAsignada(0);
					session.save(beca2010);				
				
				
					beca2011.setPadrino(padrino);
					padrino.agregarBeca(beca2011);
					beca2011.setCantidadAsignada(0);
					session.save(beca2011);
					
		
					padrinos.put(idTroop, padrino);
					padrinos_nombre.put(persona.getNombre() + " "
							+ persona.getApellido(), padrino);
					usuarios_nombre_apellido.put(persona.getApellido() + " " + persona.getNombre(), persona);

				} catch (Exception e) {
					System.out.println("No se migro el registro nro " + (count + 1) + " del archivo padrinos_individuales.csv");
				}
			}
		};

	}

	private static void migrarPadrinosCorporativos() throws IOException {
		Parser corporativoParser = new Parser(new File(FILE_HOME,
				"padrinos_corporativos.csv"), sessionFactory.openSession()) {
			@Override
			public void handleLine(String line, Session session, int count) {
				try {
								
					Scanner scanner = new Scanner(line);
					scanner.useDelimiter(";");
					/*
					 * idTroop;Padrino;CUIT;IdPlataforma;
					 */
					long idTroop = scanner.nextLong();
					String nombre = scanner.next();
					Empresa empresa = new Empresa();
					String cuit = scanner.next();
					String cuitFormateado = Formateador.formatearCuilSinGuiones(cuit);
					empresa.setCUIT(cuitFormateado);
					empresa.setActivo(true);
					empresa.setDenominacion(nombre.trim());					
					
					session.save(empresa);
	
					PerfilPadrino padrino = new PerfilPadrino();
					padrino.setEmpresa(empresa);
					padrino.setRecibeInformesMasivos(true);
					padrino.setFechaAlta(new Date());
					padrino.setTipo(TipoPadrino.CORPORATIVO);
					padrino.setIdPlataforma(scanner.nextLong());
					padrino.setActivo(true);
					session.save(padrino);
	
					padrinos.put(idTroop, padrino);
					padrinos_nombre.put(empresa.getDenominacion(), padrino);
				} catch (Exception e) {
					System.out.println("No se migro el registro nro " + (count + 1) + " del archivo padrinos_corporativos.csv");
				}
			}
		};
		

		Parser becasCorporativasParser = new Parser(new File(FILE_HOME,
				"becas_corporativas.csv"), sessionFactory.openSession()) {

			@Override
			public void handleLine(String line, Session session, int count) {
				try{
					Scanner scanner = new Scanner(line);
					scanner.useDelimiter(";");
					/*
					 * Id;Padrino;Zona;2010,00;2011,00;Estado de la Beca FENIX
					 */
					long idPadrino = scanner.nextLong(); 
					PerfilPadrino padrino = padrinos.get(idPadrino);
					/* nombr padrino */
					String nombrePadrino = scanner.next();
					if(padrino == null){
						padrino = padrinos_nombre.get(nombrePadrino.trim());
					}
					Beca beca2011 = new Beca();
					Beca beca2010 = new Beca();
					
					beca2010.setActivo(true);
					beca2011.setActivo(true);
					
					beca2010.setPadrino(padrino);
					beca2011.setPadrino(padrino);
					
					beca2010.setBecados(new ArrayList<PerfilAlumno>());
					beca2011.setBecados(new ArrayList<PerfilAlumno>());
					
					List<TipoBeca> tipos = TipoBeca.getListaTipoBecas();
					String tipoBeca = scanner.next();
					for (TipoBeca tipoBeca2 : tipos) {
						if(tipoBeca2.getValor().equalsIgnoreCase(tipoBeca))
						{
							beca2010.setTipo(tipoBeca2);
							beca2011.setTipo(tipoBeca2);
						}
					}
					
					String idZona = scanner.next();
					beca2010.setZona(zonas.get(idZona));
					beca2011.setZona(zonas.get(idZona));
					
					CicloPrograma ciclo2011 = ciclos.get("2011");
					CicloPrograma ciclo2010 = ciclos.get("2010");
					
					beca2010.setCiclo(ciclo2010);
					beca2010.setPeriodoPago(ciclo2010.getPeriodos().get(0));
	
					beca2011.setCiclo(ciclo2011);
					beca2011.setPeriodoPago(ciclo2011.getPeriodos().get(0));
					
					beca2011.setPeriodoPago(ciclo2011.getPeriodos().get(0));
					String cantidad2010 = scanner.next();
					String cantidad2011 = scanner.next();
					beca2010.setCantidad(Integer.parseInt(cantidad2010.split(
							"\\.")[0]));
					beca2011.setCantidad(Integer.parseInt(cantidad2011.split(
					"\\.")[0]));
					
					String estado = scanner.next();
					if (estado.equalsIgnoreCase("Estimada")) {
						beca2010.setEstado(EstadoBeca.PLANIFICADA);
						beca2011.setEstado(EstadoBeca.PLANIFICADA);
					} else{ 
						if(estado.equalsIgnoreCase("Confirmada")){
							beca2010.setEstado(EstadoBeca.CONFIRMADA);	
							beca2011.setEstado(EstadoBeca.CONFIRMADA);
						}
						else{
							beca2010.setEstado(EstadoBeca.INACTIVA);	
							beca2011.setEstado(EstadoBeca.INACTIVA);
						}
					}
	
					// Pablo
					beca2010.setFechaAlta(ciclo2010.getFechaInicio());
					beca2011.setFechaAlta(ciclo2011.getFechaInicio());
					// Fin Pablo
					
					beca2010.setCantidadAsignada(0);
					beca2011.setCantidadAsignada(0);
					
					session.save(beca2011);
					session.save(beca2010);
										
					if(padrino!=null){
						padrino.agregarBeca(beca2011);	
						padrino.agregarBeca(beca2010);
					}else{
						System.out.println("Beca de padrino de id no registrado:"+idPadrino);
					}				
				} catch (Exception e) {
					System.out.println("No se migro el registro nro " + (count + 1) + " del archivo becas_corporativas.csv");
				}
			}
		};
		
		Parser contactosCorporativosParser = new Parser(new File(FILE_HOME,
			"contactos_padrinos_corporativos.csv"), sessionFactory.openSession()) {

	@Override
	public void handleLine(String line, Session session, int count) {
		try{
			Scanner scanner = new Scanner(line);
			scanner.useDelimiter(";");
			/*
			 * Id;Padrino;Znombre;apellido;tipo;mail
			 */
			long idPadrino = scanner.nextLong(); 
			PerfilPadrino padrino = padrinos.get(idPadrino);
			Empresa empresa = null;
			String denominacion = scanner.next();
			if(padrino != null)
			{
				empresa = padrino.getEmpresa();
				String contacto = null;
				String mail = null;
				if(StringUtils.isNotEmpty(padrino.getEmpresa().getContacto1()))
				{
					contacto = padrino.getEmpresa().getContacto1() + ";" + scanner.next() + "," + scanner.next();
					empresa.setContacto1(contacto);
				}
				else
				{
					contacto = scanner.next() + "," + scanner.next();
					empresa.setContacto1(contacto);
				}
				scanner.next();
				if(StringUtils.isNotEmpty(padrino.getEmpresa().getMailContacto1()))
				{
					mail = padrino.getEmpresa().getMailContacto1() + ";" + scanner.next();
					//empresa.setMailContacto1(mail);
					empresa.setMailContacto1("pablo.tamone@softtek.com");
				}
				else
				{
					mail = scanner.next();
					//empresa.setMailContacto1(mail);
					empresa.setMailContacto1("pablo.tamone@softtek.com");
				}
				session.update(empresa);
			}
		} catch (Exception e) {
			System.out.println("No se migro el registro nro " + (count + 1) + " del archivo contactos_padrinos_corporativos.csv");
		}
		
		}
	};

}


	public static String calclarCuil(String dni, int sexo) {
		String prefijo;
		if (sexo == 1) {
			prefijo = "20";
		} else if (sexo == 2) {
			prefijo = "27";
		} else {
			prefijo = "30";
		}
		int suma = 0;
		suma += (Integer.parseInt(prefijo.charAt(0) + "") * 5);
		suma += (Integer.parseInt(prefijo.charAt(1) + "") * 4);
		suma += (Integer.parseInt(dni.charAt(0) + "") * 3);
		suma += (Integer.parseInt(dni.charAt(1) + "") * 2);
		suma += (Integer.parseInt(dni.charAt(2) + "") * 7);
		suma += (Integer.parseInt(dni.charAt(3) + "") * 6);
		suma += (Integer.parseInt(dni.charAt(4) + "") * 5);
		suma += (Integer.parseInt(dni.charAt(5) + "") * 4);
		suma += (Integer.parseInt(dni.charAt(6) + "") * 3);
		suma += (Integer.parseInt(dni.charAt(7) + "") * 2);
		int resultado = suma % 11;
		String sufijo;
		if (resultado == 0) {
			sufijo = "0";
		} else if (resultado == 1) {
			if (sexo == 1) {
				sufijo = "9";
				prefijo = "23";
			} else {
				sufijo = "4";
				prefijo = "23";
			}
		} else {
			sufijo = "" + (11 - resultado);
		}

		return prefijo + dni + sufijo;
	}

	private static void migrarBanco() throws IOException {

		final Banco macro = new Banco();
		macro.setNombre("Macro");
		macro.setActivo(true);
		final Banco galicia = new Banco();
		galicia.setNombre("Galicia");
		galicia.setActivo(true);
		final Banco industrial = new Banco();
		industrial.setNombre("Industrial");
		industrial.setActivo(true);
		Session session = sessionFactory.openSession();
		session.save(industrial);
		session.save(galicia);
		session.save(macro);
		bancos.put(industrial.getNombre(), industrial);
		bancos.put(galicia.getNombre(), galicia);
		bancos.put(macro.getNombre(), macro);
		
		Parser bancoParser = new Parser(new File(FILE_HOME,
				"sucursales_banco.csv"), session) {

			@Override
			public void handleLine(String line, Session session, int count) {
				try{
					Scanner scanner = new Scanner(line);
					scanner.useDelimiter(";");
					SucursalBanco sucursal = new SucursalBanco();
					String idZona = scanner.next();
					String zona = scanner.next();
					String banco = scanner.next();
					if (banco.equals("Banco Galicia")) {
						sucursal.setBanco(galicia);
					} else if (banco.equals("Banco Industrial")) {
						sucursal.setBanco(industrial);
					} else {
						sucursal.setBanco(macro);
					}
					sucursal.setNombre(scanner.next());
					sucursal.setNumeroSucursal(scanner.next());
					sucursal.setDireccion(scanner.next());
					sucursal.setTelContacto(scanner.next());
					if (scanner.hasNext()) {
						sucursal.setNombreContacto(scanner.next());
					}
					sucursal.setActivo(true);
					ZonaCimientos zonaCimientos = zonas.get(idZona);				
					sucursal.setZona(zonaCimientos);
					session.save(sucursal);
					sucursales.put(sucursal.getNumeroSucursal(), sucursal);
				} catch (Exception e) {
					System.out.println("No se migro el registro nro " + (count + 1) + " del archivo sucursales_banco.csv");
				}
			}
		};

	}

	private static void migrarAlumnos() throws Exception {

				Parser alumnos2011 = new Parser(
				new File(FILE_HOME, "alumnos_2011.csv"), sessionFactory
						.openSession()) {

			@Override
			public void handleLine(String line, Session session, int count) {

				Scanner scanner = new Scanner(line);
				scanner.useDelimiter(";");

				/*
				 * idconvocatoria_alumno;con_idconvocatoria;alu_idalumno;est_idestado
				 * ;usu_idusuario;falta;Fecha Incorp;fbaja;idalumno;
				 * nombre;apellido
				 * ;email;tdd_idtipodedocumento;tdde_idtipodedesempenoescolar
				 * ;tdec_idtipoevaluacionconvocatoria;nro_documento;
				 * tdte_idtipoturnoescolar
				 * ;inasistenciasescuela;sexo;pai_idpais;pro_idprovincia
				 * ;barrio;localidad;direccion_calle;
				 * direccion_numero;direccion_piso
				 * ;direccion_dpto;codigo_postal;fnacimiento AC
				 * ;conv_material_completo;gra_idgrado;nombre_responsable;
				 * fnac_responsable;modalidad;localidad_cimientos;esc_idescuela;
				 * nacionalidad_responsable2;observaciones;fbaja;falta;
				 * dni_responsable
				 * ;cuil_responsable;sexo_responsable2;nombre_responsable2
				 * ;fnac_responsable2;dni_responsable2;cuil_responsable2;
				 * tdp_idtipodepago
				 * ;nro_cuenta;tdd_idtipodedocumento_res2;ban_idbanco
				 * ;apellido_responsable2
				 * ;apellido_responsable;nc_idnumerocuenta;
				 * cimientos_idalumno;cimientos_idescuela
				 * ;cimientos_idEA;cimientos_idPadrino
				 * ;cimientos_sucursal;nacionalidad_responzable1;
				 * sucursal;tdd_idtipodedocumento_res
				 * ;sexo_responsable;vin_idvinculo_res
				 * ;vin_idvinculo_res2;idzonacimientos;id_provincia; Estudio
				 * SocioAmbiental
				 */
//				if(count > 0){
					PerfilAlumno perfilAlumno = new PerfilAlumno();
					perfilAlumno.setActivo(true);
					ResponsableAdulto ra1 = new ResponsableAdulto();
					ra1.setActivo(true);
					ResponsableAdulto ra2 = new ResponsableAdulto();
					ra2.setActivo(true);
					SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy");
					try {
	
						/* idconvocatoria_alumno */
						String idConvocatoriaAlumno = scanner.next();
						
						/* con_idconvocatoria; */scanner.next();
						
						/* alu_idalumno; */ scanner.next();
						
						/* est_idestado; */
						String idEstadoAlumno = scanner.next();
						
						/* usu_idusuario; */scanner.next();
						
						/* f_alta */String fechaAlta = scanner.next();
						
						if (fechaAlta.equals("NULL")) {
							perfilAlumno.setFechaAlta(sdf.parse(fechaAlta));
	
						}
						
						/* f_incorp */
						String fechaIncorp = scanner.next();
						
						if (fechaIncorp.equals("NULL")) {
							perfilAlumno.setFechaPBE(sdf.parse(fechaIncorp));
						}
						/* fbaja */scanner.next();
						
						long idTroop = scanner.nextLong();
						
						String nombre = scanner.next();
						
						String apellido = scanner.next();
						
						Persona persona = usuarios_nombre_apellido.get(apellido + " " + nombre);
						if(persona == null ){
							persona = new Persona();
							persona.setActivo(true);
							persona.setApellido(apellido);
							persona.setNombre(nombre);					
						}
						//persona.setMail(scanner.next());
						scanner.next();
						persona.setMail("pablo.tamone@softtek.com");
						persona.setTipoDni(TipoDni.getTipoDni(scanner.nextInt()));
						String desEcolar = parsear(scanner.next());
						if(desEcolar != null)
							perfilAlumno.setDesempenioEscolar(DesempenioEscolar.getDesempenioEscolar(Integer.valueOf(desEcolar)));

						/* id tipoevaluacion conv */scanner.next();
						String dni = scanner.next();
						if (dni.length() == 8) {
							persona.setDni(Integer.parseInt(dni));
						} else {
							persona.setDni(++DNI_FALSO);
						}
	
						perfilAlumno.setDatosPersonales(persona);
						perfilAlumno.setActivo(true);
						
						if(idEstadoAlumno.equalsIgnoreCase("4"))
							perfilAlumno.setEstadoAlumno(EstadoAlumno.LISTA_ESPERA);
						else if(idEstadoAlumno.equalsIgnoreCase("1"))
							perfilAlumno.setEstadoAlumno(EstadoAlumno.ALTA_BECADO);
						else if(idEstadoAlumno.equalsIgnoreCase("12"))
							perfilAlumno.setEstadoAlumno(EstadoAlumno.RECHAZADO);
						else if(idEstadoAlumno.equalsIgnoreCase("18")){
							perfilAlumno.setEstadoAlumno(EstadoAlumno.PRESELECCIONADO);
							perfilAlumno.setEntrevistaTSSeleccion(true);
						}
						
						persona.setPerfilAlumno(perfilAlumno);
						String turno = parsear(scanner.next());
						if(turno != null)
							perfilAlumno.setTurno(Turno.getTurnos(Integer.valueOf(turno)));

						/* inasistencia */scanner.next();
						String sexoAlumno = scanner.next();
						if (!sexoAlumno.equals("NULL")) {
							if (sexoAlumno.equals("1")) {
								persona.setSexo(false);
							} else {
								persona.setSexo(true);
							}
						}
						/* pais */scanner.next();
						String provincia = scanner.next();
						persona.setProvincia(provincias.get(provincia));
						/* barrio */persona.setBarrio(scanner.next());
						/* localidad */
						String loc = scanner.next();
						Localidad localidad = getLocalidad( loc, provincia, session );
						persona.setLocalidad(localidad);
						persona.setDireccion(scanner.next());
						String nroCalle = scanner.next();
						if (!nroCalle.equals("NULL")) {
							persona.setNumeroCalle(nroCalle);
						}
						String nroPiso = scanner.next();
						if (!nroPiso.equals("NULL")) {
							persona.setPiso(nroPiso);
						}
						persona.setDepartamento(parsear(scanner.next()));
						persona.setCodigoPostal(scanner.next());
						String fechaNac = scanner.next();
						if(!fechaNac.isEmpty())
							persona.setFechaNacimiento(sdf.parse(fechaNac));
						/* material completo */scanner.next();
						perfilAlumno.setAnioEscolar(AnioEscolar
								.getAnioEscolar(scanner.nextInt()));
						ra1.setNombre(scanner.next());
						ra1.setFechaNacimiento(sdf.parse(scanner.next()));
						/* modalidad */scanner.next();
						/* localidad_cimientos */scanner.next();
						perfilAlumno.setEscuela(escuelas.get(scanner.next()));
						String pais = scanner.next();
						ra2.setNacionalidad(getNacionalidad(pais));
						/* Observaciones */scanner.next();
						/* fecha baja */scanner.next();
						/* fecha alta */scanner.next();
						String dniRa1 = scanner.next();
						if (dniRa1.length() == 8) {
							ra1.setDni(Integer.parseInt(dniRa1));
						} else {
							ra1.setDni(++DNI_FALSO);
						}
						String cuit_cuil = scanner.next();
						ra1.setCuilCuit(parsearCuitCuil(cuit_cuil));
						String sexoRa2 = scanner.next();
						if (!sexoRa2.equals("NULL")) {
							if (sexoRa2.equals("1")) {
								ra2.setSexo(false);
							} else {
								ra2.setSexo(true);
							}
						}
						String nombreRa2 = scanner.next();
						
						ra2.setNombre(nombreRa2.equals("NULL")? "" : nombreRa2);
						String fechaR2 = scanner.next();
						if(!fechaR2.isEmpty())
							ra2.setFechaNacimiento(sdf.parse(fechaR2));
						
						String dniRa2 = scanner.next();
						if (dniRa2.length() == 8) {
							ra2.setDni(Integer.parseInt(dniRa2));
						} else {
							ra2.setDni(++DNI_FALSO);
						}
						ra2.setCuilCuit(parsearCuitCuil(scanner.next()));
						/* tipodepago */scanner.next();
						/* nro cuenta*/ scanner.next();
						String nroCuenta = cuentas.get(idTroop);
						if(nroCuenta != null && !nroCuenta.isEmpty() && !nroCuenta.equals("NULL"))
						{
							ra1.setNroCuenta(nroCuenta);
							ra1.setEstadoCuenta(EstadoCuenta.ACTIVA);	
						}
						else 
						{
							ra1.setEstadoCuenta(EstadoCuenta.NO_SOLICITADA);
						}
						//System.out.println("**************************" + cot + "*****");
						/* id tipo documento RA2 */
						ra2.setIdTipoDni(getTipoDni(scanner.next()));
						/* ID BAnco */scanner.next();
						
						String apellidoRa2 = scanner.next();
						ra2.setApellido(apellidoRa2.equals("NULL")? "" : apellidoRa2);
						ra1.setApellido(scanner.next());
						/* nc_idnumerocuenta */scanner.next();
						/* Cimientos ID alumnos */scanner.next();
						/* cimientos_idescuela */scanner.next();
						/* cimientos_idEA */scanner.next();
						/* cimientos_idPadrino */scanner.next();
						/* cimientos_sucursal */scanner.next();
						pais = scanner.next();
						ra1.setNacionalidad(getNacionalidad(pais));
						String nroSucursal = scanner.next();
						SucursalBanco sucu = sucursales.get(nroSucursal);
						if(sucu != null)
							ra1.setSucursalBanco(sucu);
						
						/* tipodedocumento RA1 */
						ra1.setIdTipoDni(getTipoDni(scanner.next()));
						String sexoRa1 = scanner.next();
						if (!sexoRa1.equals("NULL")) {
							if (sexoRa1.equals("1")) {
								ra1.setSexo(false);
							} else {
								ra1.setSexo(true);
							}
						}
						String vinculo1 = scanner.next();
	
						if (!vinculo1.equals("NULL") && !vinculo1.equals("0") && !vinculo1.equals("")) {
							ra1.setIdVinculo(Vinculo.getVinculo(Integer
									.parseInt(vinculo1)));
						}
						String vinculo2 = scanner.next();
						if (!vinculo2.equals("NULL") && !vinculo2.equals("0") && !vinculo2.equals("")) {
							ra2.setIdVinculo(Vinculo.getVinculo(Integer
									.parseInt(vinculo2)));
						}
						/* zona */scanner.next();
						// Estudio SocioAmbiental
						
						//datos de direccion los copio del alumno
						ra1.setCalle(persona.getDireccion());
						ra1.setNroCalle(nroCalle);
						ra1.setCodigoPostal(persona.getCodigoPostal());
						ra1.setPiso( persona.getPiso() != null ? persona.getPiso().toString() : null);
						ra1.setDpto(persona.getDepartamento());
						ra1.setIdLocalidad(persona.getLocalidad());
						
						
						ra1.setIdAlumno(perfilAlumno);
						ra1.setTelefono1(telefonoCimientos);
						//session.save(ra1);
						perfilAlumno.setResponsable1(ra1);
						
						if( StringUtils.isNotEmpty(ra2.getNombre())  || StringUtils.isNotEmpty(ra2.getApellido())){
							ra2.setIdAlumno(perfilAlumno);
							//session.save(ra2);
							perfilAlumno.setResponsable2(ra2);
						}

						perfilAlumno.setEmitioCarta(EmitioCarta.NO_TIENE_CARTA);
						
						if(perfilAlumno.getEscuela() != null){							
							session.save(persona);
							session.save(perfilAlumno);
							persona.setPerfilAlumno(perfilAlumno);
							session.update(persona);
							alumnos.put(idTroop, perfilAlumno);
							usuarios_nombre_apellido.put(persona.getApellido() + " " + persona.getNombre(), persona);
							AlumnoSeleccion as = crearAlumnoSeleccion(perfilAlumno);
							alumnos_seleccion.put(idTroop, as);
							session.save(as);
							AlumnoPanelEA alumnoPanelEA = crearAlumnoPanelEa(perfilAlumno);
							session.save(alumnoPanelEA);
							alumnos_panelEA.put(perfilAlumno.getId(), alumnoPanelEA);
						}
						else{
							System.out.println("No se migro el registro nro " + (count + 1) + " del archivo alumnos_2011.csv . " +
									"No existe la escuela para el alumno idTroop " + idTroop);
						}
						
					} catch (Exception e) {
						System.out.println("No se migro el registro nro " + (count + 1) + " del archivo alumnos_2011.csv");
					}
				}	
//			}
		};
	}
	

	private static void migrarMateriasFijas() throws IOException {

		// materias fijas
		Parser materiasFijasParser = new Parser(new File(FILE_HOME,
				"materias_fijas.csv"), sessionFactory.openSession()) {

			@Override
			public void handleLine(String line, Session session, int count) {
				try{
					Scanner scanner = new Scanner(line);
					scanner.useDelimiter(";");
					String nombre = scanner.next();
					Materia materiaFija = new Materia();
					materiaFija.setNombre(nombre.trim());
					materiaFija.setBasica(true);
					session.save(materiaFija);
					materias.put(materiaFija.getNombre(), materiaFija);
					count++;
				} catch (Exception e) {
					System.out.println("No se migro el registro nro " + (count + 1) + " del archivo materias_fijas.csv");
				}
			}
		};
	}
	
	private static void migrarMateriasOptativas() throws IOException {

		// materias optativas 
		Parser materiasFijasParser = new Parser(new File(FILE_HOME,
				"materias_optativas.csv"), sessionFactory.openSession()) {

			@Override
			public void handleLine(String line, Session session, int count) {
				try{
					Scanner scanner = new Scanner(line);
					scanner.useDelimiter(";");
					String nombre = scanner.next();
					Materia materiaOptativa = new Materia();
					materiaOptativa.setNombre(nombre.trim());
					materiaOptativa.setBasica(false);
					session.save(materiaOptativa);
					materias.put(materiaOptativa.getNombre(), materiaOptativa);
					count++;
				} catch (Exception e) {
					System.out.println("No se migro el registro nro " + (count + 1) + " del archivo materias_optativas.csv");
				}
			}
		};
	}

	private static void demo() {
		System.out.println("Modificando datos para la demo");
		Session s = sessionFactory.openSession();
		Transaction txTransaction = s.beginTransaction();
		Beca beca = new Beca();
		beca.setActivo(true);
		beca.setCantidad(500);
		beca.setCantidadAsignada(0);
		beca.setCiclo(ciclos.get("2011"));
		beca.setEstado(EstadoBeca.CONFIRMADA);
		beca.setFechaAlta(new Date());
		beca.setPadrino(padrinos.get(1097l));
		beca.setPeriodoPago(ciclos.get("2011").getPeriodos().get(0));
		beca.setTipo(TipoBeca.LOCAL);
		ZonaCimientos zonaHard = escuelas.get("2").getZonaCimientos();
		beca.setZona(zonaHard);
		beca.setCantidadAsignada(0);
		s.save(beca);
		
		Criteria criteria = s.createCriteria(PerfilEA.class);
		for(PerfilEA ea : (List<PerfilEA>)criteria.list()){
			ea.agregarZona(zonaHard);
			s.update(ea);
		}
		criteria = s.createCriteria(PerfilRR.class);
		for(PerfilRR rr : (List<PerfilRR>)criteria.list()){
			rr.agregarZona(zonaHard);
			s.update(rr);
		}
		txTransaction.commit();
		s.close();
	}

	private static void migrarBoletin() throws IOException {
		Parser boletinParser = new Parser(new File(FILE_HOME,
				"boletines.csv"), sessionFactory.openSession()) {
			
			
			@Override
			public void handleLine(String line, Session session, int count) {
				try{
					Scanner scanner = new Scanner(line);
					scanner.useDelimiter(";");
					
					if(count == 0){
						//es la 1ra linea del excel, los headers
						for (int i = 0; i < 5; i++) {
							scanner.next();
						}
						for(int i = 0; i < 16; i++){
							String materiaTrimestre = scanner.next();
							String materia = StringUtils.remove(materiaTrimestre, materiaTrimestre.substring(materiaTrimestre.length()- 7));
							materiasExcel[i] = materia;
							for (int j = 0; j < 5; j++) {
								scanner.next();
							}
						}
						
					}else{
						
						long idAlumno = scanner.nextLong();
						PerfilAlumno perfil = alumnos.get(idAlumno);
						if(perfil != null){
						
							String nombreAlumno = scanner.next();
							System.out.println("Boletin Alumno: " + nombreAlumno + " - ");
							CicloPrograma ciclo = ciclos.get(scanner.next());
							
							Integer anio = scanner.nextInt();
							AnioEscolar anioEscolar = AnioEscolar.getAnioEscolar(anio);
							//isEscuela
							scanner.next();
							
							List<Materia> materiasBoletin = new ArrayList<Materia>();
							
							List<Trimestre> trimestres = new ArrayList<Trimestre>();
							List<NotaMateria> notasMaterias0 = new ArrayList<NotaMateria>();
							List<NotaMateria> notasMaterias1 = new ArrayList<NotaMateria>();
							List<NotaMateria> notasMaterias2 = new ArrayList<NotaMateria>();
							List<NotaMateria> notasMaterias3 = new ArrayList<NotaMateria>();
							List<NotaMateria> notasMaterias4 = new ArrayList<NotaMateria>();
							List<NotaMateria> notasMaterias5 = new ArrayList<NotaMateria>();
							//nueva columna no aprueba
							List<NotaMateria> notasMaterias6 = new ArrayList<NotaMateria>();	
							
							Trimestre primero = new Trimestre();
							primero.setNombre(ConstantesBoletin.PRIMER_TRIMESTRE);
							Trimestre segundo = new Trimestre();
							segundo.setNombre(ConstantesBoletin.SEGUNDO_TRIMESTRE);
							Trimestre tercero = new Trimestre();
							tercero.setNombre(ConstantesBoletin.TERCER_TRIMESTRE);
							Trimestre notasFinal = new Trimestre();
							notasFinal.setNombre(ConstantesBoletin.FINAL);	
							Trimestre notasDiciembre = new Trimestre();
							notasDiciembre.setNombre(ConstantesBoletin.DICIEMBRE);					
							Trimestre notasMarzo = new Trimestre();
							notasMarzo.setNombre(ConstantesBoletin.MARZO);
							//nueva columna no aprueba
							Trimestre notasNoAprueba = new Trimestre();
							notasMarzo.setNombre(ConstantesBoletin.NO_APRUEBA);
							
							Boletin boletin = new Boletin();
							
							for (int i = 0; i < 16; i++) {
								String materiaExcel = materiasExcel[i];
								Materia materia = materias.get(materiaExcel);
								
								//System.out.println("Materia: " + materiaExcel );
								
								boolean tieneNota = false;
								String notas[] = new String[6];
								for (int j = 0; j < 6; j++) {
									notas[j] = scanner.next();
									if(StringUtils.isNotBlank(notas[j]) && !tieneNota){
										tieneNota = true; 
									}
								}
								
								if(tieneNota){
									materiasBoletin.add(materia);
									crearNotaMateria(notasMaterias0, materia, notas[0], session);
									crearNotaMateria(notasMaterias1, materia, notas[1], session);
									crearNotaMateria(notasMaterias2, materia, notas[2], session);
									crearNotaMateria(notasMaterias3, materia, notas[3], session);
									crearNotaMateria(notasMaterias4, materia, notas[4], session);
									crearNotaMateria(notasMaterias5, materia, notas[5], session);
									//nueva columna no aprueba
									crearNotaNoAprueba(notasMaterias6,materia,  session);
								}
		
							}
							
							
							primero.setMaterias(notasMaterias0);
							segundo.setMaterias(notasMaterias1);
							tercero.setMaterias(notasMaterias2);
							notasFinal.setMaterias(notasMaterias3);
							notasDiciembre.setMaterias(notasMaterias4);
							notasMarzo.setMaterias(notasMaterias5);
							//nueva columna no aprueba
							notasNoAprueba.setMaterias(notasMaterias6);
	
							trimestres.add(0,primero);
							trimestres.add(1,segundo);
							trimestres.add(2,tercero);
							trimestres.add(3,notasFinal);
							trimestres.add(4,notasDiciembre);
							trimestres.add(5,notasMarzo);
							//nueva columna no aprueba
							trimestres.add(6,notasNoAprueba);
							
							
							for (Trimestre trimestre : trimestres) {
								session.save(trimestre);
							}
							
							boletin.setAno(anioEscolar);
							boletin.setCiclo(ciclo);
							
							//Inasistencias
							boletin.setInasistenciasPrimerTrimestre(scanner.nextFloat());
							boletin.setInasistenciasSegundoTrimestre(scanner.nextFloat());
							boletin.setInasistenciasTercerTrimestre(scanner.nextFloat());
							
							scanner.nextFloat();
							
							String dias1 = scanner.next();
							String dias2 = scanner.next();
							String dias3 = scanner.next();
							boletin.setDiasHabilesPrimerTrimestre(StringUtils.isNotBlank(dias1)? Float.parseFloat(dias1) : null);
							boletin.setDiasHabilesSegundoTrimestre(StringUtils.isNotBlank(dias2)? Float.parseFloat(dias2) : null);
							boletin.setDiasHabilesTercerTrimestre(StringUtils.isNotBlank(dias3)? Float.parseFloat(dias3) : null);
							
							
							boletin.setMaterias(materiasBoletin);
							boletin.setTrimestres(trimestres);
	//						boletin.setRegular(true);
							perfil.setBoletin(boletin);
							
							AlumnoPanelEA ape = alumnos_panelEA.get(perfil.getId());
							if(perfil.getBoletin() != null)
							{
								if(boletinFinalizado(boletin))
									ape.setColorBoletin(ConstantesPaneles.GREEN);
								else
									ape.setColorBoletin(ConstantesPaneles.RED);
							}
							else
								ape.setColorBoletin(ConstantesPaneles.GRAY);
							if(boletin.getMateriasPrevias() != null)
								ape.setCantidadPrevias(boletin.getMateriasPrevias().size());
							//Se guarda el boletin para usarlo en la generacion del IS1 en la migracion de entrevistas de renovacion
							boletines.put(perfil.getId(), boletin);
							System.out.println(count);
							session.saveOrUpdate(perfil);
							session.saveOrUpdate(boletin);
							session.update(ape);						
						
						}
	
					}
				} catch (Exception e) {
					System.out.println("No se migro el registro nro " + (count + 1) + " del archivo boletines.csv");
				}
			}
			
			private void crearNotaMateria(List<NotaMateria> notasMaterias,
					Materia materia, String notaM, Session session) 
			{
					NotaMateria notaMateria = new NotaMateria();
					notaMateria.setMateria(materia);
					if(StringUtils.isNotBlank(notaM)){
						Integer nota = redondearNota(notaM.trim());
						notaMateria.setCalificacion(CalificacionMateria.getCalificacionMateria(nota));
					}else{
						notaMateria.setCalificacion(CalificacionMateria.SIN_CARGAR);
					}
					
					notaMateria.setEstado(EstadoMateria.SIN_CALIFICAR);
					notasMaterias.add(notaMateria);	
					
					session.saveOrUpdate(notaMateria);
			}

			
			private Integer redondearNota(String nota){
				        //Notas con decimal mayor o igual a .5 se redondeará hacía la nota mayor más cercana 
						//Notas con decimal menor a .5 se redondeará hacía la nota menor más cercana
						//Notas con decimal entre 5.5 y 5.9 y entre 6.5 y 6.9 se redondeará hacía la nota menor más cercana
				String notaRedondeada = nota;
				if(StringUtils.contains(nota, '.')){
					Double notaDecimal = Double.valueOf(nota);
					if((notaDecimal >= 5.5 && notaDecimal <= 5.9) || (notaDecimal >= 6.5 && notaDecimal <= 6.9)){
						notaRedondeada = String.valueOf(Math.round(notaDecimal - 0.5));
					}else{
						notaRedondeada = String.valueOf( Math.round(notaDecimal));
					}
					
				}
				return Integer.valueOf(notaRedondeada);

			}
			
			private void crearNotaNoAprueba(List<NotaMateria> notasMaterias,
					Materia materia, Session session) {
				NotaMateria notaMateria = new NotaMateria();
				notaMateria.setMateria(materia);
				notaMateria.setNoAprueba(false);
				notasMaterias.add(notaMateria);	
				
				session.saveOrUpdate(notaMateria);
				
			}
			
		};
	}
	
	/**
	 * Crea todos los datos necesarios para el modelo de seleccion, esto es Persona en PersonaSeleccion;
	 * Responsable en ResponsableSeleccion; Alumno en AlumnoSeleccion; 
		AlumnoSeleccion contiene las referencias de ResponsableSeleccion,EscuelaSeleccion,ConvocatoriaSeleccion. 
		EntrevistaSeleccion tiene una referencia de AlumnoSeleccion
	 * @param perfilAlumno
	 * @return 
	 */
	private static AlumnoSeleccion crearAlumnoSeleccion(PerfilAlumno p) {
		AlumnoSeleccion a = new AlumnoSeleccion();
		a.setActivo(p.getActivo());
		a.setAnioEscolar(p.getAnioEscolar());
		a.setCompromisoEscolaridad(p.getCompromisoEscolaridad());
		a.setCompromisoPbe(p.getCompromisoPbe());
		a.setContactoTelefono1(p.getContactoTelefono1());
		a.setContactoTelefono2(p.getContactoTelefono2());
		a.setContactoTelefono3(p.getContactoTelefono3());
		a.setDatosPersonales(crearPersonaSeleccion(p.getDatosPersonales()));
		a.setDivision(p.getDivision());
		a.setEscuelaSeleccion(escuelasSeleccion.get(p.getEscuela().getId()));
		a.setEstadoAlumno(p.getEstadoAlumno());
		a.setEvaluacion(p.getEvaluacion());
		a.setFechaAlta(p.getFechaAlta());
		a.setFechaBaja(p.getFechaBaja());
		a.setFechaEntrevista(p.getFechaEntrevista());
		a.setFichaFamiliar(p.getFichaFamiliar());
		a.setResponsable1(crearResponsableSeleccion(p.getResponsable1()));
		a.setResponsable2(crearResponsableSeleccion(p.getResponsable2()));
		a.setTelefono1(p.getTelefono1());
		a.setTelefono2(p.getTelefono2());
		a.setTelefono3(p.getTelefono3());
		a.setTurno(p.getTurno());
		return a;
	}

	
	private static ResponsableAdultoSeleccion crearResponsableSeleccion(ResponsableAdulto r) {
		if(r != null){
		ResponsableAdultoSeleccion rs = new ResponsableAdultoSeleccion();
		rs.setActivo(r.isActivo());
		rs.setApellido(r.getApellido());
		rs.setBanco(r.getBanco());
		rs.setCalle(r.getCalle());
		rs.setCelular(r.getCelular());
		rs.setCodigoPostal(r.getCodigoPostal());
		rs.setContactoTelefono1(r.getContactoTelefono1());
		rs.setContactoTelefono2(r.getContactoTelefono2());
		rs.setCuilCuit(r.getCuilCuit());
		rs.setDireccion(r.getDireccion());
		rs.setDni(r.getDni());
		rs.setDpto(r.getDpto());
		rs.setEgresosTotales(r.getEgresosTotales());
		rs.setEntreCalles(r.getEntreCalles());
		rs.setFechaNacimiento(r.getFechaNacimiento());
		rs.setIdAptoComoRA(r.getIdAptoComoRA());
		rs.setIdCompromiso(r.getIdCompromiso());
		rs.setIdCompromisoPBE(r.getIdCompromisoPBE());
		rs.setIdEntrevistador(r.getIdEntrevistador());
		rs.setIdEstadoCivil(r.getIdEstadoCivil());
		rs.setIdLocalidad(r.getIdLocalidad());
		rs.setIdRelacionVivienda(r.getIdRelacionVivienda());
		rs.setIdTipoAfyp(r.getIdTipoAfyp());
		rs.setIdTipoDni(r.getIdTipoDni());
		rs.setIdVinculo(r.getIdVinculo());
		rs.setInformacionComplementaria(r.getInformacionComplementaria());
		rs.setIngresos(r.getIngresos());
		rs.setMail(r.getMail());
		rs.setNacionalidad(r.getNacionalidad());
		rs.setNombre(r.getNombre());
		rs.setNroCalle(r.getNroCalle());
		rs.setNroCuenta(r.getNroCuenta());
		rs.setObservaciones(r.getObservaciones());
		rs.setObservacionesParaTS(r.getObservacionesParaTS());
		rs.setPercepcionesSobreRA(r.getPercepcionesSobreRA());
		rs.setPiso(r.getPiso());
		rs.setSexo(r.getSexo());
		rs.setSucursal(r.getSucursalBanco());
		rs.setSucursalBanco(r.getSucursalBanco());
		rs.setTelefono1(r.getTelefono1());
		rs.setTelefono2(r.getTelefono2());
		return rs;
		}
		return null;
	}

	private static PersonaSeleccion crearPersonaSeleccion(Persona d) {
		PersonaSeleccion p = new PersonaSeleccion();
		p.setApellido(d.getApellido());
		p.setCelular(d.getCelular());
		p.setCodigoPostal(d.getCodigoPostal());
		p.setCuilCuit(d.getCuilCuit());
		p.setDepartamento(d.getDepartamento());
		p.setDni(d.getDni());
		p.setEntreCalles(d.getEntreCalles());
		p.setEstadoCivil(d.getEstadoCivil());
		p.setFechaNacimiento(d.getFechaNacimiento());
		p.setLocalidad(d.getLocalidad());
		p.setMail(d.getMail());
		p.setNacionalidad(d.getNacionalidad());
		p.setNombre(d.getNombre());
		p.setNumeroCalle(d.getNumeroCalle());
		p.setPiso(d.getPiso());
		p.setProvincia(d.getProvincia());
		p.setSexo(d.isSexo());
		p.setTelefono(d.getTelefono());
		p.setTipoDni(d.getTipoDni());
		return p;
	}
	
	/**
	 * se deshace de los molestos "NULL"
	 * @param scannerNext
	 * @return
	 */
	private static String parsear(String scannerNext){
		if(scannerNext.equals("NULL") || scannerNext.equals("")){
			return null;
		}
		else return scannerNext;
	}
	
	/**
	 * se deshace de los molestos "NULL" y de los guiones
	 * @param scannerNext
	 * @return
	 */
	private static String parsearCuitCuil(String scannerNext){
		if(scannerNext.equals("NULL")){
			return null;
		}
		else return scannerNext.replaceAll("-", "");
	}

	private static void migrarPaises() throws IOException {

		// paises
		Parser paisesParser = new Parser(new File(FILE_HOME,
				"paises.csv"), sessionFactory.openSession()) {

			@Override
			public void handleLine(String line, Session session, int count) {
				Scanner scanner = new Scanner(line);
				scanner.useDelimiter(";");
				String id = scanner.next();
				String pais = scanner.next();
				paises.put(id, pais);
				count++;

			}
		};
	}
	
	private static String getNacionalidad(String pais){
		String nombrePais = paises.get(pais);
		return nombrePais;
	}
	
	private static TipoDni getTipoDni(String scannerNext){
		TipoDni tipoDni = null;
		if(StringUtils.isNotBlank( scannerNext ) && StringUtils.isNumeric(scannerNext)){
			tipoDni =  TipoDni.getTipoDni(Integer.parseInt(scannerNext));
		}
		return tipoDni;
	}
	

	private static Localidad getLocalidad(String localidad, String provincia, Session session) {
		Localidad loc = localidades.get(localidad);
		Provincia prov = provincias.get(provincia);
		Localidad nuevaLocalidad = null;
		if(loc == null){
			nuevaLocalidad = new Localidad();
			nuevaLocalidad.setNombre(localidad);
			nuevaLocalidad.setProvincia(prov);
			session.save(nuevaLocalidad);
			localidades.put(localidad, nuevaLocalidad);
			return nuevaLocalidad;
		}
		return loc;
	}
	
	
	private static AlumnoPanelEA crearAlumnoPanelEa(PerfilAlumno pa) {
		AlumnoPanelEA a = new AlumnoPanelEA();
		a.setActivo(false);
		a.setAnio(pa.getAnioEscolar());
		a.setColorBoletin(pa.getBoletin()!=null?ConstantesPaneles.GREEN:ConstantesPaneles.GRAY);
		a.setColorEntrevistas(ConstantesPaneles.RED);
		a.setColorIS1(ConstantesPaneles.RED);
		a.setColorIS2(ConstantesPaneles.RED);
		a.setColorIS3(ConstantesPaneles.RED);
		a.setColorPagos(ConstantesPaneles.RED);
		a.setCantidadPrevias(0);
		a.setColorRA(pa.getResponsable1().getNroCuenta()!=""?ConstantesPaneles.GREEN:ConstantesPaneles.RED);
		a.setCuentaRA(pa.getResponsable1().getNroCuenta());
		a.setDni(pa.getDatosPersonales().getDni());
		a.setEntrevistas(0);
		a.setEntrevistasFinalizadas(false);
		a.setEntrevistasRealizadas(0);
		a.setEscuela(pa.getEscuela().getNombre());
		a.setIdPerfilAlumno(pa.getId());
		a.setNombreApellido(pa.getDatosPersonales().getNombre() + " " + pa.getDatosPersonales().getApellido());
		a.setPagos(0);
		a.setPagosRealizados(0);
		return a;
	}
	
	private static void actualizarAlumnoPanelEa(AlumnoPanelEA ape,	PerfilAlumno pa, Date fechaEntrevista) {
		if(pa.getBeca() != null)
		{
			int totalPeriodos = pa.getBeca().getCiclo().getPeriodos().size();
			ape.setFechaUltEntrevista(fechaEntrevista);
			ape.setIdPerfilEA(pa.getEa().getIdPerfilEA());
			ape.setTotalEntrevistasCiclo(totalPeriodos);
			ape.setEntrevistas(totalPeriodos);
			ape.setPagos(totalPeriodos);
			ape.setZona(pa.getBeca().getZona().getNombre());
			if(pa.getFechaAltaBeca() != null)
				ape.setFechaAltaBeca(pa.getFechaAltaBeca());
		}
	}
	
	private static void resetearAlumnoPanelEa(AlumnoPanelEA ape, PerfilAlumno pa, Date fechaEntrevista) {
		if(pa.getBeca() != null)
		{
			int totalPeriodos = pa.getBeca().getCiclo().getPeriodos().size();
			ape.setFechaUltEntrevista(fechaEntrevista);
			ape.setIdPerfilEA(pa.getEa().getIdPerfilEA());
			ape.setTotalEntrevistasCiclo(totalPeriodos);
			ape.setEntrevistas(totalPeriodos);
			ape.setPagos(totalPeriodos);
			ape.setZona(pa.getBeca().getZona().getNombre());
			ape.setPagosRealizados(0);
			ape.setEntrevistasRealizadas(0);
			ape.setEntrevistasFinalizadas(false);
			ape.setActivo(true);
			if(pa.getFechaAltaBeca() != null)
				ape.setFechaAltaBeca(pa.getFechaAltaBeca());
		}
	}
	
	


	/**
	 * Esta funcion retorna el color del semaforo del boletín (gris, rojo, verde) dependiendo de los casos contemplados
	 * @param boletin
	 * @return String
	 */
	private static String generarColorSemaforoBoletin(Boletin boletin, EstadoAlumno estadoAlumno)
	{
		//si no hay boletin cargado
		if (boletin == null)
		{
			return ConstantesPaneles.GRAY;
		}
		
		//si el boletin es valido
		if (isCargaBoletinValido(boletin, estadoAlumno))
		{
			return ConstantesPaneles.GREEN;
		}

		//si es cualquier otro caso fuera de los casos contemplados
		return ConstantesPaneles.RED;
	}


	/**
	 * Esta funcion retorna verdadero o falso de acuerdo a los diferentes casos.
	 * 
	 * Un trimestre cargado correctamente implica tener las notas seteadas de ese trimestre como así también 
	 * sus inasistencias y cantidad de días hábiles si es que corresponden, 
	 * ya que los mismos pueden haberse no cargado porque no se conocían dichos valores (Check Sin Dato).
	 * 
	 * El cerrar un boletín significa tener cargados los tres trimestres, la nota final, 
	 * la columna de aprobado  con diciembre y marzo que corresponda y sus inasistencias y su cantidad de días hábiles.
	 * @param boletin
	 * @return Boolean
	 */
	public static Boolean isCargaBoletinValido(Boletin boletin, EstadoAlumno estadoAlumno)
	{
		
		if(estadoAlumno.equals(EstadoAlumno.PENDIENTE))
		{
			if(boletinFinalizado(boletin))
				return true;
			else
				return false;
				
		}
		else
		{
			// retorna true si el primer trimestre esta cargado y false en caso
			// contrario
			Boolean cargo1T = cargaPrimerTrimestre(boletin.getTrimestres().get(0), boletin);

			// retorna true si el segundo trimestre esta cargado y false en caso
			// contrario
			Boolean cargo2T = cargaSegundoTrimestre(boletin.getTrimestres().get(1), boletin);
			
			// retorna true si el tercer trimestre esta cargado y false en caso
			// contrario
			
			Boolean cargo3T = cargaTercerTrimestre(boletin.getTrimestres().get(2), boletin);

			
			Date fechaActual = new Date();

			Boolean isValidoPrimerTrimestre = true;
			
			Boolean isValidoSegundoTrimestre = true;

			/**
			 * caso 1: si la fecha actual es menor (esta antes) a la fecha del
			 * primer trimestre (entraría en cualquier otro caso)
			 */
			if (fechaActual.before(boletin.getCiclo().getFecha1T())) 
			{
				return false;
			}

			/**
			 * caso 2: si el primer trimestre esta cargado y la fecha actual
			 * esta despues de la fecha de carga del primer trimestre retorna
			 * true. 
			 * 
			 * caso 3: si esta cargado y la fecha actual esta antes de la
			 * fecha de carga del segundo trimestre retorna true. en caso
			 * contrario retorna false (entraría en cualquier otro caso)
			 * **/
			if (isCargaTrimestreValido(boletin.getCiclo().getFecha1T(), cargo1T)) 
			{
				isValidoPrimerTrimestre = true;
				if (fechaActual.before(boletin.getCiclo().getFecha2T())) 
				{
					return true;
				}
			}
			else
				return false;

			/**
			 * caso 4: si el segundo trimestre esta cargado y la fecha actual
			 * esta despues de la fecha de carga del segundo trimestre y el
			 * primer trimestre esta cargado retorna true. 
			 * 
			 * caso 5: si esta cargado y la fecha actual esta antes de la fecha de carga del
			 * tercer trimestre retorna true. en caso contrario retorna false
			 * (entraría en cualquier otro caso)
			 * **/
			if (isCargaTrimestreValido(boletin.getCiclo().getFecha2T(), cargo2T) && isValidoPrimerTrimestre) 
			{
				isValidoSegundoTrimestre = true;
				if (fechaActual.before(boletin.getCiclo().getFecha3T())) 
				{
					return true;
				}
			} 
			else
				return false;

			/**
			 * caso 6: si la fecha actual esta despues de la fecha de carga del
			 * tercer trimestre y el primer y segundo trimestre estan cargados (los dos) retorna true
			 * 
			 * caso 7:
			 * si la fecha actual esta despues de la fecha de carga del tercer
			 * trimestre y el boletin NO esta cerrado retorna false
			 */
			if (isCargaTrimestreValido(boletin.getCiclo().getFecha3T(), cargo3T) && isValidoPrimerTrimestre && isValidoSegundoTrimestre) 
			{
				return true;
			}

			/**
			 * caso 8 (general): retorna false en cualquier otro caso
			 */
			return false;
		
		}
	}
	
	/**
	 * Esta funcion devuelve true si la fecha actual está despues de la fecha de carga del trimestre que llega como parametro o si 
	 * la fecha actual es IGUAL a la fecha de carga del trimestre en cuestión
	 * y si el trimestre está cargado.
	 * Retorna false en caso contrario
	 * @param fechaCargaTrimestre
	 * @param isCargado
	 * @return Boolean
	 */
	private static Boolean isCargaTrimestreValido(Date fechaCargaTrimestre , Boolean isCargado)
	{
		Date fechaActual = new Date();
		
		if ((fechaActual.after(fechaCargaTrimestre) && isCargado) || (fechaActual.equals(fechaCargaTrimestre) && isCargado))
		{
			return true;
		}
		return false;
	}
	
	
	public static boolean boletinFinalizado(Boletin boletin){
		
		boolean finalizado = true; 
		
		finalizado = inasistenciasCompletas(boletin);
		
		if (finalizado){
			Trimestre primero = boletin.getTrimestres().get(0);
			finalizado = materiasCargadasDelTrimestre(primero);
				if (finalizado){
					Trimestre segundo = boletin.getTrimestres().get(1);
					finalizado = materiasCargadasDelTrimestre(segundo);
				
					if (finalizado){
						Trimestre tercero = boletin.getTrimestres().get(2);
						finalizado = materiasCargadasDelTrimestre(tercero);
						
						if (finalizado){
							Trimestre nFinal = boletin.getTrimestres().get(3);
							finalizado = materiasCargadasDelTrimestre(nFinal);
							if (finalizado){
								Trimestre diciembre = boletin.getTrimestres().get(4);
								Trimestre marzo = boletin.getTrimestres().get(5);		
								Trimestre noAprueba = boletin.getTrimestres().get(6);
								finalizado = noApruebaCompleto(noAprueba, diciembre, marzo ); 
							}
						}
					}
				}
		}		
		return finalizado;
	}
	
	private static boolean inasistenciasCompletas (Boletin boletin){

		boolean completas= true;
		
		if (!(boletin.getInasistenciasPrimerTrimestre()== null)&& (!(boletin.getDiasHabilesPrimerTrimestre()== null) && !(boletin.getDiasHabilesPrimerTrimestre()== 0))){
			
			if (!(boletin.getInasistenciasSegundoTrimestre()== null)&& (!(boletin.getDiasHabilesSegundoTrimestre()== null) && !(boletin.getDiasHabilesSegundoTrimestre()== 0))){
				
				if (!(boletin.getInasistenciasTercerTrimestre()== null)&& (!(boletin.getDiasHabilesTercerTrimestre()== null) && !(boletin.getDiasHabilesTercerTrimestre()== 0))){
		
			}else completas = false;
	
		 }else completas = false;
		
		}else completas = false;		
		
		return completas;
	}

	private static boolean materiasCargadasDelTrimestre(Trimestre trimestre)
	{
		boolean finalizado = true;
		List<NotaMateria> notasMaterias = trimestre.getMaterias();
		for (int i = 0; i < notasMaterias.size(); i++) 
		{
			if(notasMaterias.get(i).getCalificacion().equals(CalificacionMateria.SIN_CARGAR))
			{
				finalizado = false ;
				break;
			}
		}
		return finalizado;
	}
	
	private static boolean noApruebaCompleto(Trimestre trimestreNoAp, Trimestre diciembre, Trimestre marzo )
	{
		boolean finalizado = true;
		List<NotaMateria> noAprueba = trimestreNoAp.getMaterias();
		List<NotaMateria> dic = diciembre.getMaterias();
		List<NotaMateria> mar = marzo.getMaterias();
		
		for (int i = 0; i < noAprueba.size(); i++) 
		{
			if(((noAprueba.get(i).isNoAprueba())&&
				((dic.get(i).getCalificacion().equals(CalificacionMateria.SIN_CARGAR))&&(mar.get(i).getCalificacion().equals(CalificacionMateria.SIN_CARGAR))))||
				(!(noAprueba.get(i).isNoAprueba())&&
				(!(dic.get(i).getCalificacion().equals(CalificacionMateria.SIN_CARGAR))||!(mar.get(i).getCalificacion().equals(CalificacionMateria.SIN_CARGAR)))))
			
			{
				finalizado = false ;
				break;
			}
		}
		return finalizado;
	}
	
	private static boolean cargaPrimerTrimestre(Trimestre trimestre, Boletin boletin)
	{
		boolean finalizado = true;
		// se utilizo esta negacion de igualdad porque daba la excepcion
		// java.lang.NullPointerException at floatValue(), de la clase
		// Float al preguntar por
		// boletin.getInasistenciasprimerTrimestre() != null
		List<NotaMateria> notasMaterias = trimestre.getMaterias();
		finalizado = finalizado && (!(boletin.getDiasHabilesPrimerTrimestre()== null) && boletin.getDiasHabilesPrimerTrimestre()!= 0) && !(boletin.getInasistenciasPrimerTrimestre()== null);
		if(finalizado)
		{
			for (int i = 0; i < notasMaterias.size(); i++) 
			{
				if(notasMaterias.get(i).getCalificacion().equals(CalificacionMateria.SIN_CARGAR))
				{
					finalizado = false ;
					break;
				}
			}
		}
		return finalizado;
	}
   
	private static boolean cargaSegundoTrimestre(Trimestre trimestre, Boletin boletin)
	{
		boolean finalizado = true;
		List<NotaMateria> notasMaterias = trimestre.getMaterias();
		// se utilizo esta negacion de igualdad porque daba la excepcion
		// java.lang.NullPointerException at floatValue(), de la clase
		// Float al preguntar por
		// boletin.getInasistenciasprimerTrimestre() != null
		finalizado = finalizado && (!(boletin.getDiasHabilesSegundoTrimestre()== null) && boletin.getDiasHabilesSegundoTrimestre()!= 0) && !(boletin.getInasistenciasSegundoTrimestre()== null);
		if(finalizado)
		{
			for (int i = 0; i < notasMaterias.size(); i++) 
			{
				
				if (notasMaterias.get(i).getCalificacion().equals(CalificacionMateria.SIN_CARGAR)) 
				{
					finalizado = false;
					break;
				}
			}
		}
		return finalizado;
	}
	
	private static boolean cargaTercerTrimestre(Trimestre trimestre, Boletin boletin)
	{
		boolean finalizado = true;
		List<NotaMateria> notasMaterias = trimestre.getMaterias();
		// se utilizo esta negacion de igualdad porque daba la excepcion
		// java.lang.NullPointerException at floatValue(), de la clase
		// Float al preguntar por
		// boletin.getInasistenciasprimerTrimestre() != null		
		finalizado = finalizado && (!(boletin.getDiasHabilesTercerTrimestre()== null) && boletin.getDiasHabilesTercerTrimestre()!= 0) && !(boletin.getInasistenciasTercerTrimestre()== null);
		if(finalizado)
		{
			for (int i = 0; i < notasMaterias.size(); i++) 
			{
				
				if(notasMaterias.get(i).getCalificacion().equals(CalificacionMateria.SIN_CARGAR))
				{
					finalizado = false ;
					break;
				}
			}
		}
		return finalizado;
	}
	
	
	
	public static PerfilAlumno obtenerPerfilesAlumnos(Integer dni) throws Exception 
	{	

		Session session = sessionFactory.openSession();
		Transaction tx = session.beginTransaction();
	
		Criteria criteria = session.createCriteria(PerfilAlumno.class);
		criteria.createAlias("datosPersonales", "datosPersonales");
		criteria.add(Restrictions.eq("datosPersonales.dni", dni));
		List<PerfilAlumno> result = criteria.list();
		tx.commit();
		session.close();
		if(!result.isEmpty() )
		{
			return result.get(0);			
		}
		else
		{
			return null;
		}
		
	}
	
	public static EntrevistaSeleccion obtenerEntrevistaSeleccion(Long long1) throws Exception 
	{	

		Session session = sessionFactory.openSession();
		Transaction tx = session.beginTransaction();
	
		Criteria criteria = session.createCriteria(EntrevistaSeleccion.class);
		criteria.add(Restrictions.eq("idPerfilAlumno", long1));
		List<EntrevistaSeleccion> result = criteria.list();
		tx.commit();
		session.close();
		if(!result.isEmpty() )
		{
			return result.get(0);			
		}
		else
		{
			return null;
		}
		
	}
	
	
	public static PerfilAlumno obtenerPerfilesAlumnosPorNombreApellido(String nombre, String apellido) throws Exception 
	{	

		Session session = sessionFactory.openSession();
		Transaction tx = session.beginTransaction();
	
		Criteria criteria = session.createCriteria(PerfilAlumno.class);
		criteria.createAlias("datosPersonales", "datosPersonales");
		criteria.add(Restrictions.eq("datosPersonales.nombre", nombre));
		criteria.add(Restrictions.eq("datosPersonales.apellido", apellido));
		List<PerfilAlumno> result = criteria.list();
		tx.commit();
		session.close();
		if(!result.isEmpty() )
		{
			return result.get(0);			
		}
		else
		{
			return null;
		}
		
	}
	
	public static EntrevistaRenovacion obtenerEntrevistaRenovacionPorAlumno(Integer dni, Long id) throws Exception 
	{	

		Session session = sessionFactory.openSession();
		Transaction tx = session.beginTransaction();
	
		Criteria criteria = session.createCriteria(EntrevistaRenovacion.class);
		criteria.createAlias("perfilAlumno.datosPersonales", "persona");
		criteria.add(Restrictions.or(Restrictions.eq("persona.dni", dni), Restrictions.eq("perfilAlumno.id", id)));
		criteria.add(Restrictions.eq("motivoPendiente", MotivoPendiente.OTRO));
		criteria.add(Restrictions.isNull("motivoOtro"));
		List<EntrevistaRenovacion> result = criteria.list();
		
		if(!result.isEmpty())
		{
			tx.commit();
			session.close();
			return result.get(0);
		}
		else
		{
			tx.commit();
			session.close();
			return null;
		}
	}
	
	
	public static InformeIS2 obtenerIs2PorAlumno(Integer dni, Long id) throws Exception{	

		Session session = sessionFactory.openSession();
		Transaction tx = session.beginTransaction();
	
		Criteria criteria = session.createCriteria(InformeIS2.class);
		criteria.add(Restrictions.eq("becado.id", id));		
		List<InformeIS2> result = criteria.list();		
		
		tx.commit();
		session.close();
		if(!result.isEmpty()){
			return result.get(0);
		}
		else{			
			return null;
		}
	}
	
	
	public static AlumnoPanelEA obtenerApe(Long id) throws Exception{	

		Session session = sessionFactory.openSession();
		Transaction tx = session.beginTransaction();
	
		Criteria criteria = session.createCriteria(AlumnoPanelEA.class);
		criteria.add(Restrictions.eq("idPerfilAlumno", id));		
		List<AlumnoPanelEA> result = criteria.list();		
		
		tx.commit();
		session.close();
		if(!result.isEmpty()){
			return result.get(0);
		}
		else{			
			return null;
		}
	}


	
	public static List<PerfilAlumno> obtenerAlumnos2011() throws Exception{	

		Session session = sessionFactory.openSession();
		Transaction tx = session.beginTransaction();
		Criteria criteria = session.createCriteria(PerfilAlumno.class);
		criteria.createAlias("beca", "beca");
		criteria.createAlias("beca.ciclo", "ciclo");
		criteria.add(Restrictions.eq("ciclo.estado", EstadoCiclo.ACTUAL));		
		List<PerfilAlumno> result = criteria.list();		
		tx.commit();
		
		if(!result.isEmpty()){
			return result;
		}
		else{			
			return null;
		}
		
	}
	

}
